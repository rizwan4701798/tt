
// This pages adds/updates new online booking bookig types are Appointment/Discharge/IFT

var loginUserID = getCookie("UserID");
var loginUserName = getCookie("username");
var loginContactNo = getCookie("ContactNo");
var TripEventID = 0;
var unsaved = false;
var StartRowID = 0;
var BookingData;
var isPageLoadFirstTime = 0;
var currentFacility = 0;
var currentDropFacility = 0;
var type = 0;

var currentSelectedPatientID = 0;
var previousSelectPatientID;



var currentSelectedTripEventID = 0;
var previousSelectedTripID;


var NormalBookingBeforeHours = 0;
var AdvanceBookingDays = 0;
var EmergencyBookingBeforeHours = 0;
var dateToday = new Date();
var selectedMedicalRequirements = 0;


$(function () {
    //$("#datepicker").datetimepicker({
    //$("#txtTransportDate").datepicker({
    //    dateFormat: 'dd-mm-yy',
    //    minDate: dateToday
    //});


    //$("#txtTransportDate").datepicker({
    //    dateFormat: 'dd-mm-yy',
    //    minDate: dateToday
    //});savbe
});

$(document).ready(function () {

    //var abc = $(".AddEditDivClass .search-header-column"); //  .innerHTML = "HealthNET Booking System";

    //for (var i = 0; i < abc.length; i++) {
    //    abc[i].innerHTML = "HealthNET Booking System";
    //}

    // 
    // var a = Math.floor(29 / 24);
    // var b = 29 % 25;
    //debugger;
   // SendSMS("00923334701798", "test", "123", 1);

    LoadControlCenters();
    var caseid = base64_decode(getParameterByName("BID"));
    var e = document.getElementById("ddlControlCenter");
    if ((e.options.length > 2) & (caseid < 1)) {
        OpenControlCentreWindow();
    }
    else {
        e.selectedIndex = 1;
    }

  //  ShowAJAXDiv();


    LoadPTSSystemSettings();

    $(":input").change(function () { //trigers change in all input fields including text type
        unsaved = true;
    });

    currentFacility = 0;
    currentDropFacility = 0;

    $(".HomeAddressFields").css("display", "none");

    $('.DropHomeAddressFields').css('display', 'none');

    $("#btnCancelBooking").css("display", "none");


    if (CanBookEmergencySeat()) {
        // alert("true");
        $(".chkEmergencyBooking").css("display", "block");

    }
    else {
        //  alert("false");
        $(".chkEmergencyBooking").css("display", "none");
    }

    $(".AddEditDivClass .msg_head_Patient .normal-grid").click(function () {
        $(this).addClass("normal-grid-selected").siblings().removeClass("normal-grid-selected");
    });

    window.onbeforeunload = unloadPage;

    type = getParameterByName("type");
    var e = document.getElementById('ddlTransferReason');
    document.getElementById("txtTransportDate").readOnly = false;
    if (type == 1) {
        document.getElementById('rbFacility').removeAttribute('disabled')
        $('#ddlFacility').removeClass('dropdown_area');
        $('#ddlFacility').addClass('dropdown_area-disabled');

        ChangelnkSelection(4);
        e.selectedIndex = 1;

        var dateToday = new Date();
        var newDate = new Date();
        newDate.setDate(dateToday.getDate() + Math.floor(NormalBookingBeforeHours / 24));
        $('#txtTransportDate').datepicker(
        {
            minDate: newDate,
            dateFormat: 'dd/mm/yy'
        }
        );

        var date = getParameterByName("date");
        if (date != "") {
            date = date.replace("-", "/");
            date = date.replace("-", "/");
            date = date;
            $("#txtTransportDate").val(date);
        }
    }

    else if (type == 2) {
        document.getElementById('ddlFacility').removeAttribute('disabled');


        document.getElementById('rbHomeDrop').checked = true

        $('#ddlFacility').addClass('dropdown_area');
        $('#ddlFacility').removeClass('dropdown_area-disabled');
        $('#ddlDropFacility').removeClass('dropdown_area');
        $('#ddlDropFacility').addClass('dropdown_area-disabled');

        


        ChangelnkSelection(24);
        e.selectedIndex = 2;

        var dateToday = new Date();
        var d = new Date();
        var curr_day = d.getDate();
        var curr_month = d.getMonth();

        if (curr_day < 10) {
            curr_day = "0" + curr_day;
        }

        if (curr_month + 1 < 10) {
            curr_month = "0" + (curr_month + 1);
        }
        else {
            curr_month = (curr_month + 1);
        }
        var curr_year = d.getFullYear();
        var curr_Hours = d.getHours();
        if (curr_Hours < 10) {
            curr_Hours = "0" + curr_Hours;
        }

        var curr_Minutes = d.getMinutes();
        if (curr_Minutes < 10) {
            curr_Minutes = "0" + curr_Minutes;
        }

        var date = curr_day + "/" + curr_month + "/" + curr_year + " " + curr_Hours + ":" + curr_Minutes;





        //var newDate = new Date();
        // newDate.setDate(dateToday.getDate() + Math.floor(NormalBookingBeforeHours / 24));
        $("#txtTransportDate").val(date);
        document.getElementById("txtTransportDate").readOnly = true;

    }

    else if (type == 3) {

        document.getElementById('ddlFacility').removeAttribute('disabled')
        $('#ddlFacility').addClass('dropdown_area');
        $('#ddlFacility').removeClass('dropdown_area-disabled');

        ChangelnkSelection(25);
        e.selectedIndex = 3
        var dateToday = new Date();
        var newDate = new Date();
        var maxDate = new Date();
        maxDate.setDate(dateToday.getDate() + AdvanceBookingDays);

        $('#txtTransportDate').datetimepicker(
        {
            minDate: newDate,
            maxDate: maxDate,
            dateFormat: 'dd/mm/yy',
            date: dateToday
        }
        );

        var dateToday = new Date();
        var d = new Date();
        var curr_day = d.getDate();
        var curr_month = d.getMonth();

        if (curr_day < 10) {
            curr_day = "0" + curr_day;
        }

        if (curr_month + 1 < 10) {
            curr_month = "0" + (curr_month + 1);
        }

        else {
            curr_month = (curr_month + 1);
        }

        var curr_year = d.getFullYear();
        var curr_Hours = d.getHours();
        if (curr_Hours < 10) {
            curr_Hours = "0" + curr_Hours;
        }

        var curr_Minutes = d.getMinutes();
        if (curr_Minutes < 10) {
            curr_Minutes = "0" + curr_Minutes;
        }

        var date = curr_day + "/" + curr_month + "/" + curr_year + " " + curr_Hours + ":" + curr_Minutes;

        $("#txtTransportDate").val(date);

    }



    $("#step-2").css("display", "none");
    $("#step-3").css("display", "none");
    $(".ihtfields").css("display", "none");
    $("#txtIDNumber").val("");




    document.getElementById("txtLoginNameApp").readOnly = true;
    document.getElementById("txtLoginContactNoApp").readOnly = true;

    document.getElementById("txtLoginnameDscrg").readOnly = true;
    document.getElementById("txtContactNoDschrg").readOnly = true;

    document.getElementById("txtLoginNameiht").readOnly = true;
    document.getElementById("txtContactNoiht").readOnly = true;

    document.getElementById('ddlTransferReason').removeAttribute('disabled');
    $('#ddlTransferReason').removeClass('dropdown_area-disabled');
    $('#ddlTransferReason').addClass('dropdown_area');

    var OriginalDate = "";
    var OrignialMobility = 0;
    var OrignialCollectionPointID = 0;
    var OrignialDropPointID = 0;
    var RrginalEscort = 0;

   // $("#addbookingheading")[0].innerHTML = "Patient Details";

       if (type == 1) {
           $("#addbookingheading")[0].innerHTML = "Appointment Patient Details";
       } else if (type == 2) {
                $("#addbookingheading")[0].innerHTML = "Discharge Patient Details";
       } else if (type == 3) {
                $("#addbookingheading")[0].innerHTML = "HealthNET-IFT Patient Details";
       }



    $("#editBookingRefNo")[0].innerHTML = "";

    var caseid = base64_decode(getParameterByName("BID"));
    if (caseid > 0) {

        $("#addbookingheading")[0].innerHTML = "Edit Booking";
        document.getElementById('ddlTransferReason').setAttribute('disabled', 'true');
        $('#ddlTransferReason').removeClass('dropdown_area');
        $('#ddlTransferReason').addClass('dropdown_area-disabled');
        LoadCase();
        $("#btnCancelBooking").css("display", "block");
        $("#tab-3").removeClass("selectedtab");
        $("#tab-3").removeClass("tab");
        $("#tab-3").addClass("visitedtab");

        $("#tab-2").removeClass("selectedtab");
        $("#tab-2").removeClass("tab");
        $("#tab-2").addClass("visitedtab");

        $("#tab-4").removeClass("selectedtab");
        $("#tab-4").removeClass("tab");
        $("#tab-4").addClass("visitedtab");

        $(".loginName ").val(loginUserName);
        $(".loginContactNo").val(loginContactNo);



    }

    else {




        document.getElementById('ddlTransferReason').setAttribute('disabled', 'true');
        $('#ddlTransferReason').removeClass('dropdown_area');
        $('#ddlTransferReason').addClass('dropdown_area-disabled');

        if ($("#lnkNewAppt").attr('class') == "selectedtab")





        $(".ihtfields").css("display", "none");
        $(".appoimentPanel").css("display", "none");
        $(".dischangePanel").css("display", "none");
        $(".ihtPanel").css("display", "none");
        $(".loginName ").val(loginUserName);
        $(".loginContactNo").val(loginContactNo);
         
        LoadDistricts();
        LoadPatientCities();
        LoadAppointmentReasons();
        LoadMedicalRequirements();
        LoadPatientmobility();
    }
   // debugger;
    SetFacility();
    HideAJAXDivs();
    DisablePatientFields();



});

//This method sets selected patient
function setPatient(id) {

    $("#" + id + " " + ".normal-grid").addClass("normal-grid-selected");   //.siblings().removeClass("normal-grid-selected");
    previousSelectPatientID = currentSelectedPatientID;
    $("#" + previousSelectPatientID + " " + ".normal-grid").removeClass("normal-grid-selected");
    currentSelectedPatientID = id;
}

//This method sets selected patient
function setMovePatient(id) {

    $("#" + id + " " + ".normal-grid").addClass("normal-grid-selected");   //.siblings().removeClass("normal-grid-selected");
    previousSelectedTripID = currentSelectedTripEventID;
    $("#" + previousSelectedTripID + " " + ".normal-grid").removeClass("normal-grid-selected");
    currentSelectedTripEventID = id;

    alert(currentSelectedTripEventID);
}


//This method is called when page unloads
function unloadPage() {
    if ((unsaved) && ($("#step-5").css('display') == "none") && ($("#step-4").css('display') == "none")) {
        return "You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?";
    }
}


function GoBack()
{
    $("#btnPrevious").css("display", "block");
    $("#btnAdd").css("display", "block");
    $("#btnPreview").css("display", "block");
    $("#btnNext").css("display", "none");
    $("#btnResetPatient").css("display", "none");

    $("#step-1").css("display", "none");
    $("#step-2").css("display", "none");
    $("#step-3").css("display", "block");
    $("#step-4").css("display", "none");
    $("#addbookingheading")[0].innerHTML = "Appointment Destination Details";


}

function MovePatient()
{
    GetTransferableCases();


}


function SaveMovePatient()
{
    debugger;
    if ($('#ddlOtherAvailableDatesMove :selected').val() == 0) {
        $('#ddlOtherAvailableDatesMove').css("border", "1px solid #ff0000");
        return;
    }

    if (currentSelectedTripEventID == 0)
    {
        alert("Please select a patient to move.");
        return;
    }

    var e = document.getElementById("ddlOtherAvailableDatesMove");
    selectDate = e.options[e.selectedIndex].value;
    var selectDate = selectDate.split("-");
    var selectDate = selectDate[2] + '/' + selectDate[1] + '/' + selectDate[0];
      
    selectDate = selectDate + " " + "16:00";

    var baseUri = WebAPIURL + 'TransferBooking';
    var jsonData = JSON.stringify([currentSelectedTripEventID, selectDate, getUserID(), getUserID()]);
    currentSelectedTripEventID = 0;
    $.ajax({
            type: "Post",
            url: baseUri,
            data: jsonData,
            contentType: 'application/json; charset=utf-8',

            success: function (data) {
                
                if (data == 1) {
                    HidePatientsMoveWindow();
                    SaveCase();
                }
                else {
                    alert("Something went wrong while moving patient. Please contact system administrator.");
                }
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
}

function Proceed()
{
  
    var ddlControlCenter;
    var e = document.getElementById("ddlControlCenter");
    if (e.options.length > 0)
        ddlControlCenter = e.options[e.selectedIndex].value;
    else
        ddlControlCenter = 0;

    $("#ddlControlCenter").removeClass("redBorder");
    ReqControlCenter.style.display = "none";


    if (ddlControlCenter == 0) {
        $("#ddlControlCenter").addClass("redBorder");
        ReqControlCenter.style.display = "block";
    }
    else {
        HideControCentreWindow();
    }

}

// This method loads available appointment collection times
function LoadAppointmentTimes() {
    var pickPoint = 0;
    var dropPoint = 0;
    var pickFacility = 0;
    var dropfacility = 0;
    var pickWard = 0;
    var dropWard = 0;

    var rbHome = document.getElementById("rbHome").checked;

    var rbHomeDrop = document.getElementById("rbHomeDrop").checked;   //if home



    document.getElementById("ddlCollectionTimeApp").options.length = 0;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlCollectionTimeApp');


    var ddlControlCenter;
    var e = document.getElementById("ddlControlCenter");
    if (e.options.length > 0)
        ddlControlCenter = e.options[e.selectedIndex].value;
    else
        ddlControlCenter = 0;


    var collectionPoint;
    var e = document.getElementById("ddlwardcolectionpoint");
    if (e.options.length > 0)
        collectionPoint = e.options[e.selectedIndex].value;
    else
        collectionPoint = 0;

    var selectedDropWard;
    var e = document.getElementById("ddlDropClinic");
    if (e.options.length > 0)
        selectedDropWard = e.options[e.selectedIndex].value;
    else
        selectedDropWard = 0;


    var selectedPickFacility;
    var e = document.getElementById("ddlFacility");
    if (e.options.length > 0)
        selectedPickFacility = e.options[e.selectedIndex].value;
    else
        selectedPickFacility = 0;

    var selectedDropFacility;
    var e = document.getElementById("ddlDropHospital");
    if (e.options.length > 0)
        selectedDropFacility = e.options[e.selectedIndex].value;
    else
        selectedDropFacility = 0;


    if (rbHome) {
        pickPoint = collectionPoint;
    }
    else {
        pickWard = collectionPoint;
        pickFacility = selectedPickFacility
    }

    if (rbHomeDrop) {
        dropPoint = 0;
    }
    else {
        dropfacility = selectedDropFacility;
        dropWard = selectedDropWard;
    }

    var baseUri = WebAPIURL + 'LoadCollectionTimes';

    var jsonData = JSON.stringify([pickPoint, dropPoint, pickFacility, dropfacility, pickWard, dropWard, ddlControlCenter]);

    $.ajax({
        type: "Post",
        url: baseUri,
        async: false,
        data: jsonData,
        contentType: 'application/json; charset=utf-8',
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlCollectionTimeApp');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method loads available Dicharge collection times
function LoadDischargeTimes() {

    var pickPoint = 0;
    var dropPoint = 0;
    var pickFacility = 0;
    var dropfacility = 0;
    var pickWard = 0;
    var dropWard = 0;

    document.getElementById("ddlCollectionTimeDscg").options.length = 0;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlCollectionTimeDscg');


    var rbHome = document.getElementById("rbHome").checked;

    var rbHomeDrop = document.getElementById("rbHomeDrop").checked;   //if home


    var ddlControlCenter;
    var e = document.getElementById("ddlControlCenter");
    if (e.options.length > 0)
        ddlControlCenter = e.options[e.selectedIndex].value;
    else
        ddlControlCenter = 0;


    var collectionPoint;
    var e = document.getElementById("ddlwardcolectionpoint");
    if (e.options.length > 0)
        collectionPoint = e.options[e.selectedIndex].value;
    else
        collectionPoint = 0;

    var selectedPickFacility;
    var e = document.getElementById("ddlFacility");
    if (e.options.length > 0)
        selectedPickFacility = e.options[e.selectedIndex].value;
    else
        selectedPickFacility = 0;

    if (rbHome) {
        pickPoint = collectionPoint;
    }
    else {
        pickWard = collectionPoint;
        pickFacility = selectedPickFacility
    }

    var selectedDropWard;
    var e = document.getElementById("ddlDropWard");
    if (e.options.length > 0)
        selectedDropWard = e.options[e.selectedIndex].value;
    else
        selectedDropWard = 0;

    var selectedDropFacility;
    var e = document.getElementById("ddlDropFacility");
    if (e.options.length > 0)
        selectedDropFacility = e.options[e.selectedIndex].value;
    else
        selectedDropFacility = 0;

    if (rbHomeDrop) {
        dropPoint = selectedDropWard;
    }
    else {
        dropfacility = selectedDropFacility;
        dropWard = selectedDropWard;
    }

    var baseUri = WebAPIURL + 'LoadCollectionTimes';

    var jsonData = JSON.stringify([pickPoint, dropPoint, pickFacility, dropfacility, pickWard, dropWard, ddlControlCenter]);

    $.ajax({
        type: "Post",
        url: baseUri,
        async: false,
        data: jsonData,
        contentType: 'application/json; charset=utf-8',
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlCollectionTimeDscg');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method loads available IFT collection times
function LoadIFTTimes() {

    var pickPoint = 0;
    var dropPoint = 0;
    var pickFacility = 0;
    var dropfacility = 0;
    var pickWard = 0;
    var dropWard = 0;

    document.getElementById("ddlCollectionTimeift").options.length = 0;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlCollectionTimeift');

    var ddlControlCenter;
    var e = document.getElementById("ddlControlCenter");
    if (e.options.length > 0)
        ddlControlCenter = e.options[e.selectedIndex].value;
    else
        ddlControlCenter = 0;

    var collectionPoint;
    var e = document.getElementById("ddlwardcolectionpoint");
    if (e.options.length > 0)
        collectionPoint = e.options[e.selectedIndex].value;
    else
        collectionPoint = 0;

    var dropWard;
    var e = document.getElementById("ddlWardiht");
    if (e.options.length > 0)
        dropWard = e.options[e.selectedIndex].value;
    else
        dropWard = 0;


    var selectedPickFacility;
    var e = document.getElementById("ddlFacility");
    if (e.options.length > 0)
        selectedPickFacility = e.options[e.selectedIndex].value;
    else
        selectedPickFacility = 0;

    var selectedDropFacility;
    var e = document.getElementById("ddlFacilityiht");
    if (e.options.length > 0)
        selectedDropFacility = e.options[e.selectedIndex].value;
    else
        selectedDropFacility = 0;

    var rbHome = document.getElementById("rbHome").checked;

    var rbHomeDrop = document.getElementById("rbHomeDrop").checked;   //if home

    var baseUri = WebAPIURL + 'LoadCollectionTimes';

    var jsonData = JSON.stringify([pickPoint, dropPoint, selectedPickFacility, selectedDropFacility, collectionPoint, dropWard, ddlControlCenter]);

    $.ajax({
        type: "Post",
        url: baseUri,
        async: false,
        data: jsonData,
        contentType: 'application/json; charset=utf-8',
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlCollectionTimeift');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method takes user to first tab
function first() {
    if (($("#tab-1").attr('class') == "selectedtab") || ($("#tab-1").attr('class') == "visitedtab")) {
        $("#step-1").css("display", "block");
        $("#step-3").css("display", "none");
        $("#step-2").css("display", "none");
        $("#step-4").css("display", "none");

        if ($("#tab-3").attr('class') == "selectedtab") {
            $("#tab-3").removeClass("selectedtab");
            $("#tab-3").addClass("visitedtab");
        }

        if ($("#tab-4").attr('class') == "selectedtab") {
            $("#tab-4").removeClass("selectedtab");
            $("#tab-4").addClass("visitedtab");
        }

        if ($("#tab-2").attr('class') == "selectedtab") {
            $("#tab-2").removeClass("selectedtab");
            $("#tab-2").addClass("visitedtab");
        }

        $("#tab-1").removeClass("visitedtab");
        $("#tab-1").addClass("selectedtab");

        $("#btnPrevious").css("display", "none");
        $("#btnAdd").css("display", "none");
        $("#btnPreview").css("display", "none");
        $("#btnNext").css("display", "block");
        $("#btnResetPatient").css("display", "none");
    }
}

// This method takes user to second tab
function second() {
    if (($("#tab-2").attr('class') == "selectedtab") || ($("#tab-2").attr('class') == "visitedtab")) {
        $("#step-1").css("display", "none");
        $("#step-3").css("display", "none");
        $("#step-4").css("display", "none");
        $("#step-2").css("display", "block");
        $('#txtPatientName').onkeypress = validate;


        if ($("#tab-1").attr('class') == "selectedtab") {
            $("#tab-1").removeClass("selectedtab");
            $("#tab-1").addClass("visitedtab");
        }

        if ($("#tab-4").attr('class') == "selectedtab") {
            $("#tab-4").removeClass("selectedtab");
            $("#tab-4").addClass("visitedtab");
        }

        if ($("#tab-3").attr('class') == "selectedtab") {
            $("#tab-3").removeClass("selectedtab");
            $("#tab-3").addClass("visitedtab");
        }

        $("#tab-2").removeClass("visitedtab");
        $("#tab-2").addClass("selectedtab");

        $("#btnPrevious").css("display", "block");
        $("#btnAdd").css("display", "none");
        $("#btnPreview").css("display", "none");
        $("#btnNext").css("display", "block");
        $("#btnResetPatient").css("display", "block");
    }




}

// This method takes user to third tab
function third() {

    if (($("#tab-3").attr('class') == "selectedtab") || ($("#tab-3").attr('class') == "visitedtab")) {
        $("#step-1").css("display", "none");
        $("#step-2").css("display", "none");
        $("#step-3").css("display", "block");
        $("#step-4").css("display", "none");

        if ($("#tab-1").attr('class') == "selectedtab") {
            $("#tab-1").removeClass("selectedtab");
            $("#tab-1").addClass("visitedtab");
        }

        if ($("#tab-4").attr('class') == "selectedtab") {
            $("#tab-4").removeClass("selectedtab");
            $("#tab-4").addClass("visitedtab");
        }

        if ($("#tab-2").attr('class') == "selectedtab") {
            $("#tab-2").removeClass("selectedtab");
            $("#tab-2").addClass("visitedtab");
        }

        $("#tab-3").removeClass("visitedtab");
        $("#tab-3").addClass("selectedtab");

        $("#btnPrevious").css("display", "block");
        $("#btnAdd").css("display", "block");
        $("#btnPreview").css("display", "block");
        $("#btnNext").css("display", "none");
        $("#btnResetPatient").css("display", "none");
    }


}

// This method takes user to fourth tab
function fourth() {
    if (($("#tab-4").attr('class') == "selectedtab") || ($("#tab-4").attr('class') == "visitedtab")) {

        if (!validateone()) {
            $("#step-1").css("display", "block");
            $("#step-2").css("display", "none");
            $("#step-3").css("display", "none");
            $("#step-4").css("display", "none");
            return;
        }

        if (!validatetwo()) {
            $("#step-1").css("display", "none");
            $("#step-2").css("display", "block");
            $("#step-3").css("display", "none");
            $("#step-4").css("display", "none");
            return;

        }

        if (!validatethree()) {
            $("#step-1").css("display", "none");
            $("#step-2").css("display", "none");
            $("#step-3").css("display", "block");
            $("#step-4").css("display", "none");
            return;

        }




        $("#step-1").css("display", "none");
        $("#step-2").css("display", "none");
        $("#step-3").css("display", "none");
        Preview();
        //$("#step-4").css("display", "block");

        if ($("#tab-1").attr('class') == "selectedtab") {
            $("#tab-1").removeClass("selectedtab");
            $("#tab-1").addClass("visitedtab");
        }

        if ($("#tab-2").attr('class') == "selectedtab") {
            $("#tab-2").removeClass("selectedtab");
            $("#tab-2").addClass("visitedtab");
        }

        if ($("#tab-3").attr('class') == "selectedtab") {
            $("#tab-3").removeClass("selectedtab");
            $("#tab-3").addClass("visitedtab");
        }

        $("#tab-4").removeClass("visitedtab");
        $("#tab-4").addClass("selectedtab");

        $("#btnPrevious").css("display", "block");
        $("#btnAdd").css("display", "block");
        $("#btnPreview").css("display", "block");
        $("#btnNext").css("display", "none");
        $("#btnResetPatient").css("display", "none");
    }

}

// This method resets all tabs
function ResetTabs() {
    $("#step-1").css("display", "block");
    $("#step-3").css("display", "none");
    $("#step-2").css("display", "none");
    $("#step-4").css("display", "none");
    $("#step-5").css("display", "none");

    if ($("#tab-4").attr('class') == "selectedtab") {
        $("#tab-4").removeClass("selectedtab");
        $("#tab-4").addClass("tab");
    }

    if ($("#tab-4").attr('class') == "visitedtab") {
        $("#tab-4").removeClass("visitedtab");
        $("#tab-4").addClass("tab");
    }

    if ($("#tab-3").attr('class') == "selectedtab") {
        $("#tab-3").removeClass("selectedtab");
        $("#tab-3").addClass("tab");
    }

    if ($("#tab-3").attr('class') == "visitedtab") {
        $("#tab-3").removeClass("visitedtab");
        $("#tab-3").addClass("tab");
    }

    if ($("#tab-2").attr('class') == "selectedtab") {
        $("#tab-2").removeClass("selectedtab");
        $("#tab-2").addClass("visitedtab");
    }

    if ($("#tab-2").attr('class') == "visitedtab") {
        $("#tab-2").removeClass("visitedtab");
        $("#tab-2").addClass("tab");
    }


    $("#tab-1").removeClass("visitedtab");
    $("#tab-1").removeClass("tab");
    $("#tab-1").addClass("selectedtab");

    $("#btnResetPatient").css("display", "none");
    $("#btnPrevious").css("display", "none");
    $("#btnAdd").css("display", "none");
    $("#btnPreview").css("display", "none");
    $("#btnNext").css("display", "block");
}

// This method takes user to the next wizard step
function next() {

    if ($("#step-1").css("display") == "block") {

        if (validateone()) {
            $("#step-1").css("display", "none");
            $("#step-2").css("display", "block");
            $("#btnResetPatient").css("display", "block");
            $("#btnPrevious").css("display", "block");
            $("#tab-2").removeClass("tab");
            $("#tab-2").removeClass("visitedtab");
            $("#tab-2").addClass("selectedtab");
            $("#tab-1").removeClass("selectedtab");
            $("#tab-1").addClass("visitedtab");
            $('#txtPatientName').onkeypress = validate;

            if (type == 1) {
                $("#addbookingheading")[0].innerHTML = "Appointment Collection Details";
            } else if (type == 2) {
                $("#addbookingheading")[0].innerHTML = "Discharge Collection Details";
            } else if (type == 3) {
                $("#addbookingheading")[0].innerHTML = "IFT Collection Details";
            }

        }
    }

    else if ($("#step-2").css("display") == "block") {
        if (validatetwo()) {

            var caseid = base64_decode(getParameterByName("BID"));
            if (caseid < 0) {
                document.getElementById("rbFacilityDrop").checked = true;
            }
            $("#step-2").css("display", "none");
            $("#step-3").css("display", "block");
            $("#btnResetPatient").css("display", "none");
            $("#btnNext").css("display", "none");
            $("#btnAdd").css("display", "none");
            $("#btnPreview").css("display", "block");
            $("#btnPrevious").css("display", "block");
            $("#btnAdd").css("display", "block");
            $("#tab-3").removeClass("tab");
            $("#tab-3").removeClass("visitedtab");
            $("#tab-3").addClass("selectedtab");
            $("#tab-2").removeClass("selectedtab");
            $("#tab-2").addClass("visitedtab");
      
            if (type == 1) {
                $("#addbookingheading")[0].innerHTML = "Appointment Destination Details";
            } else if (type == 2) {
                $("#addbookingheading")[0].innerHTML = "Discharge Destination Details";
            } else if (type == 3) {
                $("#addbookingheading")[0].innerHTML = "IFT Destination Details";
            }
        }
    }

    else if ($("#step-3").css("display") == "block") {
        if (validatethree()) {
            $("#step-3").css("display", "none");
            $("#step-4").css("display", "block");
            Preview();
            $("#btnResetPatient").css("display", "none");
            $("#btnNext").css("display", "none");
            $("#btnAdd").css("display", "block");
            $("#btnPreview").css("display", "block");
            $("#btnPrevious").css("display", "block");

            $("#tab-4").removeClass("tab");
            $("#tab-4").removeClass("visitedtab");
            $("#tab-4").addClass("selectedtab");
            $("#tab-3").removeClass("selectedtab");
            $("#tab-3").addClass("visitedtab");
        }
    }

}

// This method takes user to the previous wizard step
function previous() {

    if ($("#step-2").css("display") == "block") {
        $("#step-2").css("display", "none");
        $("#step-1").css("display", "block");
        $("#btnPrevious").css("display", "none");
        $("#btnResetPatient").css("display", "none");
        $("#tab-2").removeClass("selectedtab");
        $("#tab-2").addClass("visitedtab");
        $("#tab-1").removeClass("visitedtab");
        $("#tab-1").addClass("selectedtab");

        if (type == 1) {
            $("#addbookingheading")[0].innerHTML = "Appointment Patient Details";
        } else if (type == 2) {
            $("#addbookingheading")[0].innerHTML = "Discharge Patient Details";
        } else if (type == 3) {
            $("#addbookingheading")[0].innerHTML = "HealthNET-IFT Patient Details";
        }




     //   $("#addbookingheading")[0].innerHTML = "Patient Details";

    }

    else if ($("#step-3").css("display") == "block") {
        $("#step-3").css("display", "none");
        $("#step-2").css("display", "block");
        $("#btnResetPatient").css("display", "block");

        $("#btnNext").css("display", "block");
        $("#btnAdd").css("display", "none");
        $("#btnPreview").css("display", "none");


        $("#tab-3").removeClass("selectedtab");
        $("#tab-3").addClass("visitedtab");
        $("#tab-2").removeClass("visitedtab");
        $("#tab-2").addClass("selectedtab");

        if (type == 1) {
            $("#addbookingheading")[0].innerHTML = "Appointment Collection Details";
        } else if (type == 2) {
            $("#addbookingheading")[0].innerHTML = "Discharge Collection Details";
        } else if (type == 3) {
            $("#addbookingheading")[0].innerHTML = "IFT Collection Details";
        }

    }

    else if ($("#step-4").css("display") == "block") {
        $("#step-4").css("display", "none");
        $("#step-3").css("display", "block");
        $("#btnResetPatient").css("display", "block");

        $("#btnNext").css("display", "block");
        $("#btnAdd").css("display", "none");
        $("#btnPreview").css("display", "none");


        $("#tab-4").removeClass("selectedtab");
        $("#tab-4").addClass("visitedtab");
        $("#tab-3").removeClass("visitedtab");
        $("#tab-3").addClass("selectedtab");

    }
}

// This method adds new booking
function Add() {
    if (!validateone()) {
        $("#step-1").css("display", "block");
        $("#step-2").css("display", "none");
        $("#step-3").css("display", "none");
        $("#step-4").css("display", "none");
        return;
    }

    if (!validatetwo()) {
        $("#step-1").css("display", "none");
        $("#step-2").css("display", "block");
        $("#step-3").css("display", "none");
        $("#step-4").css("display", "none");
        return;

    }

    if (!validatethree()) {
        $("#step-1").css("display", "none");
        $("#step-2").css("display", "none");
        $("#step-3").css("display", "block");
        $("#step-4").css("display", "none");
        return;

    }



    SaveCase();
}

// This method shows booking preview
function Preview() {
    // var dvBookingDetailPopup = document.getElementById("dvBookingDetailPopup");
    if (!validateone()) {
        $("#step-1").css("display", "block");
        $("#step-2").css("display", "none");
        $("#step-3").css("display", "none");
        $("#step-4").css("display", "none");

        if ($("#tab-3").attr('class') == "selectedtab") {
            $("#tab-3").removeClass("selectedtab");
            $("#tab-3").addClass("visitedtab");
        }

        if ($("#tab-4").attr('class') == "selectedtab") {
            $("#tab-4").removeClass("selectedtab");
            $("#tab-4").addClass("visitedtab");
        }

        if ($("#tab-2").attr('class') == "selectedtab") {
            $("#tab-2").removeClass("selectedtab");
            $("#tab-2").addClass("visitedtab");
        }

        $("#tab-1").removeClass("visitedtab");
        $("#tab-1").addClass("selectedtab");

        return;
    }

    if (!validatetwo()) {
        $("#step-1").css("display", "none");
        $("#step-2").css("display", "block");
        $("#step-3").css("display", "none");
        $("#step-4").css("display", "none");

        if ($("#tab-1").attr('class') == "selectedtab") {
            $("#tab-1").removeClass("selectedtab");
            $("#tab-1").addClass("visitedtab");
        }

        if ($("#tab-4").attr('class') == "selectedtab") {
            $("#tab-4").removeClass("selectedtab");
            $("#tab-4").addClass("visitedtab");
        }

        if ($("#tab-3").attr('class') == "selectedtab") {
            $("#tab-3").removeClass("selectedtab");
            $("#tab-3").addClass("visitedtab");
        }

        $("#tab-2").removeClass("visitedtab");
        $("#tab-2").addClass("selectedtab");
        return;

    }

    if (!validatethree()) {
        $("#step-1").css("display", "none");
        $("#step-2").css("display", "none");
        $("#step-3").css("display", "block");
        $("#step-4").css("display", "none");

        if ($("#tab-1").attr('class') == "selectedtab") {
            $("#tab-1").removeClass("selectedtab");
            $("#tab-1").addClass("visitedtab");
        }

        if ($("#tab-4").attr('class') == "selectedtab") {
            $("#tab-4").removeClass("selectedtab");
            $("#tab-4").addClass("visitedtab");
        }

        if ($("#tab-2").attr('class') == "selectedtab") {
            $("#tab-2").removeClass("selectedtab");
            $("#tab-2").addClass("visitedtab");
        }

        $("#tab-3").removeClass("visitedtab");
        $("#tab-3").addClass("selectedtab");
        return;

    }



    OpenWindow();
    ShowCase();
    // var dvBookingDetailPopup = $("#dvBookingDetailPopup").html();
    // $("#step-4").css("display", "block");
    // $("#step-4").html(dvBookingDetailPopup);
    // $("#step-1").css("display", "none");
    // $("#step-2").css("display", "none");
    // $("#step-3").css("display", "none");
    // $("#step-5").css("display", "none");
    //  OpenWindow();

}

// This method checks validation on first wizard step
function validatetwo() {

   // return true;

    var errorsCount = 0;

    var rbFacility = document.getElementById("rbFacility").checked;
    var rbHomeAddress = document.getElementById("rbHomeAddress").checked;
    var rbHome = document.getElementById("rbHome").checked;
    var e = document.getElementById("ddlTransferReason");
    var ddlTransferReason = e.options[e.selectedIndex].value;
    //var ddlSuburb;
    //var e = document.getElementById("ddlSuburb");
    //if (e.options.length > 0)
    //    ddlSuburb = e.options[e.selectedIndex].value;
    //else
    //    ddlSuburb = 0;

    var ddlHomeDistrict;
    var e = document.getElementById("ddlHomeDistrict");
    if (e.options.length > 0)
        ddlHomeDistrict = e.options[e.selectedIndex].value;
    else
        ddlHomeDistrict = 0;

    var ddlHomeTown;
    var e = document.getElementById("ddlHomeTown");
    if (e.options.length > 0)
        ddlHomeTown = e.options[e.selectedIndex].value;
    else
        ddlHomeTown = 0;

    var ddlCollectionDistrict;
    var e = document.getElementById("ddlCollectionDistrict");
    if (e.options.length > 0)
        ddlCollectionDistrict = e.options[e.selectedIndex].value;
    else
        ddlCollectionDistrict = 0;

    var ddlCollectionTown;
    var e = document.getElementById("ddlCollectionTown");
    if (e.options.length > 0)
        ddlCollectionTown = e.options[e.selectedIndex].value;
    else
        ddlCollectionTown = 0;

    //var ddlwardcolectionpoint;
    //var e = document.getElementById("ddlwardcolectionpoint");
    //if (e.options.length > 0)
    //    ddlwardcolectionpoint = e.options[e.selectedIndex].value;
    //else
    //    ddlwardcolectionpoint = 0;

    var ddlFacility;
    var e = document.getElementById("ddlFacility");
    if (e.options.length > 0)
        var ddlFacility = e.options[e.selectedIndex].value;
    else
        ddlFacility = 0;

    var ddlPatientMobility;
    var e = document.getElementById("ddlPatientMobility");
    if (e.options.length > 0)
        var ddlPatientMobility = e.options[e.selectedIndex].value;
    else
        ddlPatientMobility = 0;



    var ddlPatientEscort;
    var e = document.getElementById("ddlPatientEscort");
    ddlPatientEscort = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlAirTransport");
    var ddlAirTransport = e.options[e.selectedIndex].value;

    var txtTransportDate = $("#txtTransportDate").val();

    var txtHomeAddressLine1 = $("#txtHomeAddressLine1").val();
   
    ReqTranferReason.style.display = "none";

    ReqHomeDistrict.style.display = "none";
    ReqHomeTown.style.display = "none";
    ReqHomeAddressLine1.style.display = "none";
    ReqCollectionDistrict.style.display = "none";
    ReqCollectionTown.style.display = "none";
    ReqCollectionFacility.style.display = "none";
   // ReqWardCollectionPoint.style.display = "none";
    ReqTransportDate.style.display = "none";
    ReqPatientEscort.style.display = "none";
    ReqAirTransport.style.display = "none";
    ReqCollectionFacility.style.display = "none";
    ReqPatientMobility.style.display = "none";
    
    $("#ddlTransferReason").removeClass("redBorder");
    $("#ddlPatientMobility").removeClass("redBorder");
    $("#ddlHomeDistrict").removeClass("redBorder");
    $("#ddlHomeTown").removeClass("redBorder");
    $("#txtHomeAddressLine1").removeClass("redBorder");
    $("#ddlCollectionDistrict").removeClass("redBorder");
    $("#ddlCollectionTown").removeClass("redBorder");
    $("#ddlFacility").removeClass("redBorder");
  //  $("#ddlwardcolectionpoint").removeClass("redBorder");
    $("#ddlPatientEscort").removeClass("redBorder");
    $("#ddlAirTransport").removeClass("redBorder");
    $("#txtTransportDate").removeClass("redBorder");


    //if (ddlControlCenter == 0) {
    //    $("#ddlControlCenter").addClass("redBorder");
    //    ReqControlCenter.style.display = "inline-block";
    //    errorsCount++;
    //}

    //if (ddlTransferReason == 0) {
    //    $("#ddlTransferReason").addClass("redBorder");
    //    ReqTranferReason.style.display = "inline-block";
    //    errorsCount++;
    //}

    //if (ddlSuburb == 0) {
    //    $("#ddlSuburb").addClass("redBorder");
    //    ReqCollectionSuburb.style.display = "inline-block";
    //    errorsCount++;
    //}


    if ((ddlFacility == 0) && (rbFacility)) {
        $("#ddlFacility").addClass("redBorder");
        ReqCollectionFacility.style.display = "inline-block";
        errorsCount++;
    }

    if ((ddlHomeDistrict == 0) && (rbHomeAddress)) {
        $("#ddlHomeDistrict").addClass("redBorder");
        ReqHomeDistrict.style.display = "inline-block";
        errorsCount++;
    }


    if ((ddlHomeTown == 0) && (rbHomeAddress)) {
        $("#ddlHomeTown").addClass("redBorder");
        ReqHomeTown.style.display = "inline-block";
        errorsCount++;
    }


    if ((txtHomeAddressLine1 == "")  && (rbHomeAddress)) {
        $("#txtHomeAddressLine1").addClass("redBorder");
        ReqHomeAddressLine1.style.display = "inline-block";
        errorsCount++;
    }


    if (ddlCollectionDistrict == 0) {
        $("#ddlCollectionDistrict").addClass("redBorder");
        ReqCollectionDistrict.style.display = "inline-block";
        errorsCount++;
    }


    if (ddlPatientMobility == 0) {
        $("#ddlPatientMobility").addClass("redBorder");
        ReqPatientMobility.style.display = "inline-block";
        errorsCount++;
    }


    if (ddlCollectionTown == 0) {
        $("#ddlCollectionTown").addClass("redBorder");
        ReqCollectionTown.style.display = "inline-block";
        errorsCount++;
    }

    //if (ddlwardcolectionpoint == 0) {
    //    $("#ddlwardcolectionpoint").addClass("redBorder");
    //    ReqWardCollectionPoint.style.display = "inline-block";
    //    errorsCount++;
    //}

    if (ddlPatientEscort == 0) {
        $("#ddlPatientEscort").addClass("redBorder");
        ReqPatientEscort.style.display = "inline-block";
        errorsCount++;
    }

    if (ddlAirTransport == 0) {
        $("#ddlAirTransport").addClass("redBorder");
        ReqAirTransport.style.display = "inline-block";
        errorsCount++;
    }

    if (txtTransportDate == "") {
        $("#txtTransportDate").addClass("redBorder");
        ReqTransportDate.style.display = "inline-block";
        errorsCount++;
    }

    if (errorsCount > 0) {
        return false;
    }
    else {
        return true;
    }
}

// This method checks validation on second wizard step
function validateone() {
    var errorsCount = 0;

   // var txtIDNumber = $("#txtIDNumber").val();

   // var txtPMI = $("#txtPMI").val();

    var txtPatientName = $("#txtPatientName").val();

    var txtSurname = $("#txtSurname").val();

    var e = document.getElementById("ddlGender");
    var ddlGender = e.options[e.selectedIndex].value;

    var txtAge = $("#txtAge").val();

    var e = document.getElementById("ddlAgeType");
    var ddlAgeType = e.options[e.selectedIndex].value;

    var maxAge = 0;
    
    if (ddlAgeType == 4)
    {
        maxAge = 150;
    }

    else if (ddlAgeType == 3)
    {
        maxAge = 150 * 12;
    }

    else if (ddlAgeType == 2)
    {
        maxAge = 150 * 12 * 30;
    }

    else if (ddlAgeType == 1)
    {
        maxAge = 150 * 12 * 30 * 24;
    }



   // var txtPatientContactNo = $("#txtPatientContactNo").val();

  //  var txtPatientNextToKin = $("#txtPatientNextToKin").val();

  //  var txtNextOfKinContactNo = $("#txtPatientNextToKin").val();

    //var txtNextOfKinContactNoExt = $("#txtNextOfKinContactNoExt").val();

    var txtPatientContactNo = $("#txtPatientContactNo").val();

    var txtAddressLine1 = $("#txtAddressLine1").val();

    var txtAddressLine2 = $("#txtAddressLine2").val();



    //var ddlPatientSuburb;
    //var e = document.getElementById("ddlPatientSuburb");
    //if (e.options.length > 0)
    //    ddlPatientSuburb = e.options[e.selectedIndex].value;
    //else
    //    ddlPatientSuburb = 0;


    //var ddlPatientSuburb;
    //var e = document.getElementById("ddlPatientSuburb");
    //if (e.options.length > 0)
    //    ddlPatientSuburb = e.options[e.selectedIndex].value;
    //else
    //    ddlPatientSuburb = 0;

    var ddlCity;
    var e = document.getElementById("ddlCity");
    if (e.options.length > 0)
        ddlCity = e.options[e.selectedIndex].value;
    else
        ddlCity = 0;

   // ReqIDNumber.style.display = "none";
    //ReqPMI.style.display = "none";
    ReqName.style.display = "none";
    ReqSurname.style.display = "none";
    ReqGender.style.display = "none";
    ReqAge.style.display = "none";
    ReqContactNo.style.display = "none";
    ReqAddressLine1.style.display = "none";
    ReqAddressLine2.style.display = "none";
    ReqCity.style.display = "none";
   // ReqSuburb.style.display = "none";
  ////  ReqNextToKin.style.display = "none";
   // ReqNextOFKinContactNo.style.display = "none";

   // $("#txtIDNumber").removeClass("redBorder");
   // $("#txtPMI").removeClass("redBorder");
    $("#txtPatientName").removeClass("redBorder");
    $("#txtSurname").removeClass("redBorder");
    $("#ddlGender").removeClass("redBorder");
    $("#txtAge").removeClass("redBorder");
    $("#ddlAgeType").removeClass("redBorder");
    $("#txtPatientContactNo").removeClass("redBorder");
    $("#txtAddressLine1").removeClass("redBorder");
    $("#txtAddressLine2").removeClass("redBorder");
   // $("#ddlPatientSuburb").removeClass("redBorder");
    $("#ddlCity").removeClass("redBorder");
   // $("#txtPatientNextToKin").removeClass("redBorder");
   // $("#txtNextOfKinContactNo").removeClass("redBorder");


    //if (txtIDNumber == "") {
    //    $("#txtIDNumber").addClass("redBorder");
    //    ReqIDNumber.style.display = "inline-block";
    //    errorsCount++;
    //}


    //if (txtPMI == "") {
    //    $("#txtPMI").addClass("redBorder");
    //    ReqPMI.style.display = "inline-block";
    //    errorsCount++;
    //}

    if (txtPatientName == "") {
        $("#txtPatientName").addClass("redBorder");
        ReqName.style.display = "inline-block";
        errorsCount++;
    }

    if (txtSurname == "") {
        $("#txtSurname").addClass("redBorder");
        ReqSurname.style.display = "inline-block";
        errorsCount++;
    }

    if (ddlGender == 0) {
        $("#ddlGender").addClass("redBorder");
        ReqGender.style.display = "inline-block";
        errorsCount++;
    }

    if (txtAge == "") {
        $("#txtAge").addClass("redBorder");
        ReqAge.style.display = "inline-block";
        errorsCount++;
    }

    if (ddlAgeType == 0) {
        $("#ddlAgeType").addClass("redBorder");
        ReqAge.style.display = "inline-block";
        errorsCount++;
    }

    if ((parseInt(txtAge) > maxAge) && (ddlAgeType > 0))
    {
        alert("Patient's age cannot be more than 150 years.")
        $("#txtAge").addClass("redBorder");
        ReqAge.style.display = "inline-block";
        errorsCount++;
    }



    if (txtPatientContactNo == "") {
        $("#txtPatientContactNo").addClass("redBorder");
        ReqContactNo.style.display = "inline-block";
        errorsCount++;
    }

    //if (txtPatientNextToKin == "")
    //{
    //    $("#txtPatientNextToKin").addClass("redBorder");
    //    ReqNextToKin.style.display = "inline-block";
    //    errorsCount++;
    //}


    //if (txtNextOfKinContactNo == "") {
    //    $("#txtNextOfKinContactNo").addClass("redBorder");
    //    ReqNextOFKinContactNo.style.display = "inline-block";
    //    errorsCount++;
    //}

    //if (txtNextOfKinContactNoExt == "") {
    //    $("#txtNextOfKinContactNoExt").addClass("redBorder");
    //    ReqNextOFKinContactNo.style.display = "inline-block";
    //    errorsCount++;
    //}

    if (txtAddressLine1 == "") {
        $("#txtAddressLine1").addClass("redBorder");
        ReqAddressLine1.style.display = "inline-block";
        errorsCount++;
    }


    if (txtAddressLine2 == "") {
        $("#txtAddressLine2").addClass("redBorder");
        ReqAddressLine2.style.display = "inline-block";
        errorsCount++;
    }


    //if (ddlPatientSuburb == 0) {
    //    $("#ddlPatientSuburb").addClass("redBorder");
    //    ReqSuburb.style.display = "inline-block";
    //    errorsCount++;
    //}


    if (ddlCity == 0) {
        $("#ddlCity").addClass("redBorder");
        ReqCity.style.display = "inline-block";
        errorsCount++;
    }


    if (errorsCount > 0) {
        return false;
    }
    else {
        return true;
    }
}

// This method checks validation on third wizard step
function validatethree() {
    var errorsCount = 0;
    var e = document.getElementById("ddlTransferReason");
    var ddlTransferReason = e.options[e.selectedIndex].value;

    if (ddlTransferReason == 1)  // appt
    {






        errorsCount = 0;

        var ddlApptDropDistrict;
        var e = document.getElementById("ddlApptDropDistrict");
        if (e.options.length > 0)
            ddlApptDropDistrict = e.options[e.selectedIndex].value;
        else
            ddlApptDropDistrict = 0;


        var ddlApptDropTown;
        var e = document.getElementById("ddlApptDropTown");
        if (e.options.length > 0)
            ddlApptDropTown = e.options[e.selectedIndex].value;
        else
            ddlApptDropTown = 0;





        var ddlDropHospital;
        var e = document.getElementById("ddlDropHospital");
        if (e.options.length > 0)
            ddlDropHospital = e.options[e.selectedIndex].value;
        else
            ddlDropHospital = 0;

        //var ddlDropClinic;
        //var e = document.getElementById("ddlDropClinic");
        //if (e.options.length > 0)
        //    ddlDropClinic = e.options[e.selectedIndex].value;
        //else
        //    ddlDropClinic = 0;

        var ddlCollectionTimeApp;
        var e = document.getElementById("ddlCollectionTimeApp");
        if (e.options.length > 0)
            ddlCollectionTimeApp = e.options[e.selectedIndex].value;
        else
            ddlCollectionTimeApp = 0;

        var ddlAppointmentReason;
        var e = document.getElementById("ddlAppointmentReason");
        if (e.options.length > 0)
            ddlAppointmentReason = e.options[e.selectedIndex].value;
        else
            ddlAppointmentReason = 0;

        var txtNotesAppoiment = $("#txtNotesAppoiment").val();
        var txtLoginNameApp = $("#txtLoginNameApp").val();
        var txtLoginContactNoApp = $("#txtLoginContactNoApp").val();


        ReqApptDropDistrict.style.display = "none";
        ReqApptDropTown.style.display = "none";


        ReqDropHospital.style.display = "none";
       // ReqDropClinic.style.display = "none";
        ReqAppointmentReason.style.display = "none";
        ReqNotesAppoiment.style.display = "none";
        ReqLoginNameApp.style.display = "none";
        ReqLoginContactNoApp.style.display = "none";



        $("#ddlApptDropDistrict").removeClass("redBorder");
        $("#ddlApptDropTown").removeClass("redBorder");


        $("#ddlDropHospital").removeClass("redBorder");
       // $("#ddlDropClinic").removeClass("redBorder");
        $("#ddlAppointmentReason").removeClass("redBorder");
        $("#ddlCollectionTimeApp").removeClass("redBorder");


        if (ddlApptDropDistrict == 0) {
            $("#ddlApptDropDistrict").addClass("redBorder");
            ReqApptDropDistrict.style.display = "inline-block";
            errorsCount++;
        }


        if (ddlApptDropTown == 0) {
            $("#ddlApptDropTown").addClass("redBorder");
            ReqApptDropTown.style.display = "inline-block";
            errorsCount++;
        }


        if (ddlDropHospital == 0) {
            $("#ddlDropHospital").addClass("redBorder");
            ReqDropHospital.style.display = "inline-block";
            errorsCount++;
        }

        //if (ddlCollectionTimeApp == 0) {
        //    $("#ddlCollectionTimeApp").addClass("redBorder");
        //   ReqDropHospital.style.display = "inline-block";
        //    errorsCount++;
        //}

        //if (ddlDropClinic == 0) {
        //    $("#ddlDropClinic").addClass("redBorder");
        //    ReqDropClinic.style.display = "inline-block";
        //    errorsCount++;
        //}

        if (ddlAppointmentReason == 0) {
            $("#ddlAppointmentReason").addClass("redBorder");
            ReqAppointmentReason.style.display = "inline-block";
            errorsCount++;
        }

    }
    else if (ddlTransferReason == 2)  // disrg
    {
        errorsCount = 0;

        var rbDropFacility = document.getElementById("rbFacilityDrop").checked;
        var rbHomeDropAddress = document.getElementById("rbHomeDropAddress").checked;
        var rbHomeDrop = document.getElementById("rbHomeDrop").checked;



        var ddlHomeDropDistrictDscg;
        var e = document.getElementById("ddlHomeDropDistrictDscg");
        if (e.options.length > 0)
            ddlHomeDropDistrictDscg = e.options[e.selectedIndex].value;
        else
            ddlHomeDropDistrictDscg = 0;

        var ddlHomeDropTownDscg;
        var e = document.getElementById("ddlHomeDropTownDscg");
        if (e.options.length > 0)
            ddlHomeDropTownDscg = e.options[e.selectedIndex].value;
        else
            ddlHomeDropTownDscg = 0;





        var ddlDropDistrictDscg;
        var e = document.getElementById("ddlDropDistrictDscg");
        if (e.options.length > 0)
            ddlDropDistrictDscg = e.options[e.selectedIndex].value;
        else
            ddlDropDistrictDscg = 0;

        var ddlDropTownDscg;
        var e = document.getElementById("ddlDropTownDscg");
        if (e.options.length > 0)
            ddlDropTownDscg = e.options[e.selectedIndex].value;
        else
            ddlDropTownDscg = 0;

        var ddlDropFacility;
        var e = document.getElementById("ddlDropFacility");
        if (e.options.length > 0)
            ddlDropFacility = e.options[e.selectedIndex].value;
        else
            ddlDropFacility = 0;


        //var ddlDropWard;
        //var e = document.getElementById("ddlDropWard");
        //if (e.options.length > 0)
        //    ddlDropWard = e.options[e.selectedIndex].value;
        //else
        //    ddlDropWard = 0;


        //var ddlCollectionTimeDscg;
        //var e = document.getElementById("ddlCollectionTimeDscg");
        //if (e.options.length > 0)
        //    ddlCollectionTimeDscg = e.options[e.selectedIndex].value;
        //else
        //    ddlCollectionTimeDscg = 0;


        var ddlFollowup;
        var e = document.getElementById("ddlFollowup");
        if (e.options.length > 0)
            ddlFollowup = e.options[e.selectedIndex].value;
        else
            ddlFollowup = 0;

        var txtNotesDischage = $("#txtNotesDischage").val();
        var txtHomeDropAddressLine1 = $("#txtHomeDropAddressLine1").val();
        var txtLoginnameDscrg = $("#txtLoginnameDscrg").val();
        var txtContactNoDschrg = $("#txtContactNoDschrg").val();



        ReqHomeDropDistrictDscg.style.display = "none";
        ReqHomeDropTownDscg.style.display = "none";
        ReqHomeDropAddressLine1.style.display = "none";



        ReqDropDistrictDscg.style.display = "none";
        ReqDropTownDscg.style.display = "none";
        ReqDropFacility.style.display = "none";
      //  ReqDropWard.style.display = "none";
        ReqFollowup.style.display = "none";
        ReqLoginnameDscrg.style.display = "none";
        ReqContactNoDschrg.style.display = "none";

        $("#ddlHomeDropDistrictDscg").removeClass("redBorder");
        $("#ddlHomeDropTownDscg").removeClass("redBorder");
        $("#txtHomeDropAddressLine1").removeClass("redBorder");
        $("#ddlDropDistrictDscg").removeClass("redBorder");
        $("#ddlDropTownDscg").removeClass("redBorder");
        $("#ddlDropFacility").removeClass("redBorder");
       // $("#ddlDropWard").removeClass("redBorder");
        $("#ddlFollowup").removeClass("redBorder");
        $("#ddlCollectionTimeDscg").removeClass("redBorder");
        $("#txtHomeDropAddressLine1").removeClass("redBorder");


        if ((ddlHomeDropDistrictDscg == 0) && (rbHomeDropAddress)) {
            $("#ddlHomeDropDistrictDscg").addClass("redBorder");
            ReqHomeDropDistrictDscg.style.display = "inline-block";
            errorsCount++;
        }

        if ((ddlHomeDropTownDscg == 0) && (rbHomeDropAddress)) {
            $("#ddlHomeDropTownDscg").addClass("redBorder");
            ReqHomeDropTownDscg.style.display = "inline-block";
            errorsCount++;
        }

        if ((txtHomeDropAddressLine1 == "") && (rbHomeDropAddress)) {
            $("#txtHomeDropAddressLine1").addClass("redBorder");
            ReqHomeDropAddressLine1.style.display = "inline-block";
            errorsCount++;
        }

        if (ddlDropDistrictDscg == 0) {
            $("#ddlDropDistrictDscg").addClass("redBorder");
            ReqDropDistrictDscg.style.display = "inline-block";
            errorsCount++;
        }

        if (ddlDropTownDscg == 0) {
            $("#ddlDropTownDscg").addClass("redBorder");
            ReqDropTownDscg.style.display = "inline-block";
            errorsCount++;
        }

        if ((ddlDropFacility == 0) && (rbDropFacility)) {
            $("#ddlDropFacility").addClass("redBorder");
            ReqDropFacility.style.display = "inline-block";
            errorsCount++;
        }


        //if (ddlDropWard == 0) {
        //    $("#ddlDropWard").addClass("redBorder");
        //    ReqDropWard.style.display = "inline-block";
        //    errorsCount++;
        //}

        //if (ddlCollectionTimeDscg == 0) {
        //    $("#ddlCollectionTimeDscg").addClass("redBorder");
        //    ReqDropWard.style.display = "inline-block";
        //    errorsCount++;
        //}


        if (ddlFollowup == 0) {
            $("#ddlFollowup").addClass("redBorder");
            ReqFollowup.style.display = "inline-block";
            errorsCount++;
        }


    }
    else if (ddlTransferReason == 3)  // iht
    {
        errorsCount = 0;




      





        var ddlDropDistrictiht;
        var e = document.getElementById("ddlDropDistrictiht");
        if (e.options.length > 0)
            ddlDropDistrictiht = e.options[e.selectedIndex].value;
        else
            ddlDropDistrictiht = 0;

        var ddlDropTowniht;
        var e = document.getElementById("ddlDropTowniht");
        if (e.options.length > 0)
            ddlDropTowniht = e.options[e.selectedIndex].value;
        else
            ddlDropTowniht = 0;





        var ddlFacilityiht;
        var e = document.getElementById("ddlFacilityiht");
        if (e.options.length > 0)
            ddlFacilityiht = e.options[e.selectedIndex].value;
        else
            ddlFacilityiht = 0;

        //var ddlWardiht;
        //var e = document.getElementById("ddlWardiht");
        //if (e.options.length > 0)
        //    ddlWardiht = e.options[e.selectedIndex].value;
        //else
        //    ddlWardiht = 0;


        //var ddlCollectionTimeift;
        //var e = document.getElementById("ddlCollectionTimeift");
        //if (e.options.length > 0)
        //    ddlCollectionTimeift = e.options[e.selectedIndex].value;
        //else
        //    ddlCollectionTimeift = 0;


        var ddlAppointmentReasoniht;
        var e = document.getElementById("ddlAppointmentReasoniht");
        if (e.options.length > 0)
            ddlAppointmentReasoniht = e.options[e.selectedIndex].value;
        else
            ddlAppointmentReasoniht = 0;

        var txtReceivingContactNo = $("#txtReceivingContactNo").val();
        var TextareaNotesIht = $("#TextareaNotesIht").val();
        var txtLoginNameiht = $("#txtLoginNameiht").val();
        var txtContactNoiht = $("#txtContactNoiht").val();




        ReqDropDistrictiht.style.display = "none";
        ReqDropTowniht.style.display = "none";

        ReqFacilityiht.style.display = "none";
       // ReqWardiht.style.display = "none";
        ReqAppointmentReasoniht.style.display = "none";
        ReqReceivingContactNo.style.display = "none";
        ReqTextareaNotesIht.style.display = "none";
        // ReqLoginNameiht.style.display = "none";
        // ReqContactNoiht.style.display = "none";


        $("#ddlDropDistrictiht").removeClass("redBorder");
        $("#ddlDropTowniht").removeClass("redBorder");

        $("#ddlFacilityiht").removeClass("redBorder");
       // $("#ddlWardiht").removeClass("redBorder");
        $("#ddlAppointmentReasoniht").removeClass("redBorder");
        $("#txtReceivingContactNo").removeClass("redBorder");
        $("#ddlCollectionTimeift").removeClass("redBorder");

        if (ddlDropDistrictiht == 0) {
            $("#ddlDropDistrictiht").addClass("redBorder");
            ReqDropDistrictiht.style.display = "inline-block";
            errorsCount++;
        }

        if (ddlDropTowniht == 0) {
            $("#ddlDropTowniht").addClass("redBorder");
            ReqDropTowniht.style.display = "inline-block";
            errorsCount++;
        }

        if (ddlFacilityiht == 0) {
            $("#ddlFacilityiht").addClass("redBorder");
            ReqFacilityiht.style.display = "inline-block";
            errorsCount++;
        }

        //if (ddlWardiht == 0) {
        //    $("#ddlWardiht").addClass("redBorder");
        //    ReqWardiht.style.display = "inline-block";
        //    errorsCount++;
        //}

        //if (ddlCollectionTimeift == 0) {
        //    $("#ddlCollectionTimeift").addClass("redBorder");
        //   ReqWardiht.style.display = "inline-block";
        //    errorsCount++;
        //}

        if (ddlAppointmentReasoniht == 0) {
            $("#ddlAppointmentReasoniht").addClass("redBorder");
            ReqAppointmentReasoniht.style.display = "inline-block";
            errorsCount++;
        }

        if (txtReceivingContactNo == "") {
            $("#txtReceivingContactNo").addClass("redBorder");
            ReqReceivingContactNo.style.display = "inline-block";
            errorsCount++;
        }

    }

    if (errorsCount > 0) {
        return false;
    }
    else {
        // SaveCase();
        return true;
    }
}


function DisablePatientFields()
{
    var patientID = $("#txtPatientID").val();

    if (parseInt(patientID) > 0) {
        debugger;
        document.getElementById("txtIDNumber").readOnly = true;

        document.getElementById("txtPMI").readOnly = true;

        document.getElementById("txtPatientName").readOnly = true;

        document.getElementById("txtSurname").readOnly = true;

        document.getElementById("ddlGender").disabled = true;

        document.getElementById("txtAge").readOnly = true;

        document.getElementById("ddlAgeType").disabled = true;

        document.getElementById("ddlCommunicalbleDisease").disabled = true;

        document.getElementById("txtPatientNextToKin").readOnly = true;

        document.getElementById("txtNextOfKinContactNo").readOnly = true;
    }
    else {
        document.getElementById("txtIDNumber").readOnly = false;

        document.getElementById("txtPMI").readOnly = false;

        document.getElementById("txtPatientName").readOnly = false;

        document.getElementById("txtSurname").readOnly = false;

        document.getElementById("ddlGender").removeAttribute('disabled')

        document.getElementById("txtAge").readOnly = false;

        document.getElementById("ddlAgeType").removeAttribute('disabled')

        document.getElementById("ddlCommunicalbleDisease").removeAttribute('disabled')

        document.getElementById("txtPatientNextToKin").readOnly = false;

        document.getElementById("txtNextOfKinContactNo").readOnly = false;
    }


    }




// This method opens a new popup
function OpenWindow() {
    ShowFadedDiv();
    var dvViewPopDetail = document.getElementById("dvViewPopDetail");
    dvBookingDetailPopup.style.zIndex = 201;
    dvBookingDetailPopup.style.top = "15px";
    dvBookingDetailPopup.style.height = ($(window).height() - 30) + "px";
    dvViewPopDetail.style.height = ($(window).height() - 70) + "px";
    //dvViewPopDetail.style.overflow = "auto";
    dvBookingDetailPopup.style.position = 'fixed';
    //dvBookingDetailPopup.innerHTML = "<center><img src='../Content/themes/base/images/AJAXloading.gif' width='48px' height='48px' /></center>";

    var dvBookingDetailHeader = document.getElementById("dvBookingDetailHeader");
    dvBookingDetailHeader.style.marginTop = "10px";
    $("#dvBookingDetailPopup").fadeIn("slow");


    $("#dvCancelBookingPopup").css("display", "none");




}

// restrcit emergency booking 
function checkAppBeforeHours() {

    if ($("#ddlCollectionTimeApp option:selected").val() != 0) {
        var collectHours = $("#ddlCollectionTimeApp option:selected").text().split(':')[0];
        var blockedHours = EmergencyBookingBeforeHours % 24;
        if (blockedHours > collectHours) {
            alert("Booking at this time is not allowed.");
            return false;
        }
    }
}

// restrcit emergency booking 
function checkDscgBeforeHours() {

    if ($("#ddlCollectionTimeDscg option:selected").val() != 0) {
        var collectHours = $("#ddlCollectionTimeDscg option:selected").text().split(':')[0];
        var blockedHours = EmergencyBookingBeforeHours % 24;
        if (blockedHours > collectHours) {
            alert("Booking at this time is not allowed.");
            return false;
        }
    }
}

// This method trims special characters
function TrimSpecialCharacters(e) {

    var keycode = (window.event) ? event.keyCode : e.keyCode;
   // alert(keycode);
    if (e.which < 48 ||
   (e.which > 57 && e.which < 65) ||
   (e.which > 90 && e.which < 97) ||
   (e.which > 122)) {
        e.preventDefault();
    }

}

Array.prototype.indexOf = Array.prototype.indexOf || function (searchElement) {
    "use strict";
    if (this == null) {
        throw new TypeError();
    }
    var t = Object(this);
    var len = t.length >>> 0;
    if (len === 0) {
        return -1;
    }
    var n = 0;
    if (arguments.length > 1) {
        n = Number(arguments[1]);
        if (n != n) { // shortcut for verifying if it's NaN
            n = 0;
        } else if (n != 0 && n != Infinity && n != -Infinity) {
            n = (n > 0 || -1) * Math.floor(Math.abs(n));
        }
    }
    if (n >= len) {
        return -1;
    }
    var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);
    for (; k < len; k++) {
        if (k in t && t[k] === searchElement) {
            return k;
        }
    }
    return -1;
}

//document.querySelector('#txtPatientName').onkeypress = validate;

// This method loads case info for preview
function ShowCase() {
    // alert($("#dvPopupHeading").innerHTML);//    .css("display", "none");//  [0].textContent = "Booking Preview";
    // $(".dvPopupHeader").css("display", "none");
    // $("#dvBookingDetailHeader").css("margin-top", "20px");
    //  document.getElementById('dvBookingDetailHeader').setAttribute('margin-top', '20px');

    var smedreq = "";
    var medicalrequirements = $("#dmedicalRequirement input:checkbox:checked").map(function () {
        return $(this).next().text();
    }).get();

    for (var i = 0; i < medicalrequirements.length; i++) {
        if (i > 0) {
            smedreq = smedreq + ",";
        }
        smedreq = smedreq + medicalrequirements[i];
    }

    smedreq = CutBigWords(smedreq, 75);

    var e = document.getElementById("ddlControlCenter");
    var ddlControlCenter = e.options[e.selectedIndex].text;

    var e = document.getElementById("ddlTransferReason");
    var ddlTransferReason = e.options[e.selectedIndex].text;

    var e = document.getElementById("ddlSuburb");
    var ddlSuburb = e.options[e.selectedIndex].text;

    ddlSuburb = CutBigWords(ddlSuburb, 40);

    var collectionAddressType = 0;

    var rbHome = document.getElementById("rbHome").checked;

    var rbHomeAddress = document.getElementById("rbHomeAddress").checked;

    var rbFacility = document.getElementById("rbFacility").checked;

    if (rbHomeAddress) {
        collectionAddressType = 1;
    }
    else if (rbHome) {
        collectionAddressType = 2;
    }
    else if (rbFacility) {
        collectionAddressType = 3;
    }
    else {
        collectionAddressType = 3;
    }

    var e = document.getElementById("ddlCollectionDistrict");
    var ddlCollectionDistrict = e.options[e.selectedIndex].Text;

    var e = document.getElementById("ddlCollectionTown");
    var ddlCollectionTown = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlwardcolectionpoint");
    var ddlwardcolectionpoint = e.options[e.selectedIndex].Text;

    if (collectionAddressType == 3) {
        var e = document.getElementById("ddlFacility");
        var ddlFacility = e.options[e.selectedIndex].text;
    }

    //new fields >>
    var ddlHomeDistrict = "";
    var ddlHomeTown = "";
    var ddlHomeSuburb = "";
    var txtHomeAddressLine1 = "";
    var txtHomeAddressLine2 = "";
    //new fields <<

    if (collectionAddressType == 1) {

        $(".vpatientAddressDetails").css("display", "block");

        $("#dvBookingDetailHeader").css("height", "470px");

        var e = document.getElementById("ddlHomeDistrict");
        if (e.options.length > 0)
            ddlHomeDistrict = e.options[e.selectedIndex].Text;
        else
            ddlHomeDistrict = 0;

        var e = document.getElementById("ddlHomeTown");
        if (e.options.length > 0)
            ddlHomeTown = e.options[e.selectedIndex].Text;
        else
            ddlHomeTown = 0;

        var e = document.getElementById("ddlHomeSuburb");
        if (e.options.length > 0)
            ddlHomeSuburb = e.options[e.selectedIndex].Text;
        else
            ddlHomeSuburb = 0;

        txtHomeAddressLine1 = $("#txtHomeAddressLine1").val();
        txtHomeAddressLine2 = $("#txtClinician").val();
    }

    var e = document.getElementById("ddlPatientMobility");
    var ddlPatientMobility = e.options[e.selectedIndex].text;

    var e = document.getElementById("ddlPatientEscort");
    var ddlPatientEscort = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlAirTransport");
    var ddlAirTransport = e.options[e.selectedIndex].value;

    var txtTransportDate = $("#txtTransportDate").val();
    var txtReferringPerson = $("#txtReferringPerson").val();
    var txtContactNo = $("#txtContactNo").val();
    var txtClinician = $("#txtClinician").val();

    //patient
    var txtIDNumber = $("#txtIDNumber").val();
    var txtPMI = $("#txtPMI").val();
    var txtPatientName = $("#txtPatientName").val();
    var txtSurname = $("#txtSurname").val();

    var e = document.getElementById("ddlGender");
    var ddlGender = e.options[e.selectedIndex].value;;
    var txtAge = $("#txtAge").val();
    var e = document.getElementById("ddlAgeType");
    var ddlAgeType = e.options[e.selectedIndex].text;
    var txtPatientContactNo = $("#txtPatientContactNo").val();
    var txtAddressLine1 = $("#txtAddressLine1").val();
    var txtAddressLine2 = $("#txtAddressLine2").val();

    var e = document.getElementById("ddlPatientSuburb");
    var ddlPatientSuburb = e.options[e.selectedIndex].text; // document.getElementById("ddlPatientSuburb").options[e.selectedIndex].value;
    ddlPatientSuburb = CutBigWords(ddlPatientSuburb, 30);

    var e = document.getElementById("ddlCity");
    var ddlCity = e.options[e.selectedIndex].text; //e.options[e.selectedIndex].value;

    var callSourceID = 2;
    var e = document.getElementById("ddlGender");
    var ddlGender = e.options[e.selectedIndex].value;
    var txtAge = $("#txtAge").val();
    var e = document.getElementById("ddlAgeType");
    var ddlAgeType = e.options[e.selectedIndex].text;
    var txtPatientContactNo = $("#txtPatientContactNo").val();
    var txtAddressLine1 = $("#txtAddressLine1").val();

    // patient new fields
    var e = document.getElementById("ddlCommunicalbleDisease");
    var ddlCommunicalbleDisease = e.options[e.selectedIndex].Text;
    var txtPatientNextToKin = $("#txtPatientNextToKin").val();
    var txtNextOfKinContactNo = $("#txtNextOfKinContactNo").val();
    // patient new fields



    //drop booking details

    //appt
    if (ddlTransferReason == "Appointment") {

        var e = document.getElementById("ddlApptDropDistrict");
        var ddlDropDistrict = e.options[e.selectedIndex].text;
        var e = document.getElementById("ddlApptDropTown");
        var ddlDropTown = e.options[e.selectedIndex].text;

        var e = document.getElementById("ddlDropHospital");
        var ddlDropHospital = e.options[e.selectedIndex].text;
        var e = document.getElementById("ddlDropClinic");
        var ddlDropClinic = e.options[e.selectedIndex].text;
        var e = document.getElementById("ddlAppointmentReason");
        var ddlAppointmentReason = e.options[e.selectedIndex].text;
        var txtNotesAppoiment = $("#txtNotesAppoiment").val();
        var txtLoginNameApp = $("#txtLoginNameApp").val();
        var txtLoginContactNoApp = $("#txtLoginContactNoApp").val();
        emergencyBooking = document.getElementById("chkEmergencyBooking").checked;   //if emergency booking
        if (emergencyBooking == 1) {
            $("#dvBookingType").html("Emergency");
        }
        else {
            $("#dvBookingType").html("Non Emergency");
        }

    }

    //discharge
    if (ddlTransferReason == "Discharge") {


        var e = document.getElementById("ddlDropDistrictDscg");
        var ddlDropDistrict = e.options[e.selectedIndex].text;
        var e = document.getElementById("ddlDropTownDscg");
        var ddlDropTown = e.options[e.selectedIndex].text;

        //var e = document.getElementById("ddlDropCity");
        //var ddlDistrict = e.options[e.selectedIndex].text; //   e.options[e.selectedIndex].value;   //drop district
        var rbHomeDrop = document.getElementById("rbHomeDrop").checked;   //if home
        var e = document.getElementById("ddlDropSuburb");
        var ddlDropSuburb = e.options[e.selectedIndex].text;     // itown
        var ddlDropHospital = 0;
        var e = document.getElementById("ddlDropFacility");
        if (e.options.length > 0) {
            ddlDropHospital = e.options[e.selectedIndex].text;
        }
        var e = document.getElementById("ddlDropWard");
        var ddlDropClinic = e.options[e.selectedIndex].text;
        var e = document.getElementById("ddlFollowup");
        var ddlFollowup = e.options[e.selectedIndex].text;   // follow
        var txtNotesAppoiment = $("#txtNotesDischage").val();
        var txtLoginNameApp = $("#txtLoginnameDscrg").val();
        var txtLoginContactNoApp = $("#txtContactNoDschrg").val();

        emergencyBooking = document.getElementById("chkEmergencyBookingDisc").checked;   //if emergency booking
        if (emergencyBooking == 1) {
            $("#dvBookingType").html("Emergency");
        }
        else {
            $("#dvBookingType").html("Non Emergency");
        }

    }

    //iht
    if (ddlTransferReason == "IFT") {


        var e = document.getElementById("ddlDropDistrictiht");
        var ddlDropDistrict = e.options[e.selectedIndex].text;
        var e = document.getElementById("ddlDropTowniht");
        var ddlDropTown = e.options[e.selectedIndex].text;


        var e = document.getElementById("ddlFacilityiht");
        var ddlDropHospital = e.options[e.selectedIndex].text;
        var e = document.getElementById("ddlWardiht");
        var ddlDropClinic = e.options[e.selectedIndex].text;
        var e = document.getElementById("ddlAppointmentReasoniht");
        var ddlAppointmentReason = e.options[e.selectedIndex].text;
        var txtReceivingContactNo = $("#txtReceivingContactNo").val();
        var tdMedicalRequirement = smedreq;
        var txtNotesAppoiment = $("#TextareaNotesIht").val();
        var txtLoginNameApp = $("#txtLoginNameiht").val();
        var txtLoginContactNoApp = $("#txtContactNoiht").val();

    }

    var loginUserID = getCookie("UserID");

    $("#dvControlCenter").html(ddlControlCenter);
    $("#dvTransferReason").html(ddlTransferReason);
    $("#dvCollectionSuburb").html(ddlSuburb);
    $("#dvFacility").html(ddlFacility);
    $("#dvPatientMobility").html(ddlPatientMobility);
    $("#dvTransferDate").html(txtTransportDate);
    var rbHome = document.getElementById("rbHome").checked;

    if (rbHome) {
        $("#dvCollectFrom").html("Home");
    }
    else {
        $("#dvCollectFrom").html("Facility");
    }



    $("#dvCollectionPoint").html(ddlwardcolectionpoint);

    if (ddlPatientEscort == "1") {
        $("#dvEscort").html("Yes");
    }
    else {
        $("#dvEscort").html("No");
    }

    if (ddlAirTransport == "1") {
        $("#dvAirTransport").html("Yes");
    }
    else {
        $("#dvAirTransport").html("No");
    }

    $("#dvPatientID").html(txtIDNumber);
    $("#dvPMI").html(CutBigWords(txtPMI, 25))
    $("#dvName").html(CutBigWords(txtPatientName, 25));
    $("#dvSurname").html(CutBigWords(txtSurname, 25));

    if (ddlGender == "1") {
        $("#dvGender").html("Male");
    }
    else {
        $("#dvGender").html("Female");
    }


    $("#dvAge").html(txtAge + " " + ddlAgeType);

    $("#dvContactNo").html(CutBigWords(txtPatientContactNo, 25));
    $("#dvAddressLine1").html(CutBigWords(txtAddressLine1, 25));
    $("#dvAddressLine2").html(CutBigWords(txtAddressLine2, 25));
    $("#dvCity").html(ddlCity);
    $("#dvTab2Suburb").html(ddlPatientSuburb);

    if (ddlTransferReason == "Appointment") {
        $("#dvTab3Appointment").css("display", "block");
        $("#dvTab3Discharge").css("display", "none");
        $("#dvTab3BookingDrop").css("display", "none");


        $("#dvTab3Facility").html(ddlDropHospital);
        $("#dvWardDropPoint").html(ddlDropClinic);
        $("#dvAppointmentReason").html(ddlAppointmentReason);
        $("#dvNotes").html(CutBigWords(txtNotesAppoiment, 25));
        $("#dvTab3Name").html(txtLoginNameApp);
        $("#dvTab3ContactNo").html(txtLoginContactNoApp);

        $("#dvRefferingPerson").css("display", "none");
        $("#dvTab1ContactNo").css("display", "none");
        $("#dvClinician").css("display", "none");

    }
    else if (ddlTransferReason == "Discharge") {
        $("#dvTab3Appointment").css("display", "none");
        $("#dvTab3BookingDrop").css("display", "none");
        $("#dvTab3Discharge").css("display", "block");


        $("#dvCityTown").html(ddlDistrict);
        $("#dvTab3Suburb1").html(ddlDropSuburb);

        var rbHomeDrop = document.getElementById("rbHomeDrop").checked;   //if home
        if (rbHomeDrop) {
            $("#dvToHomeorHospital").html("Home");
        }
        else {
            $("#dvToHomeorHospital").html("Hospital");
        }

        $("#dvTab3Facility1").html(ddlDropHospital);
        $("#dvWardDropPoint1").html(ddlDropClinic);

        if (ddlFollowup == "1") {
            $("#dvFollowup").html("Yes");
        }
        else {
            $("#dvFollowup").html("No");
        }

        $("#dvTab3Notes2").html(CutBigWords(txtNotesAppoiment, 25));
        $("#dvTab3Name1").html(txtLoginNameApp);
        $("#dvTab3ContactNo1").html(txtLoginContactNoApp);

        $("#dvRefferingPerson").css("display", "none");
        $("#dvTab1ContactNo").css("display", "none");
        $("#dvClinician").css("display", "none");
    }
    else if (ddlTransferReason == "IFT") {

        $("#dvTab3Appointment").css("display", "none");
        $("#dvTab3Discharge").css("display", "none");
        $("#dvTab3BookingDrop").css("display", "block");
        $("#dvTab3Facility3").html(ddlDropHospital);
        $("#dvTab3Ward3").html(ddlDropClinic);
        $("#dvTab3AppointmentReason").html(ddlAppointmentReason);
        $("#dvTab3Notes3").html(CutBigWords(txtNotesAppoiment, 25));
        $("#dvTab3Name3").html(txtLoginNameApp);
        $("#dvTab3ContactNo3").html(txtLoginContactNoApp);
        $("#dvTab3ReceivingContactNo3").html(CutBigWords(txtReceivingContactNo, 25));
        $("#dvMedicalRequirment").html(tdMedicalRequirement);
        $("#dvRefferingPerson").css("display", "block");
        $("#dvTab1ContactNo").css("display", "block");
        $("#dvClinician").css("display", "block");
        $("#dvRefferingPerson").html(txtReferringPerson);
        $("#dvTab1ContactNo").html(txtContactNo);
        $("#dvClinician").html(txtClinician);
    }

}

// This method hides popup
function HideWindow() {
    var fadedDiv = document.getElementById("fadedDiv");
    fadedDiv.style.display = "none";
    var dvBookingDetailPopup = document.getElementById("dvBookingDetailPopup");
    dvBookingDetailPopup.style.display = "none";
}

// This method checks if input is number only
function isNumberKey(evt) {

    var charCode = (evt.which) ? evt.which : event.keyCode;
    if (charCode != 46 && charCode > 31
      && (charCode < 48 || charCode > 57))
        return false;

    return true;
}

// This method validates chracters
function validate(e) {
    var charCode = (e.which) ? e.which : event.keyCode;
    //alert(charCode);
    if (charCode < 48 ||
     (charCode > 57 && charCode < 65) ||
     (charCode > 90 && charCode < 97) ||
     (charCode > 122)) {
        if ((charCode != 8) && (charCode != 45) && (charCode != 39))
            return false;
    }
    else {
        return true;
    }
}

// This method loads saved case
function LoadCase() {
    var caseid = base64_decode(getParameterByName("BID"));
    var baseUri = WebAPIURL + 'LoadOnlineBookingCaseByID/' + caseid;
    $.ajax({
        type: "GET",
        url: baseUri,
        contentType: "json",
        dataType: "json",
        async: false,
        success: function (data) {

          
            var refNo = data.ReferenceNo;

            $("#addbookingheading")[0].innerHTML = "Edit Booking" + " (" + refNo + ")";

           // $("#editBookingRefNo")[0].innerHTML = "(" + refNo + ")";

            var ddlControlCenter = data.ControlCenterID;

            var ddlTransferReason = data.BookingType;

            var ddlPickCityID = data.PickCityID;

            var ddlDropCityID = data.DropCityID;

            var IsEmergencyBooking = data.IsEmergencyBooking;

            var ddlSuburb = data.BookingTripEvent.PickSubrubID;

            TripEventID = data.BookingTripEvent.TripEventID;

           // var rbHome = data.BookingTripEventDetail.CollectFromHome;

            var ddlwardcolectionpoint = data.BookingTripEventDetail.ReferringWardID;

            var ddlFacility = data.BookingTripEventDetail.ReferringFacilityID;

            var ddlPatientMobility = data.BookingTripEventDetail.PatientMobilityID;

            var ddlPatientEscort = data.BookingTripEventDetail.EscortRequired;

            var ddlAirTransport = data.BookingTripEventDetail.SuitableForAirTransport;

            var txtTransportDate = data.BookingDateTimeString;

            var txtReferringPerson = data.BookingTripEventDetail.ReferringPerson;

            var txtContactNo = data.BookingTripEventDetail.ReferringPhoneNo;

            var txtClinician = data.BookingTripEventDetail.ReferringClinician;



            //patient
            var PatientID = data.BookingPatient.PatientID;

            var txtIDNumber = data.BookingPatient.RegistrationID;

            var txtPMI = data.BookingPatient.PMI;

            var txtPatientName = data.BookingPatient.Name;

            var txtSurname = data.BookingPatient.SurName;

            var ddlGender = data.BookingPatient.Gender;

            var txtAge = data.BookingPatient.Age;

            var ddlAgeType = data.BookingPatient.AgeUnit;

            var txtPatientContactNo = data.BookingPatient.PhoneNo1;

            var txtAddressLine1 = data.BookingPatient.AddressLine1;

            var txtAddressLine2 = data.BookingPatient.AddressLine2;

            var ddlPatientSuburb = data.BookingPatient.SubrubID;

            var ddlCity = data.BookingPatient.CityID;

            //new fields >>
            var IsCommunicableDisease = data.BookingPatient.IsCommunicableDisease;

            var NextOfKin = data.BookingPatient.NextofKin;

            var NextOfKinContactNo = data.BookingPatient.NextofKinContactNo;
            // new fields <<

            var PickDistrictMunicipalityID = data.BookingTripEvent.PickDistrictMunicipalityID;

            var DropDistrictMunicipalityID = data.BookingTripEvent.DropDistrictMunicipalityID;

            var dropCity = data.BookingTripEvent.DropCityID;

          //  var rbHomeDrop = data.BookingTripEventDetail.DropAtHome;

            var ddlDropSuburb = data.BookingTripEvent.DropSubrubID;

            // new fields >>
            var PickAddressLine1 = data.BookingTripEvent.PickAddressLine1;

            var PickAddressLine2 = data.BookingTripEvent.PickAddressLine2;

            var DropAddressLine1 = data.BookingTripEvent.DropAddressLine1;

            var DropAddressLine2 = data.BookingTripEvent.DropAddressLine2;


            // new fields



            var ddlDropHospital = data.BookingTripEventDetail.ReceivingFacilityID;

            var ReceiveingPhoneNo = data.BookingTripEventDetail.ReceivingPhoneNo

            var ReceivingWardID = data.BookingTripEventDetail.ReceivingWardID;

            var ddlFollowup = data.BookingTripEventDetail.FollowupRequired;

            var txtNotesAppoiment = data.BookingTripEventDetail.EscortNotes;

            var ReceivingPerson = data.BookingTripEventDetail.ReceivingPerson;

            var ReceivingClinician = data.BookingTripEventDetail.ReceivingClinician;

            //new fields >>

            var CollectionDistrictMucipalityID = data.BookingTripEventDetail.CollectionDistrictMucipalityID

            var DestinationDistrictMucipalityID = data.BookingTripEventDetail.DestinationDistrictMucipalityID;

            var CollectionCityID = data.BookingTripEventDetail.CollectionCityID;

            var DestinationCityID = data.BookingTripEventDetail.DestinationCityID;

            var CollectAddressType = data.BookingTripEventDetail.CollectAddressType;

            var DropAddressType = data.BookingTripEventDetail.DropAddressType;

            //new fields <<
            

            var ddlAppointmentReason = data.BookingTripEvent.TripEventSubTypeID;

            var medicalrequirement = data.MedicalRequirementIDs;


            var TripEventMedicalRequirements = data.TripEventMedicalRequirementIDs;

            var txtLoginNameApp = loginUserName;

            var txtLoginContactNoApp = loginContactNo;

            currentFacility = ddlFacility;
            currentDropFacility = ddlDropHospital;

            //LoadControlCenters();

            //var e = document.getElementById('ddlControlCenter');

            //var opts = e.options;
            //for (var opt, j = 0; j < e.options.length, opt = opts[j]; j++) {
            //    if (opt.value == ddlControlCenter) {
            //        e.selectedIndex = j;
            //        j = e.options.length + 1;
            //    }
            //}

            if (CollectAddressType == 1)
            {
                document.getElementById('ddlFacility').setAttribute('disabled', 'true');
                $('.HomeAddressFields').css('display', '');
                $('#ddlFacility').removeClass('dropdown_area');
                $('#ddlFacility').addClass('dropdown_area-disabled');
                $('#lblWard').text('Collection Point: *');
                document.getElementById("rbHomeAddress").checked = true;
                document.getElementById("rbHome").checked = false;
                document.getElementById("rbFacility").checked = false;
            }

            else if (CollectAddressType == 2)
            {
                document.getElementById('ddlFacility').setAttribute('disabled', 'true');
                $('#ddlFacility').removeClass('dropdown_area');
                $('.HomeAddressFields').css('display', 'none');
                $('#ddlFacility').addClass('dropdown_area-disabled');
                $('#lblWard').text('Collection Point: *');
                document.getElementById("rbHomeAddress").checked = false;
                document.getElementById("rbHome").checked = true;
                document.getElementById("rbFacility").checked = false;
            }

            else if (CollectAddressType == 3)
            {
                document.getElementById('ddlFacility').removeAttribute('disabled');
                $('.HomeAddressFields').css('display', 'none');
                $('#ddlFacility').removeClass('dropdown_area-disabled');
                $('#ddlFacility').addClass('dropdown_area'); $('#lblWard').text('Ward/Clinic: *');
                document.getElementById("rbHomeAddress").checked = false;
                document.getElementById("rbHome").checked = false;
                document.getElementById("rbFacility").checked = true;
            }



            LoadDistricts();
            var e = document.getElementById('ddlCollectionDistrict');
            var opts = e.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value == CollectionDistrictMucipalityID) {
                    e.selectedIndex = j;
                    break;
                }
            }

            LoadDistrictCities(1);
            var e = document.getElementById('ddlCollectionTown');
            var opts = e.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value == CollectionCityID) {
                    e.selectedIndex = j;
                    break;
                }
            }








            if (CollectAddressType != 3) {
                ddlwardcolectionpoint = data.BookingTripEventDetail.CollectionPointID;
            }

            //LoadSubUrbs();
            //var e = document.getElementById('ddlSuburb');
            //var opts = e.options;
            //for (var opt, j = 0; opt = opts[j]; j++) {
            //    if (opt.value == ddlSuburb) {
            //        e.selectedIndex = j;
            //        break;
            //    }
            //}

            if (e.selectedIndex > 0) {

                if (CollectAddressType == 3) {

                    document.getElementById('ddlFacility').options.length = 0;
                    LoadWards();
                    var e = document.getElementById('ddlFacility');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == ddlFacility) {
                            e.selectedIndex = j;
                            break;
                        }
                    }
                }
                else {
                    document.getElementById('ddlFacility').setAttribute('disabled', 'true');
                    $('#ddlFacility').removeClass('dropdown_area');
                    $('#ddlFacility').addClass('dropdown_area-disabled');
                    $('#lblWard').text('Collection Point: *')
                }
            }



            var e = document.getElementById('ddlTransferReason');
            var opts = e.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value == ddlTransferReason) {
                    e.selectedIndex = j;
                    break;
                }
            }


            if (CollectAddressType == 1)
            {
                var e = document.getElementById('ddlHomeDistrict');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == PickDistrictMunicipalityID) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                LoadDistrictCities(2);
                var e = document.getElementById('ddlHomeTown');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlPickCityID) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                LoadSubUrbs();
                var e = document.getElementById('ddlHomeSuburb');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlSuburb) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                $("#txtHomeAddressLine1").val(PickAddressLine1);

                $("#txtHomeAddressLine2").val(PickAddressLine2);

            }


            if (ddlTransferReason == 3) {

                ChangelnkSelection(25);
                $("#wizard div#step-1 ").css("background-color", "#c1eefe");
                $("#wizard div#step-2 ").css("background-color", "#c1eefe");
                $("#wizard div#step-3 ").css("background-color", "#c1eefe");
                $("#wizard div#step-4 ").css("background-color", "#c1eefe");
                $("#wizard  .button-empty-div").css("background-color", "#c1eefe");

                $(".ihtfields").css("display", "");
                $(".appoimentPanel").css("display", "none");
                $(".dischangePanel").css("display", "none");
                $(".ihtPanel").css("display", "inline");
                document.getElementById('rbFacility').checked = true;
                document.getElementById('rbHome').checked = false;
                document.getElementById('rbFacility').disabled = true;
                document.getElementById('rbHome').disabled = true;
                document.getElementById('rbHomeAddress').disabled = true;
                document.getElementById('rbHomeAddress').checked = false;
                

                document.getElementById('ddlFacility').removeAttribute('disabled')
                $(".loginName").val(loginUserName);
                $(".loginContactNo").val(loginContactNo);
            }
            else if (ddlTransferReason == 2) {
                ChangelnkSelection(24);
                $("#wizard div#step-1 ").css("background-color", "#ded7fd");
                $("#wizard div#step-2 ").css("background-color", "#ded7fd");
                $("#wizard div#step-3 ").css("background-color", "#ded7fd");
                $("#wizard div#step-4 ").css("background-color", "#ded7fd");
                $("#wizard  .button-empty-div").css("background-color", "#ded7fd");

                $(".ihtfields").css("display", "none");
                $(".appoimentPanel").css("display", "none");
                $(".dischangePanel").css("display", "inline");
                $(".ihtPanel").css("display", "none");

                document.getElementById('rbFacility').checked = true;
                document.getElementById('rbHome').checked = false;
                document.getElementById('rbFacility').disabled = true;
                document.getElementById('rbHome').disabled = true;
                document.getElementById('rbHomeAddress').disabled = true;
                document.getElementById('rbHomeAddress').checked = false;
                document.getElementById('ddlFacility').removeAttribute('disabled')
                $(".loginName").val(loginUserName);
                $(".loginContactNo").val(loginContactNo);
            }
            else if (ddlTransferReason == 1) {
                ChangelnkSelection(4);
                $("#wizard div#step-1 ").css("background-color", "#fdefd7");
                $("#wizard div#step-2 ").css("background-color", "#fdefd7");
                $("#wizard div#step-3 ").css("background-color", "#fdefd7");
                $("#wizard div#step-4 ").css("background-color", "#fdefd7");
                $("#wizard  .button-empty-div").css("background-color", "#fdefd7");

                $(".appoimentPanel").css("display", "inline");
                $(".dischangePanel").css("display", "none");
                $(".ihtPanel").css("display", "none");

                //document.getElementById('rbFacility').checked = true;
                //document.getElementById('rbHome').checked = false;
                //document.getElementById('rbFacility').disabled = false;
                //document.getElementById('rbHome').disabled = false;
                //document.getElementById('ddlFacility').removeAttribute('disabled');
                $(".loginName").val(loginUserName);
                $(".loginContactNo").val(loginContactNo);

            }

            //document.getElementById("rbHome").checked = rbHome;

            //document.getElementById("rbFacility").checked = !rbHome;

          //  var e = document.getElementById('ddlSuburb');
            if (e.selectedIndex > 0) {
                LoadWards();

                var e = document.getElementById('ddlwardcolectionpoint');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlwardcolectionpoint) {
                        e.selectedIndex = j;
                        break;
                    }
                }
            }

            LoadPatientmobility();
            var e = document.getElementById('ddlPatientMobility');
            var opts = e.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value == ddlPatientMobility) {
                    e.selectedIndex = j;
                    break;
                }
            }

            // patient escort

            var e = document.getElementById('ddlPatientEscort');

            if (ddlPatientEscort) {
                e.selectedIndex = 1;
            }
            else {
                e.selectedIndex = 2;
            }


            // air transport

            var e = document.getElementById('ddlAirTransport');

            if (ddlAirTransport) {
                e.selectedIndex = 1;
            }
            else {
                e.selectedIndex = 2;
            }



            var txtTransportDate = txtTransportDate.split(' ');
            var bookingTime = txtTransportDate[1];

            $("#txtTransportDate").val(txtTransportDate[0]);



            // Patient

            $("#txtPatientID").val(PatientID);

            $("#txtIDNumber").val(txtIDNumber);

            $("#txtPMI").val(txtPMI);

            $("#txtPatientName").val(txtPatientName);

            $("#txtSurname").val(txtSurname);


            var e = document.getElementById('ddlGender');
            var opts = e.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value == ddlGender) {
                    e.selectedIndex = j;
                    break;
                }
            }

            $("#txtAge").val(txtAge);

            var e = document.getElementById('ddlAgeType');
            var opts = e.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value == ddlAgeType) {
                    e.selectedIndex = j;
                    break;
                }
            }

            $("#txtPatientContactNo").val(txtPatientContactNo);

            $("#txtAddressLine1").val(txtAddressLine1);

            $("#txtAddressLine2").val(txtAddressLine2);

            LoadPatientCities();
            var e = document.getElementById('ddlCity');
            var opts = e.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value == ddlCity) {
                    e.selectedIndex = j;
                    break;
                }
            }

            LoadCitySuburbs();
            var e = document.getElementById('ddlPatientSuburb');
            var opts = e.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value == ddlPatientSuburb) {
                    e.selectedIndex = j;
                    break;
                }
            }

            var e = document.getElementById('ddlCommunicalbleDisease');
            var opts = e.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value == IsCommunicableDisease) {
                    e.selectedIndex = j;
                    break;
                }
            }

            $("#txtPatientNextToKin").val(NextOfKin);

            $("#txtNextOfKinContactNo").val(NextOfKinContactNo);




            
            // third screen
            if (ddlTransferReason == 1) {
                LoadDropCities();
                var e = document.getElementById('ddlApptDropDistrict');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == DestinationDistrictMucipalityID) {
                        e.selectedIndex = j;
                        break;
                    }
                }


                LoadDistrictCities(3);
                var e = document.getElementById('ddlApptDropTown');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == DestinationCityID) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                LoadDropFacility();
                var e = document.getElementById('ddlDropHospital');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlDropHospital) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                LoadDropWards();
                var e = document.getElementById('ddlDropClinic');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ReceivingWardID) {
                        e.selectedIndex = j;
                        break;
                    }
                }


                //LoadAppointmentTimes();

                //var e = document.getElementById('ddlCollectionTimeApp');
                //var opts = e.options;
                //for (var opt, j = 0; opt = opts[j]; j++) {
                //    if (opt.value == bookingTime) {
                //        e.selectedIndex = j;
                //        break;
                //    }
                //}

                $("#txtTransportDate").val(data.BookingDateTimeString);


                //$("#txtTransportDate").val(txtTransportDate[0]);

                //var e = document.getElementById('ddlCollectionTimeApp');
                //var opts = e.options;
                //for (var opt, j = 0; opt = opts[j]; j++) {
                //    if (opt.value == txtTransportDate[0]) {
                //        e.selectedIndex = j;
                //        break;
                //    }
                //}

                document.getElementById("chkEmergencyBooking").checked = IsEmergencyBooking;

                LoadAppointmentReasons();
                var e = document.getElementById('ddlAppointmentReason');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlAppointmentReason) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                $("#txtNotesAppoiment").val(txtNotesAppoiment)
                $("#txtLoginNameApp").val(txtLoginNameApp);
                $("#txtLoginContactNoApp").val(txtLoginContactNoApp)
            }

            else if (ddlTransferReason == 2) {


                if (DropAddressType == 1) {
                    document.getElementById('ddlDropFacility').setAttribute('disabled', 'true');
                    $('.DropHomeAddressFields').css('display', '');
                    $('#ddlDropFacility').removeClass('dropdown_area');
                    $('#ddlDropFacility').addClass('dropdown_area-disabled');
                    $('#lblDropWard').text('Drop Point:');
                    document.getElementById("rbHomeDropAddress").checked = true;
                    document.getElementById("rbHomeDrop").checked = false;
                    document.getElementById("rbFacilityDrop").checked = false;
                }

                else if (DropAddressType == 2) {
                    document.getElementById('ddlDropFacility').setAttribute('disabled', 'true');
                    $('#ddlDropFacility').removeClass('dropdown_area');
                    $('.DropHomeAddressFields').css('display', 'none');
                    $('#ddlDropFacility').addClass('dropdown_area-disabled');
                    $('#lblDropWard').text('Drop Point: *');
                    document.getElementById("rbHomeDropAddress").checked = false;
                    document.getElementById("rbHomeDrop").checked = true;
                    document.getElementById("rbFacilityDrop").checked = false;
                }

                else if (DropAddressType == 3) {
                    javascript: document.getElementById('ddlDropFacility').removeAttribute('disabled');
                    $('#ddlDropFacility').removeClass('dropdown_area-disabled');
                    $('.DropHomeAddressFields').css('display', 'none');
                    $('#ddlDropFacility').addClass('dropdown_area'); $('#lblDropWard').text('Ward/Clinic: *');
                    document.getElementById("rbHomeDropAddress").checked = false;
                    document.getElementById("rbHomeDrop").checked = false;
                    document.getElementById("rbFacilityDrop").checked = true;
                    


                }

                if (DropAddressType != 3) {
                    ReceivingWardID = data.BookingTripEventDetail.DropPointID;
                }


         
                document.getElementById("chkEmergencyBookingDisc").checked = IsEmergencyBooking;   //if emergency
                
                var e = document.getElementById('ddlDropDistrictDscg');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == DestinationDistrictMucipalityID) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                LoadDistrictCities(4)
                var e = document.getElementById('ddlDropTownDscg');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == DestinationCityID) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                //LoadDropSuburbs();
                //var e = document.getElementById('ddlDropSuburb');
                //var opts = e.options;
                //for (var opt, j = 0; opt = opts[j]; j++) {
                //    if (opt.value == ddlDropSuburb) {
                //        e.selectedIndex = j;
                //        break;
                //    }
                //}

                if (DropAddressType == 3) {
                    LoadDropFacilityDischarge();
                    var e = document.getElementById('ddlDropFacility');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == ddlDropHospital) {
                            e.selectedIndex = j;
                            break;
                        }
                    }
                }

                LoadDropWardsDischarge();
                var e = document.getElementById('ddlDropWard');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ReceivingWardID) {
                        e.selectedIndex = j;
                        break;
                    }
                }



                if (DropAddressType == 1) {
                    var e = document.getElementById('ddlHomeDropDistrictDscg');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == DropDistrictMunicipalityID) {
                            e.selectedIndex = j;
                            break;
                        }
                    }

                    LoadDistrictCities(6)
                    var e = document.getElementById('ddlHomeDropTownDscg');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == ddlDropCityID) {
                            e.selectedIndex = j;
                            break;
                        }
                    }

                    LoadDropSuburbs();
                    var e = document.getElementById('ddlHomeDropSuburb');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == ddlDropSuburb) {
                            e.selectedIndex = j;
                            break;
                        }
                    }

                    $("#txtHomeDropAddressLine1").val(DropAddressLine1);

                    $("#txtHomeDropAddressLine2").val(DropAddressLine2);


                }




                
                $("#txtTransportDate").val(data.BookingDateTimeString);


                if (ddlFollowup) {
                    ddlFollowup = 1;
                }
                else {
                    ddlFollowup = 2;
                }

                var e = document.getElementById('ddlFollowup');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlFollowup) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                $("#txtNotesDischage").val(txtNotesAppoiment);
                $("#txtLoginnameDscrg").val(txtLoginNameApp);
                $("#txtContactNoDschrg").val(txtLoginContactNoApp);
            }

            else if (ddlTransferReason == 3) {

                $("#txtTransportDate").val(data.BookingDateTimeString);

                SetFacility();

                $("#txtReferringPerson").val(txtReferringPerson);

                $("#txtContactNo").val(txtContactNo);

                $("#txtClinician").val(txtClinician);

                LoadDropCities();
                var e = document.getElementById('ddlDropDistrictiht');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == DestinationDistrictMucipalityID) {
                        e.selectedIndex = j;
                        break;
                    }
                }


                LoadDistrictCities(5);
                var e = document.getElementById('ddlDropTowniht');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == DestinationCityID) {
                        e.selectedIndex = j;
                        break;
                    }
                }


                LoadMedicalRequirements();


                if (medicalrequirement != null) {
                    var medicalrequirement = medicalrequirement.split(',');
                    TripEventMedicalRequirements = TripEventMedicalRequirements.split(',');

                    for (i = 0; i < medicalrequirement.length; i++) {
                        $('#dmedicalRequirement input[type=checkbox]').each(function () {
                            var sThisVal = (this.checked ? $(this).val() : "");
                            var medicalreq = $(this).val().split(',');
                            if (medicalreq[0] == medicalrequirement[i]) {
                                this.checked = true;
                                $(this).val(medicalreq[0] + "," + TripEventMedicalRequirements[i] + "," + "0");
                            }
                            //   else {
                            //       $(this).val($(this).val() + "," + "0" + "," + "0")
                            //   }

                        });
                    }
                }

                LoadFacilityIht();
                var e = document.getElementById('ddlFacilityiht');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlDropHospital) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                LoadWardsIht();

                var e = document.getElementById('ddlWardiht');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ReceivingWardID) {
                        e.selectedIndex = j;
                        break;
                    }
                }

               // LoadIFTTimes();

                //var e = document.getElementById('ddlCollectionTimeift');
                //var opts = e.options;
                //for (var opt, j = 0; opt = opts[j]; j++) {
                //    if (opt.value == bookingTime) {
                //        e.selectedIndex = j;
                //        break;
                //    }
                //}

                //$("#txtTransportDate").val(txtTransportDate[0]);

                //var e = document.getElementById('ddlCollectionTimeift');
                //var opts = e.options;
                //for (var opt, j = 0; opt = opts[j]; j++) {
                //    if (opt.value == txtTransportDate[0]) {
                //        e.selectedIndex = j;
                //        break;
                //    }
                //}

                LoadAppointmentReasons();
                var e = document.getElementById('ddlAppointmentReasoniht');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlAppointmentReason) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                // Load Medical Requirements
                $("#txtReceivingPerson").val(ReceivingPerson);
                $("#txtReceivingClinician").val(ReceivingClinician);

                $("#txtReceivingContactNo").val(ReceiveingPhoneNo);
                $("#TextareaNotesIht").val(txtNotesAppoiment);
                $("#txtLoginNameiht").val(txtLoginNameApp);
                $("#txtContactNoiht").val(txtLoginContactNoApp);

            }

            OriginalDate = txtTransportDate;
            OrignialMobility = ddlPatientMobility;
            OrignialCollectionPointID = ddlwardcolectionpoint;
            OrignialDropPointID = ReceivingWardID;
            ORrginalEscort = ddlPatientEscort;

        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });



}

// This method gets query string parameters by name
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

// This method loads PTS system settings
function LoadPTSSystemSettings() {

    $.ajax({
        type: "GET",
        async: false,
        url: WebAPIURL + 'GetPTSSystemSettings',
        contentType: "json",
        dataType: "json",
        success: function (data) {
            if (data != null) {
                NormalBookingBeforeHours = data.PTSNormalBookingBeforeHours;
                EmergencyBookingBeforeHours = data.PTSEmergencyBookingBeforeHours;
                AdvanceBookingDays = data.AdvanceBookingDays;
            }
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method Loads control centres authorized to the user
function LoadControlCenters() {
    document.getElementById("ddlControlCenter").options.length = 0;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlControlCenter');
    $.ajax({
        type: "GET",
        async: false,
        url: WebAPIURL + 'LoadControlCenters/' + getUserID(),
        contentType: "json",
        dataType: "json",
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlControlCenter');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}


// 
function LoadDistrictCities(type) {

    if (type == 1) {
        document.getElementById("ddlCollectionTown").options.length = 0;
        var e = document.getElementById("ddlCollectionDistrict");
        var selectedDistrict = e.options[e.selectedIndex].value;
        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlCollectionTown');
        $.ajax({
            type: "GET",
            async: false,
            url: WebAPIURL + 'LoadDistrictCities/' + selectedDistrict,
            contentType: "json",
            dataType: "json",
            beforeSend: function () {
                $("#ILoaderTown")[0].style.display = "block";
            },
            complete: function () {
                $("#ILoaderTown")[0].style.display = "none";
            },
            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlCollectionTown');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }

    if (type == 2) {
        document.getElementById("ddlHomeTown").options.length = 0;
        var e = document.getElementById("ddlHomeDistrict");
        var selectedDistrict = e.options[e.selectedIndex].value;
        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlHomeTown');
        $.ajax({
            type: "GET",
            async: false,
            url: WebAPIURL + 'LoadDistrictCities/' + selectedDistrict,
            contentType: "json",
            dataType: "json",
            beforeSend: function () {
                $("#ILoaderTown")[0].style.display = "block";
            },
            complete: function () {
                $("#ILoaderTown")[0].style.display = "none";
            },
            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlHomeTown');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }


    if (type == 3) {
        document.getElementById("ddlApptDropTown").options.length = 0;
        var e = document.getElementById("ddlApptDropDistrict");
        var selectedDistrict = e.options[e.selectedIndex].value;
        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlApptDropTown');
        $.ajax({
            type: "GET",
            async: false,
            url: WebAPIURL + 'LoadDistrictCities/' + selectedDistrict,
            contentType: "json",
            dataType: "json",
            beforeSend: function () {
                $("#ILoaderTown")[0].style.display = "block";
            },
            complete: function () {
                $("#ILoaderTown")[0].style.display = "none";
            },
            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlApptDropTown');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }


    if (type == 4) {
        document.getElementById("ddlDropTownDscg").options.length = 0;
        var e = document.getElementById("ddlDropDistrictDscg");
        var selectedDistrict = e.options[e.selectedIndex].value;
        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlDropTownDscg');
        $.ajax({
            type: "GET",
            async: false,
            url: WebAPIURL + 'LoadDistrictCities/' + selectedDistrict,
            contentType: "json",
            dataType: "json",
            beforeSend: function () {
                $("#ILoaderTown")[0].style.display = "block";
            },
            complete: function () {
                $("#ILoaderTown")[0].style.display = "none";
            },
            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlDropTownDscg');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }

    if (type == 5) {
        document.getElementById("ddlDropTowniht").options.length = 0;
        var e = document.getElementById("ddlDropDistrictiht");
        var selectedDistrict = e.options[e.selectedIndex].value;
        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlDropTowniht');
        $.ajax({
            type: "GET",
            async: false,
            url: WebAPIURL + 'LoadDistrictCities/' + selectedDistrict,
            contentType: "json",
            dataType: "json",
            beforeSend: function () {
                $("#ILoaderTown")[0].style.display = "block";
            },
            complete: function () {
                $("#ILoaderTown")[0].style.display = "none";
            },
            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlDropTowniht');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }

    if (type == 6) {
        document.getElementById("ddlHomeDropTownDscg").options.length = 0;
        var e = document.getElementById("ddlHomeDropDistrictDscg");
        var selectedDistrict = e.options[e.selectedIndex].value;
        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlHomeDropTownDscg');
        $.ajax({
            type: "GET",
            async: false,
            url: WebAPIURL + 'LoadDistrictCities/' + selectedDistrict,
            contentType: "json",
            dataType: "json",
            beforeSend: function () {
                $("#ILoaderTown")[0].style.display = "block";
            },
            complete: function () {
                $("#ILoaderTown")[0].style.display = "none";
            },
            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlHomeDropTownDscg');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }
}

// This method Loads control centres authorized to the user
function LoadDistricts() {
    document.getElementById("ddlCollectionDistrict").options.length = 0;
    document.getElementById("ddlHomeDistrict").options.length = 0;
    document.getElementById("ddlApptDropDistrict").options.length = 0;
    document.getElementById("ddlDropDistrictDscg").options.length = 0;
    document.getElementById("ddlHomeDropDistrictDscg").options.length = 0;
    

    
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlCollectionDistrict');
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlHomeDistrict');
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlApptDropDistrict');
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlDropDistrictDscg');
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlHomeDropDistrictDscg');
    $.ajax({
        type: "GET",
        async: false,
        url: WebAPIURL + 'LoadDistricts/' + getUserID(),
        contentType: "json",
        dataType: "json",
     
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlCollectionDistrict');
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlHomeDistrict');
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlApptDropDistrict');
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlDropDistrictDscg');
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlHomeDropDistrictDscg');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method Loads available collection times
function LoadCollectionTimes(CollectionPointID, DropPointID) {

    var baseUri = WebAPIURL + 'LoadCollectionTimes';

    var jsonData = JSON.stringify([CollectionPointID, DropPointID, false, false]);

    $.ajax({
        type: "Post",
        url: baseUri,
        data: jsonData,
        contentType: 'application/json; charset=utf-8',
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlControlCenter');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });

}

// This method Loads patient cities
function LoadDropCities() {



    document.getElementById("ddlApptDropDistrict").options.length = 0;
    document.getElementById("ddlDropDistrictiht").options.length = 0;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlApptDropDistrict');
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlDropDistrictiht');
    $.ajax({
        type: "GET",
        async: false,
        url: WebAPIURL + 'LoadDistricts/' + getUserID(),
        contentType: "json",
        dataType: "json",
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlApptDropDistrict');
                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlDropDistrictiht');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method Loads patient cities
function LoadPatientCities() {
    document.getElementById("ddlCity").options.length = 0;
    //document.getElementById("ddlDropCity").options.length = 0;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlCity');
    $.ajax({
        type: "GET",
        async: false,
        url: WebAPIURL + 'LoadCities',
        contentType: "json",
        dataType: "json",


        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlCity');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method loads drop suburbs
function LoadDropSuburbs() {
    document.getElementById("ddlHomeDropSuburb").options.length = 0;
    var e = document.getElementById("ddlHomeDropTownDscg");
    var selectedCity = e.options[e.selectedIndex].value;
    var baseUri = WebAPIURL + 'LoadSuburbsbyCityID/' + selectedCity;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlHomeDropSuburb');
    $.ajax({
        type: "GET",
        url: baseUri,
        async: false,
        contentType: "json",
        dataType: "json",
        success: function (data) {
            $.each(data, function (key, value) {

                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlHomeDropSuburb');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });

}

// This method is called when medical requirement is checked
function MedicalReqChecked(cb) {

    if (cb.checked) {
        var val = cb.value.split(",");
        val[2] = 0;
        cb.value = (val.toString());
    }
    else {
        var val = cb.value.split(",");
        val[2] = 1;
        cb.value = (val.toString());
    }
}

// This method Loads appointment reasons
function LoadAppointmentReasons() {
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlAppointmentReason');
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlAppointmentReasoniht');
    $.ajax({
        type: "GET",
        async: false,
        url: WebAPIURL + 'LoadAppointmentReasons',
        contentType: "json",
        dataType: "json",
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlAppointmentReason');
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlAppointmentReasoniht');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method Loads medical requirements
function LoadMedicalRequirements() {
    $.ajax({
        type: "GET",
        url: WebAPIURL + 'LoadMedicalRequirements',
        async: false,
        contentType: "json",
        dataType: "json",
        success: function (data) {
            $.each(data, function (key, value) {
                $('<div style="height: 30px; Width: 85%; clear: left;"><input type="checkbox" class="checkbox" onchange="MedicalReqChecked(this);" style="float:left; " value="' + value.Value + ",0,0" + '">&nbsp;   <p style="float:left" class="chkText"> ' + value.Text + '</p></div>').appendTo('#dmedicalRequirement');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });

    //Custom.init;
}

// This method Loads patient mobility
function LoadPatientmobility() {
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlPatientMobility');
    $.ajax({
        type: "GET",
        url: WebAPIURL + 'LoadPatientMobility',
        contentType: "json",
        async: false,
        dataType: "json",
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + " '>" + value.Text + " </option>").appendTo('#ddlPatientMobility');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method Loads suburbs
function LoadControlCentreCities() {

    document.getElementById("ddlPickCity").options.length = 0;
    var e = document.getElementById("ddlControlCenter");
    var selectedControlCenter = e.options[e.selectedIndex].value;

    if (selectedControlCenter == 0) {
        var e = document.getElementById("ddlPickCity");
        e.options.length = 0;
        var e = document.getElementById("ddlFacility");
        e.options.length = 0;
        var e = document.getElementById("ddlwardcolectionpoint");
        e.options.length = 0;
        var e = document.getElementById("ddlSuburb");
        e.options.length = 0;

    }
    var baseUri = WebAPIURL + 'LoadControlCenterCities/' + selectedControlCenter;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlPickCity');
    $.ajax({
        type: "GET",
        url: baseUri,
        async: false,
        contentType: "json",
        dataType: "json",

        beforeSend: function () {
            $("#ILoaderCity")[0].style.display = "block";
        },
        complete: function () {
            $("#ILoaderCity")[0].style.display = "none";
        },

        success: function (data) {
            $.each(data, function (key, value) {

                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlPickCity');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });


    var e = document.getElementById("ddlPickCity");
    var selectedCity = e.options[e.selectedIndex].value;
    if (selectedCity > 0) {
        LoadSubUrbs();
    }
    else {
        var e = document.getElementById("ddlSuburb");
        e.options.length = 0;


    }


}

// This method Loads city suburbs
function LoadCitySuburbs() {
    document.getElementById("ddlPatientSuburb").options.length = 0;
    var e = document.getElementById("ddlCity");
    var selectedCity = e.options[e.selectedIndex].value;
    var baseUri = WebAPIURL + 'LoadSuburbsbyCityID/' + selectedCity;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlPatientSuburb');
    $.ajax({
        type: "GET",
        async: false,
        url: baseUri,
        contentType: "json",
        dataType: "json",
        success: function (data) {
            $.each(data, function (key, value) {

                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlPatientSuburb');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });

}

// This method Loads suburbs
function LoadSubUrbs() {

    document.getElementById("ddlHomeSuburb").options.length = 0;
    var e = document.getElementById("ddlHomeTown");
    var selectedControlCenter = e.options[e.selectedIndex].value;

    //if (selectedControlCenter == 0) {
    //    var e = document.getElementById("ddlFacility");
    //    e.options.length = 0;
    //    var e = document.getElementById("ddlwardcolectionpoint");
    //    e.options.length = 0;
    //    var e = document.getElementById("ddlSuburb");
    //    e.options.length = 0;
    //}

    var baseUri = WebAPIURL + 'LoadSuburbsbyCityID/' + selectedControlCenter;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlHomeSuburb');
    $.ajax({
        type: "GET",
        url: baseUri,
        async: false,

        contentType: "json",
        dataType: "json",


        success: function (data) {
            $.each(data, function (key, value) {

                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlHomeSuburb');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });


    //var e = document.getElementById("ddlSuburb");
    //var selectedSuburb = e.options[e.selectedIndex].value;
    //if (selectedSuburb > 0) {
    //    LoadFacility(false);
    //    LoadWards();
    //}
    //else {
    //    var e = document.getElementById("ddlFacility");
    //    e.options.length = 0;
    //    var e = document.getElementById("ddlwardcolectionpoint");
    //    e.options.length = 0;

    //}


}

// This method Loads facility
function LoadFacility(Async) {

    document.getElementById("ddlwardcolectionpoint").options.length = 0;
    document.getElementById("ddlFacility").options.length = 0;
    var e = document.getElementById("ddlPickCity");
    var selectedSuburb = e.options[e.selectedIndex].value;
    var rbHome = document.getElementById("rbHome").checked;
    if ((rbHome) && (selectedSuburb > 0)) {


        var baseUri = WebAPIURL + 'LoadCollectionDropPoints';
        var jsonData = JSON.stringify([selectedSuburb, 0]);
        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlwardcolectionpoint');
        $.ajax({
            type: "Post",
            url: baseUri,
            data: jsonData,
            contentType: 'application/json; charset=utf-8',
            beforeSend: function () {
                $("#ILoaderFacility")[0].style.display = "block";
            },
            complete: function () {
                $("#ILoaderFacility")[0].style.display = "none";
            },

            success: function (data) {
                // alert(data.length);
                if (data.length > 0) {
                    $.each(data, function (key, value) {

                        $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlwardcolectionpoint');
                    });
                }
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }
    else if (selectedSuburb > 0) {

        var userID = getUserID();

        var baseUri = WebAPIURL + 'LoadFacilities';

        var jsonData = JSON.stringify([userID, selectedSuburb, currentFacility]);


        //  var baseUri = WebAPIURL + 'LoadFacilities/' + selectedSuburb;
        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlFacility');
        $.ajax({
            type: "Post",

            url: baseUri,


            async: false,
            // contentType: "json",
            data: jsonData,

            beforeSend: function () {
                $("#ILoaderFacility")[0].style.display = "block";
            },
            complete: function () {
                $("#ILoaderFacility")[0].style.display = "none";
            },
            //  dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlFacility');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }

    // LoadDropFacility();
}

// This method Loads drop facilities
function LoadDropFacility() {
    document.getElementById("ddlDropHospital").options.length = 0;

    var userID = 0;// getUserID();
    //var e = document.getElementById("ddlCollectionTown");
    //var selectedTown = e.options[e.selectedIndex].value;


    selectedTown = 0
   

    var e = document.getElementById("ddlApptDropTown");
    var selectedDropCity = e.options[e.selectedIndex].value;




    //  var baseUri = WebAPIURL + 'LoadDropFacilities/' + selectedSuburb;

    currentDropFacility = "";


 

    var baseUri = WebAPIURL + 'LoadDropFacilities';

    var jsonData = JSON.stringify([selectedTown, selectedDropCity, userID, currentDropFacility]);

    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlDropHospital');

    
        $.ajax({


            type: "Post",
            url: baseUri,
            // contentType: "json",
            data: jsonData,
            async: false,
            //  dataType: "json",
            contentType: 'application/json; charset=utf-8',



            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlDropHospital');

                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    
}

//This method loads drop facilities
function LoadIHTDropFacility() {
    document.getElementById("ddlFacilityiht").options.length = 0;
    var e = document.getElementById("ddlPickCity");
    var selectedSuburb = e.options[e.selectedIndex].value;
    var selectedDropCity = 0;
    var userID = getUserID();
    var e = document.getElementById("ddlDropCityiht");
    var selectedDropCity = e.options[e.selectedIndex].value;

    var baseUri = WebAPIURL + 'LoadDropFacilities';

    var jsonData = JSON.stringify([selectedSuburb, selectedDropCity, userID, currentDropFacility]);

    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlFacilityiht');
    if (selectedSuburb > 0) {
        $.ajax({
            type: "Post",
            url: baseUri,
            async: false,
            data: jsonData,
            contentType: 'application/json; charset=utf-8',

            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlFacilityiht');
                });
            }
            ,
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }
}

// This methods takes grid to the first page
function FirstPage() {
    //$('#ddlPageNumber option:eq(1)').prop('selected', true);
    $("#ddlPageNumber option[value='1']").attr('selected', 'selected');
    GetAllPatients(1, 10);
}

// This methods takes grid to the second page
function LastPage() {
    var lastValue = $('#ddlPageNumber option:last-child').val();
    $("#ddlPageNumber option[value='" + lastValue + "']").attr('selected', 'selected');
    GetAllPatients(lastValue, 10);
}

// This methods takes grid to the next page
function NextPage() {
    var NextValue = parseInt($('#ddlPageNumber :selected').val()) + 1;
    var lastValue = $('#ddlPageNumber option:last-child').val();
    if (NextValue <= lastValue) {
        $("#ddlPageNumber option[value='" + NextValue + "']").attr('selected', 'selected');
        GetAllPatients($('#ddlPageNumber :selected').val(), 10);
    }
}

// This methods takes grid to the previous page
function PreviousPage() {
    var PrevValue = parseInt($('#ddlPageNumber :selected').val()) - 1;
    if (PrevValue >= 1) {
        $("#ddlPageNumber option[value='" + PrevValue + "']").attr('selected', 'selected');
        GetAllPatients($('#ddlPageNumber :selected').val(), 10);
    }
}

// This methods loads paging data
function LoadPagingData() {
    GetAllPatients($('#ddlPageNumber :selected').val(), 10);
}

// This method Loads wards
function LoadWards() {

    document.getElementById("ddlwardcolectionpoint").options.length = 0;
    var e = document.getElementById("ddlCollectionTown");
    var selectedSubUurb = e.options[e.selectedIndex].value;

    var rbFacility = document.getElementById("rbFacility").checked;
    if (!rbFacility) {
        document.getElementById("ddlFacility").options.length = 0;
        var baseUri = WebAPIURL + 'LoadCollectionDropPoints';
        var jsonData = JSON.stringify([selectedSubUurb, 0]);

        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlwardcolectionpoint');
        
            $.ajax({
                type: "Post",
                url: baseUri,
                data: jsonData,
                contentType: 'application/json; charset=utf-8',

            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlwardcolectionpoint');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }
    else {
       
        var e = document.getElementById("ddlFacility");
        if (e.options.length > 0) {
            var selectedFacility = e.options[e.selectedIndex].value;
            var baseUri = WebAPIURL + 'LoadWards/' + selectedFacility;
            $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlwardcolectionpoint');
            $.ajax({
                type: "GET",
                url: baseUri,
                async: false,
                contentType: "json",
                dataType: "json",
                success: function (data) {
                    $.each(data, function (key, value) {

                        $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlwardcolectionpoint');
                    });
                },
                error: function (xhr) {
                    alert(xhr.responseText);
                }
            });
        }

        else {

            var e = document.getElementById("ddlCollectionTown");
            var selectedSuburb = e.options[e.selectedIndex].value;
            document.getElementById("ddlwardcolectionpoint").options.length = 0;
            document.getElementById("ddlFacility").options.length = 0;

            var userID = getUserID();

            var baseUri = WebAPIURL + 'LoadFacilities';

            var jsonData = JSON.stringify([userID, selectedSuburb, currentFacility]);


            if (selectedSuburb == 0) {
                var e = document.getElementById("ddlFacility");
                e.options.length = 0;
            }
            else {
                var baseUri = WebAPIURL + 'LoadFacilities/' + selectedSuburb;
                $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlFacility');
                $.ajax({

                    type: "Post",
                    url: baseUri,
                    async: false,
                    data: jsonData,
                    contentType: 'application/json; charset=utf-8',

                    success: function (data) {
                        $.each(data, function (key, value) {
                            $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlFacility');
                        });
                    },
                    error: function (xhr) {
                        alert(xhr.responseText);
                    }
                });
            }

        }

    }


}


// This method Loads wards for iht
function LoadFacilityIht() {
    var userID = getUserID();
    document.getElementById("ddlFacilityiht").options.length = 0;
    var currentDropFacility = "";
    var e = document.getElementById("ddlDropTowniht");
    var selectedTown = e.options[e.selectedIndex].value;
    var baseUri = WebAPIURL + 'LoadDropFacilities';

    var jsonData = JSON.stringify([selectedTown, selectedTown, userID, currentDropFacility]);

    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlFacilityiht');
    $.ajax({
        type: "Post",
        url: baseUri,
        // contentType: "json",
        data: jsonData,
        async: false,
        //  dataType: "json",
        contentType: 'application/json; charset=utf-8',
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlFacilityiht');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method Loads wards for iht
function LoadWardsIht() {
    document.getElementById("ddlWardiht").options.length = 0;

    var e = document.getElementById("ddlFacilityiht");
    var selectedFacility = e.options[e.selectedIndex].value;
    var baseUri = WebAPIURL + 'LoadWards/' + selectedFacility;

    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlWardiht');
    $.ajax({
        type: "GET",
        url: baseUri,
        async: false,
        contentType: "json",
        dataType: "json",
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlWardiht');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method Loads wards for discharge
function LoadDropWardsDischarge() {

    document.getElementById("ddlDropWard").options.length = 0;
    var e = document.getElementById("ddlDropTownDscg");
    var ddlDropTownDscg = e.options[e.selectedIndex].value;

    var rbFacilityDrop = document.getElementById("rbFacilityDrop").checked;

    if (!rbFacilityDrop) {
        var baseUri = WebAPIURL + 'LoadCollectionDropPoints';
        var jsonData = JSON.stringify([ddlDropTownDscg, 1]);
    }
    else {
        var e = document.getElementById("ddlDropFacility");
        var selectedFacility = e.options[e.selectedIndex].value;
        var baseUri = WebAPIURL + 'LoadWards/' + selectedFacility;
    }


    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlDropWard');
    $.ajax({
        type: "Post",
        url: baseUri,
        data: jsonData,
        contentType: 'application/json; charset=utf-8',
        success: function (data) {
            $.each(data, function (key, value) {

                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlDropWard');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method Loads drop facilities for discharge
function LoadDropFacilityDischarge() {


    var selectedDropCity = 0;
    var userID = getUserID();
    //var e = document.getElementById("ddlDropCity");
    //var selectedDropCity = e.options[e.selectedIndex].value;


    document.getElementById("ddlDropFacility").options.length = 0;
    document.getElementById("ddlDropWard").options.length = 0;
    var e = document.getElementById("ddlDropTownDscg");
    var ddlDropTownDscg = e.options[e.selectedIndex].value;

    var rbFacilityDrop = document.getElementById("rbFacilityDrop").checked;

    if (!rbFacilityDrop) {
        var baseUri = WebAPIURL + 'LoadCollectionDropPoints';
        var jsonData = JSON.stringify([ddlDropTownDscg, 1]);
        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlDropWard');
        $.ajax({
            type: "Post",
            url: baseUri,
            data: jsonData,
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlDropWard');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }
    else {
        //  var e = document.getElementById("ddlFacility");
        //  var selectedFacility = e.options[e.selectedIndex].value;
        // var baseUri = WebAPIURL + 'LoadDropFacilities/' + selectedDropSubUurb;

        var currentDropFacility = "";

        var baseUri = WebAPIURL + 'LoadDropFacilities';

        var jsonData = JSON.stringify([ddlDropTownDscg, ddlDropTownDscg, userID, currentDropFacility]);

        $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlDropFacility');
        $.ajax({
            type: "Post",
            url: baseUri,
            // contentType: "json",
            data: jsonData,
            async: false,
            //  dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $.each(data, function (key, value) {
                    $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlDropFacility');
                });
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }



}

// This method Loads drop wards
function LoadDropWards() {
    document.getElementById("ddlDropClinic").options.length = 0;
    var e = document.getElementById("ddlDropHospital");
    var selectedFacility = e.options[e.selectedIndex].value;
    var baseUri = WebAPIURL + 'LoadWards/' + selectedFacility;
    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlDropClinic');
    $.ajax({
        type: "GET",
        url: baseUri,
        async: false,
        contentType: "json",
        dataType: "json",
        success: function (data) {
            $.each(data, function (key, value) {
                $("<option value = '" + value.Value + "'>" + value.Text + " </option>").appendTo('#ddlDropClinic');
            });
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method sets facilities
function SetFacility() {

    if (document.getElementById('ddlTransferReason').selectedIndex == 3) {
        //$("#wizard .stepContainer .content").css("background-color", "#c1eefe");
        //$("#wizard  .actionBar").css("background-color", "#c1eefe");

        $("#wizard div#step-1 ").css("background-color", "#c1eefe");
        $("#wizard div#step-2 ").css("background-color", "#c1eefe");
        $("#wizard div#step-3 ").css("background-color", "#c1eefe");
        $("#wizard div#step-4 ").css("background-color", "#c1eefe");
        $("#wizard  .button-empty-div").css("background-color", "#c1eefe");

        $("#wizard section").css("background-color", "#c1eefe");

        $(".ihtfields").css("display", "");
        $(".apptfields").css("display", "none");
        $(".ihtfields").val("");
        $(".appoimentPanel").css("display", "none");
        $(".dischangePanel").css("display", "none");
        $(".ihtPanel").css("display", "inline");

        document.getElementById('rbFacility').checked = true;
        document.getElementById('rbHome').checked = false;
        document.getElementById('rbHomeAddress').checked = false;
        document.getElementById('rbFacility').disabled = true;
        document.getElementById('rbHome').disabled = true;
        document.getElementById('rbHomeAddress').disabled = true;
        document.getElementById('ddlFacility').removeAttribute('disabled')
        $("#wizard div#step-2 ").css("height", "370px");

        var selectedDistrict;
        var e = document.getElementById("ddlDropDistrictiht");
        if (e.options.length > 0)
            selectedDistrict = e.options[e.selectedIndex].value;
        else
            selectedDistrict = 0;
        if (selectedDistrict == 0) {
            LoadDropCities();
        }

        $(".loginName").val(loginUserName);
        $(".loginContactNo").val(loginContactNo);


    }
    else if (document.getElementById('ddlTransferReason').selectedIndex == 2) {


        //$("#wizard .stepContainer .content").css("background-color", "#ded7fd");
        //$("#wizard  .actionBar").css("background-color", "#ded7fd");



        $("#wizard div#step-1 ").css("background-color", "#ded7fd");
        $("#wizard div#step-2 ").css("background-color", "#ded7fd");
        $("#wizard div#step-3 ").css("background-color", "#ded7fd");
        $("#wizard div#step-4 ").css("background-color", "#ded7fd");
        $("#wizard  .button-empty-div").css("background-color", "#ded7fd");
        $("#wizard div#step-2 ").css("height", "260px");

        $(".ihtfields").css("display", "none");
        $(".apptfields").css("display", "none");
        $(".appoimentPanel").css("display", "none");
        $(".dischangePanel").css("display", "inline");
        $(".ihtPanel").css("display", "none");



        document.getElementById('rbFacility').checked = true;
        document.getElementById('rbHome').checked = false;
        document.getElementById('rbHomeAddress').checked = false;
        document.getElementById('rbFacility').disabled = true;
        document.getElementById('rbHome').disabled = true;
        document.getElementById('rbHomeAddress').disabled = true;
        document.getElementById('ddlFacility').removeAttribute('disabled');
        $(".loginName").val(loginUserName);
        $(".loginContactNo").val(loginContactNo);

    }
    else if (document.getElementById('ddlTransferReason').selectedIndex == 1) {
        //$("#wizard .stepContainer .content").css("background-color", "#fdefd7");
        //$("#wizard  .actionBar").css("background-color", "#fdefd7");
     
   
        $("#wizard div#step-2 ").css("height", "320px");

        var selectedDistrict;
        var e = document.getElementById("ddlApptDropDistrict");
        if (e.options.length > 0)
            selectedDistrict = e.options[e.selectedIndex].value;
        else
            selectedDistrict = 0;



        if (selectedDistrict == 0) {
            LoadDropCities();
        }
        $("#wizard div#step-1 ").css("background-color", "#fdefd7");
        $("#wizard div#step-2 ").css("background-color", "#fdefd7");
        $("#wizard div#step-3 ").css("background-color", "#fdefd7");
        $("#wizard div#step-4 ").css("background-color", "#fdefd7");
        $("#wizard  .button-empty-div").css("background-color", "#fdefd7");

        $(".ihtfields").css("display", "none");
        $(".appoimentPanel").css("display", "inline");
        $(".dischangePanel").css("display", "none");
        $(".ihtPanel").css("display", "none");


        //document.getElementById('rbFacility').checked = true;
        //document.getElementById('rbHome').checked = false;
        //document.getElementById('rbFacility').disabled = false;
        //document.getElementById('rbHome').disabled = false;
        //document.getElementById('rbHomeAddress').disabled = false;
        //document.getElementById('ddlFacility').removeAttribute('disabled');
        //$('#ddlFacility').removeClass('dropdown_area-disabled');
        //$('#ddlFacility').addClass('dropdown_area')
        $(".loginName").val(loginUserName);
        $(".loginContactNo").val(loginContactNo);

        //  document.getElementById("ddlwardcolectionpoint").options.length = 0;
        //var loginUserID = getCookie1("UserID");
        //var loginUserName = getCookie1("username");
        //var loginContactNo = getCookie1("ContactNo");

        //$("#txtLoginNameiht").val(loginUserName);
        //$("#txtContactNoiht").val(loginContactNo);
    }

    if (document.getElementById('ddlTransferReason').selectedIndex == 0) {
        $("#wizard div#step-1 ").css("background-color", "#ffffff");
        $("#wizard  .button-empty-div").css("background-color", "#ffffff");
    }

}

// This method searches patients
function GetAllPatients(pageindex, pagesize) {

    var patientID = $("#txtIDNumber").val();

    var txtPMI = $("#txtPMI").val();
    var txtPatientName = $("#txtPatientName").val();
    var txtSurname = $("#txtSurname").val();
    var txtPatientContactNo = $("#txtPatientContactNo").val();

    var e = document.getElementById("ddlGender");
    var ddlGender = e.options[e.selectedIndex].value;


    var baseUri = WebAPIURL + 'LoadPatients';

    var jsonData = JSON.stringify([patientID, pageindex, pagesize, txtPMI, txtPatientName, txtSurname, txtPatientContactNo, ddlGender]);

    $.ajax({
        type: "Post",
        url: baseUri,
        // contentType: "json",
        data: jsonData,
        //  dataType: "json",
        contentType: 'application/json; charset=utf-8',
        success: function (data) {
            if (data != null) {
                var dvGeneratedHTML = document.getElementById("dvPatientsHTML");
                dvGeneratedHTML.innerHTML = "";


                if (data.length > 0) {
                    var dvPaging = document.getElementById('dvPaging');
                    dvPaging.style.display = "block";
                    //if (isPageLoadFirstTime == 0) {
                    if (data.length > 0) {
                        FillPagingDropdown(data[0].TotalRecords);
                        $("#ddlPageNumber option[value='" + pageindex + "']").attr('selected', 'selected');
                    }
                    //}
                    BookingData = data;
                    StartRowID = data.length - 1;
                    AddNewRow();
                    isPageLoadFirstTime = 1;
                }
                else {
                    dvGeneratedHTML.innerHTML = "<div class='NoRecord'>No record found.</div>";
                    var select = document.getElementById('ddlPageNumber');
                    select.options.length = 0;
                    var dvPaging = document.getElementById('dvPaging');
                    dvPaging.style.display = "none";
                }
            }
            else {
                $("#dvErrorMessage").css("display", "block");
            }
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });

}

// This method searches patients
function SearchPatient() {

    if (($("#txtIDNumber").val() != "") || ($("#txtPMI").val() != "") || ($("#txtPatientName").val() != "") || ($("#txtSurname").val() != "") || ($("#txtPatientContactNo").val() != "")) {

        var patientID = $("#txtIDNumber").val();
        var txtPMI = $("#txtPMI").val();
        var txtPatientName = $("#txtPatientName").val();
        var txtSurname = $("#txtSurname").val();
        var txtPatientContactNo = $("#txtPatientContactNo").val();

        var e = document.getElementById("ddlGender");
        var ddlGender = e.options[e.selectedIndex].value;

        var baseUri = WebAPIURL + 'LoadPatients';

        pageindex = 1;
        pagesize = 1000;

        var jsonData = JSON.stringify([patientID, pageindex, pagesize, txtPMI, txtPatientName, txtSurname, txtPatientContactNo, ddlGender]);

        $.ajax({
            type: "Post",
            url: baseUri,
            data: jsonData,
            contentType: 'application/json; charset=utf-8',

            success: function (data) {

                if (data.length == 0) {
                    var successMessage = "No Patient exists in the system for given search criteria.";
                    // runEffect();
                    //$("#dvAlertMessage").html(successMessage);
                    OpenPromptWindow(successMessage, 0);
                    // ResetPatient();

                }

                if (data.length == 1) {

                 

                    var txtPatientID = data[0].ID;

                    var txtIDNumber = data[0].RegistrationID;

                    var txtPMI = data[0].PMI;

                    var txtPatientName = data[0].Name;

                    var txtSurname = data[0].Surname;

                    var ddlGender = data[0].GenderID;

                    var txtAge = data[0].Age;

                    var ddlAgeType = data[0].AgeUnit;

                    var txtPatientContactNo = data[0].PhoneNo1;

                    var txtAddressLine1 = data[0].AddressLine1;

                    var txtAddressLine2 = data[0].AddressLine2;

                    var ddlPatientSuburb = data[0].SubrubID;

                    var ddlCity = data[0].CityID; //e.options[e.selectedIndex].value;

                    var NextofKin = data[0].NextofKin;

                    var NextofKinContactNo = data[0].NextofKinContactNo;

                    var CommunicableDiseaseID = data[0].CommunicableDiseaseID;

                    $("#txtPatientID").val(txtPatientID);

                    $("#txtIDNumber").val(txtIDNumber);

                    $("#txtPMI").val(txtPMI);

                    $("#txtPatientName").val(txtPatientName);

                    $("#txtSurname").val(txtSurname);


                    var e = document.getElementById('ddlGender');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == ddlGender) {
                            e.selectedIndex = j;
                            break;
                        }
                    }

                    $("#txtAge").val(txtAge);

                    var e = document.getElementById('ddlAgeType');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == ddlAgeType) {
                            e.selectedIndex = j;
                            break;
                        }
                    }

                    $("#txtPatientContactNo").val(txtPatientContactNo);

                    $("#txtAddressLine1").val(txtAddressLine1);

                    $("#txtAddressLine2").val(txtAddressLine2);

                    LoadPatientCities();
                    var e = document.getElementById('ddlCity');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == ddlCity) {
                            e.selectedIndex = j;
                            break;
                        }
                    }

                    LoadCitySuburbs();
                    var e = document.getElementById('ddlPatientSuburb');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == ddlPatientSuburb) {
                            e.selectedIndex = j;
                            break;
                        }
                    }


                    var e = document.getElementById('ddlCommunicalbleDisease');
                    var opts = e.options;
                    for (var opt, j = 0; opt = opts[j]; j++) {
                        if (opt.value == ddlCommunicalbleDisease) {
                            e.selectedIndex = j;
                            break;
                        }
                    }

                    $("#txtPatientNextToKin").val(NextofKin);

                    $("#txtNextOfKinContactNo").val(NextofKinContactNo);
                    DisablePatientFields();

                }

                else if (data.length > 1) {
                    OpenPatientsListyWindow();
                    GetAllPatients(1, 10);
                }
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }
    else {
        var successMessage = "Please enter search criteria.";
        //  runEffect();
        //  $("#dvAlertMessage").html(successMessage);
        OpenPromptWindow(successMessage, 0);
    }
}


// This method adds new grid row
function AddNewPatientMoveRow() {

    if (StartRowID >= 0) {
        var strHTML = "";
        var dvGenID = "";
        var RowClass = "normal-grid left";
        //  var RowID = value.ID;

        var RowID = BookingData[StartRowID].TripEventID;
        TotalRows = BookingData.length;

        dvGenID = "#dvRow" + RowID;
        strHTML = strHTML + "<div id='" + RowID + "'  class='msg_head_Patient'  onclick= 'setMovePatient(" + RowID + ")'>";
        strHTML = strHTML + "<div class='" + RowClass + "' >";

        var statusClass = "";
        var dvtitle = "";

        strHTML = strHTML + "<div style='width:33%;' class='left'><div class='grid-normal-column left' title='" + BookingData[StartRowID].ReferenceNo + "' >" + CutBigWords(BookingData[StartRowID].ReferenceNo, 20) + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "<div style='width:33%;' class='left'><div class='grid-normal-column left' title='" + BookingData[StartRowID].PatientName + "' >" + CutBigWords(BookingData[StartRowID].PatientName, 16) + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "<div style='width:34%;' class='left'><div class='grid-normal-column left' title='" + BookingData[StartRowID].PatientMobility + "' >" + CutBigWords(BookingData[StartRowID].PatientMobility, 16) + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "</div></div>";

        $("#dvPatientsMoveHTML").html(strHTML + $("#dvPatientsMoveHTML").html());

        StartRowID--;

        setTimeout("AddNewPatientMoveRow();", 1);

    }

}



// This method adds new grid row
function AddNewRow() {

    if (StartRowID >= 0) {
        var strHTML = "";
        var dvGenID = "";
        var RowClass = "normal-grid left";
        //  var RowID = value.ID;

        var RowID = BookingData[StartRowID].ID;
        TotalRows = BookingData.length;

        dvGenID = "#dvRow" + RowID;
        strHTML = strHTML + "<div id='" + RowID + "'  class='msg_head_Patient'  onclick= 'setPatient(" + RowID + ")'>";
        strHTML = strHTML + "<div class='" + RowClass + "' >";

        var statusClass = "";
        var dvtitle = "";



        var ageType;
        if (BookingData[StartRowID].AgeUnit == 1) {
            ageType = "Year(s)";
        }
        else if (BookingData[StartRowID].AgeUnit == 2) {
            ageType = "Month(s)";
        }

        else if (BookingData[StartRowID].AgeUnit == 3) {
            ageType = "Day(s)";
        }


        strHTML = strHTML + "<div style='width:20%;' class='left'><div class='grid-normal-column left' title='" + BookingData[StartRowID].RegistrationID + "' >" + CutBigWords(BookingData[StartRowID].RegistrationID, 20) + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "<div style='width:20%;' class='left'><div class='grid-normal-column left' title='" + BookingData[StartRowID].Name + "' >" + CutBigWords(BookingData[StartRowID].Name, 16) + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "<div style='width:20%;' class='left'><div class='grid-normal-column left' title='" + BookingData[StartRowID].Surname + "' >" + CutBigWords(BookingData[StartRowID].Surname, 16) + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "<div style='width:10%;' class='left'><div class='grid-normal-column left' title='" + BookingData[StartRowID].Age + " " + ageType + "' >" + CutBigWords(BookingData[StartRowID].Age, 10) + " " + ageType + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "<div style='width:30%;' class='left'><div class='grid-normal-column left' title='" + BookingData[StartRowID].AddressLine1 + "' >" + CutBigWords(BookingData[StartRowID].AddressLine1, 25) + "</div></div>";

        strHTML = strHTML + "</div></div>";

        $("#dvPatientsHTML").html(strHTML + $("#dvPatientsHTML").html());

        StartRowID--;

        setTimeout("AddNewRow();", 1);

    }

}

// This method resets patient particulars
function ResetPatient() {

    $("#txtPatientID").val("");

    $("#txtIDNumber").val("");

    $("#txtPMI").val("");

    $("#txtPatientName").val("");

    $("#txtSurname").val("");

    $("#txtPatientNextToKin").val("");

    $("#txtNextOfKinContactNo").val("");

    var e = document.getElementById('ddlGender');
    e.selectedIndex = 0;

    $("#txtAge").val("");

    var e = document.getElementById('ddlAgeType');
    e.selectedIndex = 0;

    $("#txtPatientContactNo").val("");

    $("#txtAddressLine1").val("");

    $("#txtAddressLine2").val("");

    var e = document.getElementById('ddlCity');
    e.selectedIndex = 0;

    var e = document.getElementById('ddlPatientSuburb');
    e.selectedIndex = 0;
    DisablePatientFields();

}




// This method selects patient
function selectPatient() {

    if (currentSelectedPatientID != 0) {
        var baseUri = WebAPIURL + 'LoadPatientByID/' + currentSelectedPatientID;

        currentSelectedPatientID = 0;
        previousSelectPatientID = 0;

        $.ajax({
            type: "GET",
            async: false,
            url: baseUri,
            contentType: "json",
            dataType: "json",
            success: function (data) {

                var txtPatientID = data.ID;

                var txtIDNumber = data.RegistrationID;

                var txtPMI = data.PMI;

                var txtPatientName = data.Name;

                var txtSurname = data.Surname;

                var ddlGender = data.GenderID;

                var txtAge = data.Age;

                var ddlAgeType = data.AgeUnit;

                var txtPatientContactNo = data.PhoneNo1;

                var txtAddressLine1 = data.AddressLine1;

                var txtAddressLine2 = data.AddressLine2;

                var ddlPatientSuburb = data.SubrubID;

                var ddlCity = data.CityID; //e.options[e.selectedIndex].value;

                var NextofKin = data.NextofKin;

                var NextofKinContactNo = data.NextofKinContactNo;

                var CommunicableDiseaseID = data.CommunicableDiseaseID;


                $("#txtPatientID").val(txtPatientID);

                $("#txtIDNumber").val(txtIDNumber);

                $("#txtPMI").val(txtPMI);

                $("#txtPatientName").val(txtPatientName);

                $("#txtSurname").val(txtSurname);


                var e = document.getElementById('ddlGender');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlGender) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                $("#txtAge").val(txtAge);

                var e = document.getElementById('ddlAgeType');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlAgeType) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                $("#txtPatientContactNo").val(txtPatientContactNo);

                $("#txtAddressLine1").val(txtAddressLine1);

                $("#txtAddressLine2").val(txtAddressLine2);

                LoadPatientCities();
                var e = document.getElementById('ddlCity');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlCity) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                LoadCitySuburbs();
                var e = document.getElementById('ddlPatientSuburb');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlPatientSuburb) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                var e = document.getElementById('ddlCommunicalbleDisease');
                var opts = e.options;
                for (var opt, j = 0; opt = opts[j]; j++) {
                    if (opt.value == ddlCommunicalbleDisease) {
                        e.selectedIndex = j;
                        break;
                    }
                }

                $("#txtPatientNextToKin").val(NextofKin);

                $("#txtNextOfKinContactNo").val(NextofKinContactNo);
                DisablePatientFields();


            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    }
    HidPatientsListWindow();

}



// This method opens patient list window
function OpenPatientsMoveWindow() {

    ShowFadedDiv();
    var dvCancelBookingPopup = document.getElementById("dvMovePatientPopup");

    if (IsIE7 == true) {
        //$("#dvCancelBookingPopup").css("left", "40%");
        dvCancelBookingPopup.style.left = 0;
        //  $("#dvCancelPopupInner").css("position", "relative");
        $("#dvMovePatientPopup").css("position", "absolute");
        $("#dvMovePatientPopup").css("display", "block");
    }
    else {

        dvCancelBookingPopup.style.zIndex = "201";
        dvCancelBookingPopup.style.top = "100px";
        dvCancelBookingPopup.style.height = "320px";
        dvCancelBookingPopup.style.width = '53%';
        dvCancelBookingPopup.style.position = 'fixed';
        $("#dvMovePatientPopup").fadeIn("slow");
    }
}

// This method hides patient list window
function HidePatientsMoveWindow() {
    $("#fadedDiv").fadeOut("slow");
    $("#dvMovePatientPopup").fadeOut("slow");
   // ClearCancelBookingControl();

}





// This method opens patient list window
function OpenPatientsListyWindow() {


    ShowFadedDiv();
    var dvCancelBookingPopup = document.getElementById("dvCancelBookingPopup");


    if (IsIE7 == true) {
        //$("#dvCancelBookingPopup").css("left", "40%");
        dvCancelBookingPopup.style.left = 0;
        //  $("#dvCancelPopupInner").css("position", "relative");
        $("#dvCancelBookingPopup").css("position", "absolute");
        $("#dvCancelBookingPopup").css("display", "block");
    }
    else {

        dvCancelBookingPopup.style.zIndex = "201";
        dvCancelBookingPopup.style.top = "100px";
        dvCancelBookingPopup.style.height = "320px";
        dvCancelBookingPopup.style.width = '53%';
        dvCancelBookingPopup.style.position = 'fixed';
        $("#dvCancelBookingPopup").fadeIn("slow");
    }





    //var fadedDiv = document.getElementById("fadedDiv");
    //var dvCancelBookingPopup = document.getElementById("dvCancelBookingPopup");
    //fadedDiv.style.position = 'fixed';
    //fadedDiv.style.zIndex = 200;
    //fadedDiv.style.height = document.documentElement.clientHeight + "px"; //Vertical screen
    //fadedDiv.style.width = document.documentElement.clientWidth + "px"; //Vertical screen

    //dvCancelBookingPopup.style.zIndex = 201;
    ////dvCancelBookingPopup.style.top = "15px";
    //dvCancelBookingPopup.style.height = "200px";
    //dvCancelBookingPopup.style.width = "53%";
    //dvCancelBookingPopup.style.position = 'fixed';
    ////dvCancelBookingPopup.innerHTML = "<center><img src='../Content/themes/base/images/AJAXloading.gif' width='48px' height='48px' /></center>";

    //$("#fadedDiv").fadeIn("slow");
    //$("#dvCancelBookingPopup").fadeIn("slow");


}

// This method hides patient list window
function HidPatientsListWindow() {
    $("#fadedDiv").fadeOut("slow");
    $("#dvCancelBookingPopup").fadeOut("slow");
    ClearCancelBookingControl();

}

// This method opens confirm window
function OpenConfirmWindow() {

    ShowFadedDiv();
    var dvConfirmPopup = document.getElementById("dvConfirmPopup");

    if (IsIE7 == true) {
        //$("#dvCancelBookingPopup").css("left", "40%");
        dvConfirmPopup.style.left = 0;
        //  $("#dvCancelPopupInner").css("position", "relative");
        $("#dvConfirmPopup").css("position", "absolute");
        $("#dvConfirmPopup").css("display", "block");
    }
    else {

        dvConfirmPopup.style.zIndex = "201";
        dvConfirmPopup.style.top = "200px";
        dvConfirmPopup.style.height = "320px";
        dvConfirmPopup.style.width = '53%';
        dvConfirmPopup.style.position = 'fixed';
        $("#dvConfirmPopup").fadeIn("slow");
    }

    //var fadedDiv = document.getElementById("fadedDiv");
    //var dvCancelBookingPopup = document.getElementById("dvConfirmPopup");
    //fadedDiv.style.position = 'fixed';
    //fadedDiv.style.zIndex = 200;
    //fadedDiv.style.height = document.documentElement.clientHeight + "px"; //Vertical screen
    //fadedDiv.style.width = document.documentElement.clientWidth + "px"; //Vertical screen

    //dvCancelBookingPopup.style.zIndex = 201;
    ////dvCancelBookingPopup.style.top = "15px";
    //dvCancelBookingPopup.style.height = "200px";
    //dvCancelBookingPopup.style.width = "53%";
    //dvCancelBookingPopup.style.position = 'fixed';
    ////dvCancelBookingPopup.innerHTML = "<center><img src='../Content/themes/base/images/AJAXloading.gif' width='48px' height='48px' /></center>";

    //$("#fadedDiv").fadeIn("slow");
    //$("#dvConfirmPopup").fadeIn("slow");


}

// This method hides confirm window
function HideConfirmWindow() {
    $("#fadedDiv").fadeOut("slow");
    $("#dvConfirmPopup").fadeOut("slow");
    ClearCancelBookingControl();

}

// This method opens confirm window
function OpenControlCentreWindow() {

    ShowFadedDiv();
    var dvControlCentrePopup = document.getElementById("dvControlCentrePopup");

    if (IsIE7 == true) {
        //$("#dvCancelBookingPopup").css("left", "40%");
        dvControlCentrePopup.style.left = 0;
        //  $("#dvCancelPopupInner").css("position", "relative");
        $("#dvControlCentrePopup").css("position", "absolute");
        $("#dvControlCentrePopup").css("display", "block");
    }
    else {

        dvControlCentrePopup.style.zIndex = "201";
        dvControlCentrePopup.style.top = "200px";
        dvControlCentrePopup.style.height = "320px";
        dvControlCentrePopup.style.width = '53%';
        dvControlCentrePopup.style.position = 'fixed';
        $("#dvControlCentrePopup").fadeIn("slow");
    }

 


}

// This method hides confirm window
function HideControCentreWindow() {
    $("#fadedDiv").fadeOut("slow");
    $("#dvControlCentrePopup").fadeOut("slow");
    ClearCancelBookingControl();

}

// This method oresets all indo
function ResetAll() {
    ResetPatient();
    ResetTabs();
    var e = document.getElementById("ddlControlCenter");
    e.options.selectedIndex = 0;

    var e = document.getElementById("ddlTransferReason");
    e.options.selectedIndex = 0;

    var e = document.getElementById("ddlSuburb");
    e.options.length = 0;

    var e = document.getElementById("ddlwardcolectionpoint");
    e.options.length = 0;

    var e = document.getElementById("ddlFacility");
    e.options.length = 0;

    var e = document.getElementById("ddlPatientMobility");
    e.options.selectedIndex = 0;

    var e = document.getElementById("ddlPatientEscort");
    e.options.selectedIndex = 0;

    var e = document.getElementById("ddlAirTransport");
    e.options.selectedIndex = 0;

    $("#txtTransportDate").val("");
    $("#txtReferringPerson").val("");
    $("#txtContactNo").val("");
    $("#txtClinician").val("");

    var e = document.getElementById("ddlDropHospital");
    e.options.length = 0;

    var e = document.getElementById("ddlDropClinic");
    e.options.length = 0;

    var e = document.getElementById("ddlAppointmentReason");
    e.options.selectedIndex = 0;

    $("#txtNotesAppoiment").val("");


    //discharge
    var e = document.getElementById("ddlDropCity");
    e.options.selectedIndex = 0;

    var e = document.getElementById("ddlDropSuburb");
    e.options.length = 0;

    var e = document.getElementById("ddlDropFacility");
    e.options.length = 0;

    var e = document.getElementById("ddlDropWard");
    e.options.length = 0;

    var e = document.getElementById("ddlFollowup");
    e.selectedIndex = 0;
    $("#txtNotesDischage").val("");
    $("#txtLoginnameDscrg").val("");
    $("#txtContactNoDschrg").val("");

    var e = document.getElementById("ddlFacilityiht");
    e.selectedIndex = 0;

    var e = document.getElementById("ddlWardiht");
    e.selectedIndex = 0;
    var e = document.getElementById("ddlAppointmentReasoniht");
    e.selectedIndex = 0;

    $("#txtReceivingContactNo").val("");
    LoadMedicalRequirements();

    var tdMedicalRequirement = smedreq;
    var txtNotesAppoiment = $("#TextareaNotesIht").val("");
    $("#wizard div#step-1 ").css("background-color", "#ffffff");
    $("#wizard  .button-empty-div").css("background-color", "#ffffff");

}

// This method saves case
function SaveCase() {

    var smedreq = "";

    var medicalrequirements = $("#dmedicalRequirement input:checkbox").map(function () {
        chValue = $(this).val().split(',')

        if ((chValue[1] != "0") || ($(this)[0].checked)) {
            return $(this).val();
        }
    }).get();

    for (var i = 0; i < medicalrequirements.length; i++) {
        if (i > 0) {
            smedreq = smedreq + "|";
        }
        smedreq = smedreq + medicalrequirements[i];
    }

    var today = new Date()
    var dd = new Date("October 13, 1975 11:13:00")
    var baseUri = '@ViewBag.ApiUrl';

    //receice booking details
    var callID = 0;
    var caseid = base64_decode(getParameterByName("BID"));

    if (caseid > 0) {
        callID = caseid;
    }
    else {
        callID = 0;
    }

    var caseType = 3;
    var caseDateTime = dd;

    var e = document.getElementById("ddlControlCenter");
    var ddlControlCenter = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlCollectionDistrict");
    var ddlCollectionDistrict = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlTransferReason");
    var ddlTransferReason = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlCollectionTown");
    var ddlCollectionTown = e.options[e.selectedIndex].value;

    var collectionAddressType = 0;

    var rbHome = document.getElementById("rbHome").checked;

    var rbHomeAddress = document.getElementById("rbHomeAddress").checked;

    var rbFacility = document.getElementById("rbFacility").checked;

    if (rbHomeAddress)
    {
        collectionAddressType = 1;
    }
    else if (rbHome)
    {
        collectionAddressType = 2;
    }
    else if (rbFacility) {
        collectionAddressType = 3;
    }
    else {
        collectionAddressType = 3;
    }



    var e = document.getElementById("ddlwardcolectionpoint");
    var ddlwardcolectionpoint = e.options[e.selectedIndex].value;

    var ddlFacility = "";
    if (collectionAddressType == 3) {
        var e = document.getElementById("ddlFacility");
        ddlFacility = e.options[e.selectedIndex].value;
    }




    //var e = document.getElementById("ddlPatientMobility");
    //var ddlPatientMobility = e.options[e.selectedIndex].value;

    var ddlPatientMobility;
    var e = document.getElementById("ddlPatientMobility");
    if (e.options.length > 0)
        ddlPatientMobility = e.options[e.selectedIndex].value;
    else
        ddlPatientMobility = 0;



    var e = document.getElementById("ddlPatientEscort");
    var ddlPatientEscort = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlAirTransport");
    var ddlAirTransport = e.options[e.selectedIndex].value;


    var txtTransportDate = $("#txtTransportDate").val();
    var txtReferringPerson = $("#txtReferringPerson").val();
    var txtContactNo = $("#txtContactNo").val();
    var txtClinician = $("#txtClinician").val();





    //new fields >>
    var ddlHomeDistrict = "";
    var ddlHomeTown = "";
    var ddlHomeSuburb = "";
    var txtHomeAddressLine1 = "";
    var txtHomeAddressLine2 = "";
    //new fields <<

    if (collectionAddressType == 1)
    {
        
        var e = document.getElementById("ddlHomeDistrict");
        if (e.options.length > 0)
            ddlHomeDistrict = e.options[e.selectedIndex].value;
        else
            ddlHomeDistrict = 0;

        var e = document.getElementById("ddlHomeTown");
        if (e.options.length > 0)
            ddlHomeTown = e.options[e.selectedIndex].value;
        else
            ddlHomeTown = 0;

        var e = document.getElementById("ddlHomeSuburb");
        if (e.options.length > 0)
            ddlHomeSuburb = e.options[e.selectedIndex].value;
        else
            ddlHomeSuburb = 0;

         txtHomeAddressLine1 = $("#txtHomeAddressLine1").val();
         txtHomeAddressLine2 = $("#txtClinician").val();
    }




    //patient
    var txtPatientID = $("#txtPatientID").val();
    var txtIDNumber = $("#txtIDNumber").val();
    var txtPMI = $("#txtPMI").val();
    var txtPatientName = $("#txtPatientName").val();
    var txtSurname = $("#txtSurname").val();

    var e = document.getElementById("ddlGender");
    var ddlGender = e.options[e.selectedIndex].value;
    var txtAge = $("#txtAge").val();
    var e = document.getElementById("ddlAgeType");
    var ddlAgeType = e.options[e.selectedIndex].value;
    var txtPatientContactNo = $("#txtPatientContactNo").val();
    var txtAddressLine1 = $("#txtAddressLine1").val();
    var txtAddressLine2 = $("#txtAddressLine2").val();

    var e = document.getElementById("ddlPatientSuburb");
    var ddlPatientSuburb = e.options[e.selectedIndex].value; // document.getElementById("ddlPatientSuburb").options[e.selectedIndex].value;

    var e = document.getElementById("ddlCity");
    var ddlCity = e.options[e.selectedIndex].value; //e.options[e.selectedIndex].value;


    var callSourceID = 2;
    var e = document.getElementById("ddlGender");
    var ddlGender = e.options[e.selectedIndex].value;
    var txtAge = $("#txtAge").val();
    var e = document.getElementById("ddlAgeType");
    var ddlAgeType = e.options[e.selectedIndex].value;
    var txtPatientContactNo = $("#txtPatientContactNo").val();
    var txtAddressLine1 = $("#txtAddressLine1").val();

    // patient new fields
    var e = document.getElementById("ddlCommunicalbleDisease");
    var ddlCommunicalbleDisease = e.options[e.selectedIndex].value;
    var txtPatientNextToKin = $("#txtPatientNextToKin").val();
    var txtNextOfKinContactNo = $("#txtNextOfKinContactNo").val();
    // patient new fields



    //drop booking details

    var jsondata = "";

    var District = "";
    var DropSuburb = "";
    var DropHospital = 0;
    var DropClinic = "";
    var Followup = "";
    var NotesAppoiment = "";
    var LoginNameApp = "";
    var LoginContactNoApp = "";
    var HomeDrop = false;
    var NotesDischage = "";
    var LoginnameDscrg = "";
    var ContactNoDschrg = "";
    var Facilityiht = "";
    var Wardiht = "";

    var AppointmentReasoniht = "";
    var ReceivingContactNo = "";
    var MedicalRequirement = "";
    var TextareaNotesIht = "";
    var LoginNameiht = "";
    var txtContactNoiht = "";
    var DropFacility = "";
    var DropWard = "";

    var DropHospital = "";
    var DropClinic = "";
    var AppointmentReason = "";
    var MedicalRequirement = "";
    var NotesAppoiment = "";
    var LoginNameApp = "";
    var LoginContactNoApp = "";
    var loginUserID = getCookie("UserID");
    var isChanged = false;
    var emergencyBooking = false;

    //new fields >>
    var dropAddressType = 3;
    var ddlHomeDropDistrictDscg = "";
    var ddlHomeDropTownDscg = "";
    var ddlHomeDropSuburb = "";
    var txtHomeDropAddressLine1 = "";
    var txtHomeDropAddressLine2 = "";
    var txtReceivingPerson = "";
    var txtReceivingClinician = "";
    var ddlDropDistrictiht = "";
    var ddlDropTowniht = "";
    //new fields <<

    //appt
    if (ddlTransferReason == 1) {

        //new fields >>
        var e = document.getElementById("ddlApptDropDistrict");
        var District = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlApptDropTown");
        var DropSuburb = e.options[e.selectedIndex].value;
        //new fields <<

        var e = document.getElementById("ddlDropHospital");
        var ddlDropHospital = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlDropClinic");
        var ddlDropClinic = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlAppointmentReason");
        var AppointmentReason = e.options[e.selectedIndex].value;
        var txtNotesAppoiment = $("#txtNotesAppoiment").val();
        var txtLoginNameApp = $("#txtLoginNameApp").val();
        var txtLoginContactNoApp = $("#txtLoginContactNoApp").val();
        var e = document.getElementById("ddlCollectionTimeApp");
        //var ddlCollectionTimeApp = e.options[e.selectedIndex].value;

        emergencyBooking = document.getElementById("chkEmergencyBooking").checked;   //if emergency booking

       // 

        txtTransportDate = txtTransportDate + " " + "16:00";

        txtTransportDate = txtTransportDate.split(' ');

        //if (ddlCollectionTimeApp == 0)
        //    txtTransportDate = txtTransportDate + " " + "00:00";
        //else
        //    txtTransportDate = txtTransportDate + " " + ddlCollectionTimeApp;

        var ddlCollectionTimeApp = txtTransportDate[1];

        //  if (ddlCollectionTimeDscg == 0)
        //      txtTransportDate = txtTransportDate + " " + "00:00";
        //  else
        txtTransportDate = txtTransportDate[0] + " " + ddlCollectionTimeApp;

      

        if ((callID > 0) && (OriginalDate != txtTransportDate || OrignialMobility != ddlPatientMobility || OrignialCollectionPointID != ddlwardcolectionpoint || OrignialDropPointID != ddlDropClinic || ORrginalEscort != ddlPatientEscort)) {
            isChanged = true;
        }


        jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlCollectionDistrict, ddlTransferReason, ddlCollectionTown, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, AppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, ReceivingContactNo, MedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID, isChanged, emergencyBooking,
            collectionAddressType, ddlHomeDistrict, ddlHomeTown, ddlHomeSuburb, txtHomeAddressLine1, txtHomeAddressLine2, ddlCommunicalbleDisease, txtPatientNextToKin, txtNextOfKinContactNo, ddlHomeDropDistrictDscg, ddlHomeDropTownDscg, ddlHomeDropSuburb, txtHomeDropAddressLine1, txtHomeDropAddressLine2, txtReceivingPerson, txtReceivingClinician, dropAddressType, ddlControlCenter]);
        //  jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, AppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, ReceivingContactNo, MedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID]);
    }

    //discharge
    if (ddlTransferReason == 2) {
        var e = document.getElementById("ddlDropDistrictDscg");
        District = e.options[e.selectedIndex].value; //   e.options[e.selectedIndex].value;   //drop district

        HomeDrop = document.getElementById("rbHomeDrop").checked;   //if home

        rbHomeDropAddress = document.getElementById("rbHomeDropAddress").checked;

        rbFacilityDrop = document.getElementById("rbFacilityDrop").checked;


        if (rbHomeDropAddress)
        {
            dropAddressType = 1;
        }

        else if (HomeDrop)
        {
            dropAddressType = 2;
        }
       
        else if (rbFacilityDrop) {
            dropAddressType = 3;
        }
        else {
            dropAddressType = 3;
        }

        if (dropAddressType == 1) {

            var e = document.getElementById("ddlHomeDropDistrictDscg");
            if (e.options.length > 0)
                ddlHomeDropDistrictDscg = e.options[e.selectedIndex].value;
            else
                ddlHomeDropDistrictDscg = 0;

            var e = document.getElementById("ddlHomeDropTownDscg");
            if (e.options.length > 0)
                ddlHomeDropTownDscg = e.options[e.selectedIndex].value;
            else
                ddlHomeDropTownDscg = 0;

            var e = document.getElementById("ddlHomeDropSuburb");
            if (e.options.length > 0)
                ddlHomeDropSuburb = e.options[e.selectedIndex].value;
            else
                ddlHomeDropSuburb = 0;

            txtHomeDropAddressLine1 = $("#txtHomeDropAddressLine1").val();
            txtHomeDropAddressLine2 = $("#txtHomeDropAddressLine2").val();
        }

        var e = document.getElementById("ddlDropTownDscg");

        DropSuburb = e.options[e.selectedIndex].value;     // itown

       // emergencyBooking =    document.getElementById("chkEmergencyBookingDisc").checked;   //if emergency booking

        var e = document.getElementById("ddlDropFacility");
        if (e.options.length > 0) {
            ddlDropHospital = e.options[e.selectedIndex].value;
        }

        var e = document.getElementById("ddlDropWard");
        ddlDropClinic = e.options[e.selectedIndex].value;

        var e = document.getElementById("ddlFollowup");
        Followup = e.options[e.selectedIndex].value;   // follow
        txtNotesAppoiment = $("#txtNotesDischage").val();
        txtLoginNameApp = $("#txtLoginnameDscrg").val();
        txtLoginContactNoApp = $("#txtContactNoDschrg").val();

        txtTransportDate = txtTransportDate.split(' ');

        // var e = document.getElementById("ddlCollectionTimeDscg");
        // var ddlCollectionTimeDscg = e.options[e.selectedIndex].value;

        var ddlCollectionTimeDscg = txtTransportDate[1];

        //  if (ddlCollectionTimeDscg == 0)
        //      txtTransportDate = txtTransportDate + " " + "00:00";
        //  else
        txtTransportDate = txtTransportDate[0] + " " + ddlCollectionTimeDscg;

        jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlCollectionDistrict, ddlTransferReason, ddlCollectionTown, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, AppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, ReceivingContactNo, MedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID, isChanged, emergencyBooking,
            collectionAddressType, ddlHomeDistrict, ddlHomeTown, ddlHomeSuburb, txtHomeAddressLine1, txtHomeAddressLine2, ddlCommunicalbleDisease, txtPatientNextToKin, txtNextOfKinContactNo, ddlHomeDropDistrictDscg, ddlHomeDropTownDscg, ddlHomeDropSuburb, txtHomeDropAddressLine1, txtHomeDropAddressLine2, txtReceivingPerson, txtReceivingClinician, dropAddressType, ddlControlCenter]);
    }


    
    //iht
    if (ddlTransferReason == 3) {
        //new fields >>
        var e = document.getElementById("ddlDropDistrictiht");
        var District = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlDropTowniht");
        var DropSuburb = e.options[e.selectedIndex].value;
        //new fields <<

        var e = document.getElementById("ddlFacilityiht");
        var ddlDropHospital = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlWardiht");
        var ddlDropClinic = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlAppointmentReasoniht");
        var AppointmentReason = e.options[e.selectedIndex].value;
        var txtReceivingContactNo = $("#txtReceivingContactNo").val();
        var tdMedicalRequirement = smedreq;
        var txtNotesAppoiment = $("#TextareaNotesIht").val();
        var txtLoginNameApp = $("#txtLoginNameiht").val();
        var txtLoginContactNoApp = $("#txtContactNoiht").val();


        var txtReceivingPerson = $("#txtReceivingPerson").val();
        var txtReceivingClinician = $("#txtReceivingClinician").val();

        // var e = document.getElementById("ddlCollectionTimeift");
        // var ddlCollectionTimeift = e.options[e.selectedIndex].value;

        txtTransportDate = txtTransportDate.split(' ');
        var ddlCollectionTimeift = txtTransportDate[1];

        // if (ddlCollectionTimeift == 0)
        //     txtTransportDate = txtTransportDate + " " + "00:00";
        // else
        txtTransportDate = txtTransportDate[0] + " " + ddlCollectionTimeift;


        // jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, ddlAppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, ReceivingContactNo, tdMedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID]);
        jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlCollectionDistrict, ddlTransferReason, ddlCollectionTown, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, AppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, txtReceivingContactNo, tdMedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID, isChanged, emergencyBooking,
            collectionAddressType, ddlHomeDistrict, ddlHomeTown, ddlHomeSuburb, txtHomeAddressLine1, txtHomeAddressLine2, ddlCommunicalbleDisease, txtPatientNextToKin, txtNextOfKinContactNo, ddlHomeDropDistrictDscg, ddlHomeDropTownDscg, ddlHomeDropSuburb, txtHomeDropAddressLine1, txtHomeDropAddressLine2, txtReceivingPerson, txtReceivingClinician, dropAddressType, ddlControlCenter]);
    }



    $.ajax({
        url: WebAPIURL + 'SaveOnlineBookingCase',
        type: "Post",
        async: false,
        data: jsondata, //JSON.stringify([callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, ddlAppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, ddlDistrict, rbHomeDrop, ddlDropSuburb, ddlFollowup, txtNotesDischage, txtLoginnameDscrg, txtContactNoDschrg, ddlFacilityiht, ddlWardiht, ddlAppointmentReasoniht, txtReceivingContactNo, tdMedicalRequirement, TextareaNotesIht, txtLoginNameiht, txtContactNoiht, ddlDropFacility, ddlDropWard, loginUserID, TripEventID]),
        // data: JSON.stringify([callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, ddlAppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp]),
        // data: [callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, ddlAppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, ddlDistrict, rbHomeDrop, ddlDropSuburb, ddlFollowup, txtNotesDischage, txtLoginnameDscrg, txtContactNoDschrg, ddlFacilityiht, ddlWardiht, ddlAppointmentReasoniht, txtReceivingContactNo, tdMedicalRequirement, TextareaNotesIht, txtLoginNameiht, txtContactNoiht, ddlDropFacility, ddlDropWard, loginUserID, TripEventID],


        contentType: 'application/json; charset=utf-8',
        beforeSend: function () {
            $("#ILoaderSave")[0].style.display = "block";
        },
        complete: function () {
            $("#ILoaderSave")[0].style.display = "none";
        },

        success: function (data) {
            //
            if ((data.SeatAvailability == null) || (!data.SeatAvailability)) {
                $("#addbookingheading")[0].innerHTML = "";
                $("#step-3").css("display", "none");
                $("#step-5").css("display", "none");
                $("#step-4").css("display", "block");
                $("#btnPrevious").css("display", "none");
                $("#btnPreview").css("display", "none");
                $("#btnAdd").css("display", "none");
                $("#tab-3").removeClass("selectedtab");
                $("#tab-3").addClass("visitedtab");
                $("#txtPatientID").val(data.PatientID);

                if ($("#tab-4").attr('class') == "selectedtab") {
                    $("#tab-4").removeClass("selectedtab");
                    $("#tab-4").addClass("tab");
                }

                if ($("#tab-4").attr('class') == "visitedtab") {
                    $("#tab-4").removeClass("visitedtab");
                    $("#tab-4").addClass("tab");
                }

                if ($("#tab-3").attr('class') == "selectedtab") {
                    $("#tab-3").removeClass("selectedtab");
                    $("#tab-3").addClass("tab");
                }

                if ($("#tab-3").attr('class') == "visitedtab") {
                    $("#tab-3").removeClass("visitedtab");
                    $("#tab-3").addClass("tab");
                }

                if ($("#tab-2").attr('class') == "selectedtab") {
                    $("#tab-2").removeClass("selectedtab");
                    $("#tab-2").addClass("visitedtab");
                }

                if ($("#tab-2").attr('class') == "visitedtab") {
                    $("#tab-2").removeClass("visitedtab");
                    $("#tab-2").addClass("tab");
                }

                if ($("#tab-1").attr('class') == "selectedtab") {
                    $("#tab-1").removeClass("selectedtab");
                    $("#tab-1").addClass("visitedtab");
                }


                if ($("#tab-1").attr('class') == "visitedtab") {
                    $("#tab-1").removeClass("visitedtab");
                    $("#tab-1").addClass("tab");
                }


                //    var printLink = '../Bookings/PrintBooking?CID=' + data.CallID
                //     document.getElementById('btnPrint').setAttribute("onclick", 'window.location.href = ' + "'" + printLink + "'");


                if (data.AvailabilityMessage.indexOf("dispatched") > -1) {
                    $("#dOtherAvailableDates").css("display", "none");
                    $("#btnErrorSave").css("display", "none");
                    $("#btnErrorViewBookings").css("display", "block");
                    $("#btnOtherDates").css("display", "none");
                    var successMessage = "<p class='lable' id='lblAvailabilityMessage' style='width: 100%;text-align: center;' s >" + data.AvailabilityMessage + + "</b></p>";
                    $("#noseatMessage").html(successMessage)
                }

                else if (data.AvailabilityMessage.indexOf("schedule ") > -1) {
                    $("#dOtherAvailableDates").css("display", "none");
                    $("#btnErrorSave").css("display", "none");
                    $("#btnErrorViewBookings").css("display", "none");
                    $("#btnOtherDates").css("display", "block");
                    $("#btnMovePatient").css("display", "none");
                    $("#btnErrorCase").css("padding-left", "37%");

                    var successMessage = "<p class='lable' id='lblAvailabilityMessage' style='width: 100%;text-align: center;' s >" + data.AvailabilityMessage + " What do you want to do? " + "</b></p>";
                    $("#noseatMessage").html(successMessage)
                }

                else {
                    $("#btnMovePatient").css("display", "block");


                    

                    $("#btnErrorCase").css("padding-left", "27%");

                    var successMessage = "<p class='lable' style='width: 100%;text-align: center;' s >" + data.AvailabilityMessage + " What do you want to do?. " + "</b></p>";
                    $("#noseatMessage").html(successMessage);
                }
            }


                //if (!data.SeatAvailability)
                //{
                //    var errorMessage = "We are sorry, no seat available for this date. please choose another date. "
                //   // runEffect();
                //   // $("#dvAlertMessage").html(errorMessage);
                //  //  window.scrollTo(0, 0);
                //   // $("#body").scrollTo(0, 0);
                //    //   $("#dvRightContainer").scrollTop(0);

                //    OpenPromptWindow(errorMessage, 0);
                //}

            else if (data.ReferenceNo != null) {
                $("#addbookingheading")[0].innerHTML = "";
                $("#step-3").css("display", "none");
                $("#step-4").css("display", "none");
                $("#step-5").css("display", "block");
                $("#btnPrevious").css("display", "none");
                $("#btnPreview").css("display", "none");
                $("#btnAdd").css("display", "none");
                //  $("#tab-3").removeClass("selectedtab");
                //  $("#tab-3").addClass("visitedtab");

                if ($("#tab-4").attr('class') == "selectedtab") {
                    $("#tab-4").removeClass("selectedtab");
                    $("#tab-4").addClass("tab");
                }

                if ($("#tab-4").attr('class') == "visitedtab") {
                    $("#tab-4").removeClass("visitedtab");
                    $("#tab-4").addClass("tab");
                }

                if ($("#tab-3").attr('class') == "selectedtab") {
                    $("#tab-3").removeClass("selectedtab");
                    $("#tab-3").addClass("tab");
                }

                if ($("#tab-3").attr('class') == "visitedtab") {
                    $("#tab-3").removeClass("visitedtab");
                    $("#tab-3").addClass("tab");
                }

                if ($("#tab-2").attr('class') == "selectedtab") {
                    $("#tab-2").removeClass("selectedtab");
                    $("#tab-2").addClass("visitedtab");
                }


                if ($("#tab-2").attr('class') == "visitedtab") {
                    $("#tab-2").removeClass("visitedtab");
                    $("#tab-2").addClass("tab");
                }

                if ($("#tab-1").attr('class') == "selectedtab") {
                    $("#tab-1").removeClass("selectedtab");
                    $("#tab-1").addClass("visitedtab");
                }


                if ($("#tab-1").attr('class') == "visitedtab") {
                    $("#tab-1").removeClass("visitedtab");
                    $("#tab-1").addClass("tab");
                }

                var printLink = '../Bookings/PrintBooking?CID=' + base64_encode('"' + data.CallID + '"');



                document.getElementById('btnPrint').setAttribute("onclick", 'window.location.href = ' + "'" + printLink + "'");


                var successMessage = "<p class='lable' style='width: 100%;text-align: center;' s >Booking has been saved successfully. " + "The Reference number for saved booking is <b>" + data.ReferenceNo + "</b></p>";
                $("#successMessage").html(successMessage)

                // GetTemplate(2, data.CallID);
            }



            // runEffect();
            // $("#dvAlertMessage").html(successMessage);
            // ResetAll();
        },
        error: function () { alert('error'); }
    });
}


// This method saves case
function GetTransferableCases() {

    var smedreq = "";

    var medicalrequirements = $("#dmedicalRequirement input:checkbox").map(function () {
        chValue = $(this).val().split(',')

        if ((chValue[1] != "0") || ($(this)[0].checked)) {
            return $(this).val();
        }
    }).get();

    for (var i = 0; i < medicalrequirements.length; i++) {
        if (i > 0) {
            smedreq = smedreq + "|";
        }
        smedreq = smedreq + medicalrequirements[i];
    }

    var today = new Date()
    var dd = new Date("October 13, 1975 11:13:00")
    var baseUri = '@ViewBag.ApiUrl';

    //receice booking details
    var callID = 0;
    var caseid = base64_decode(getParameterByName("BID"));

    if (caseid > 0) {
        callID = caseid;
    }
    else {
        callID = 0;
    }

    var caseType = 3;
    var caseDateTime = dd;

    var e = document.getElementById("ddlControlCenter");
    var ddlControlCenter = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlCollectionDistrict");
    var ddlCollectionDistrict = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlTransferReason");
    var ddlTransferReason = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlCollectionTown");
    var ddlCollectionTown = e.options[e.selectedIndex].value;

    var collectionAddressType = 0;

    var rbHome = document.getElementById("rbHome").checked;

    var rbHomeAddress = document.getElementById("rbHomeAddress").checked;

    var rbFacility = document.getElementById("rbFacility").checked;

    if (rbHomeAddress) {
        collectionAddressType = 1;
    }
    else if (rbHome) {
        collectionAddressType = 2;
    }
    else if (rbFacility) {
        collectionAddressType = 3;
    }
    else {
        collectionAddressType = 3;
    }



    var e = document.getElementById("ddlwardcolectionpoint");
    var ddlwardcolectionpoint = e.options[e.selectedIndex].value;

    var ddlFacility = "";
    if (collectionAddressType == 3) {
        var e = document.getElementById("ddlFacility");
        ddlFacility = e.options[e.selectedIndex].value;
    }




    //var e = document.getElementById("ddlPatientMobility");
    //var ddlPatientMobility = e.options[e.selectedIndex].value;

    var ddlPatientMobility;
    var e = document.getElementById("ddlPatientMobility");
    if (e.options.length > 0)
        ddlPatientMobility = e.options[e.selectedIndex].value;
    else
        ddlPatientMobility = 0;



    var e = document.getElementById("ddlPatientEscort");
    var ddlPatientEscort = e.options[e.selectedIndex].value;

    var e = document.getElementById("ddlAirTransport");
    var ddlAirTransport = e.options[e.selectedIndex].value;


    var txtTransportDate = $("#txtTransportDate").val();
    var txtReferringPerson = $("#txtReferringPerson").val();
    var txtContactNo = $("#txtContactNo").val();
    var txtClinician = $("#txtClinician").val();

    //new fields >>
    var ddlHomeDistrict = "";
    var ddlHomeTown = "";
    var ddlHomeSuburb = "";
    var txtHomeAddressLine1 = "";
    var txtHomeAddressLine2 = "";
    //new fields <<

    if (collectionAddressType == 1) {

        var e = document.getElementById("ddlHomeDistrict");
        if (e.options.length > 0)
            ddlHomeDistrict = e.options[e.selectedIndex].value;
        else
            ddlHomeDistrict = 0;

        var e = document.getElementById("ddlHomeTown");
        if (e.options.length > 0)
            ddlHomeTown = e.options[e.selectedIndex].value;
        else
            ddlHomeTown = 0;

        var e = document.getElementById("ddlHomeSuburb");
        if (e.options.length > 0)
            ddlHomeSuburb = e.options[e.selectedIndex].value;
        else
            ddlHomeSuburb = 0;

        txtHomeAddressLine1 = $("#txtHomeAddressLine1").val();
        txtHomeAddressLine2 = $("#txtClinician").val();
    }




    //patient
    var txtPatientID = $("#txtPatientID").val();
    var txtIDNumber = $("#txtIDNumber").val();
    var txtPMI = $("#txtPMI").val();
    var txtPatientName = $("#txtPatientName").val();
    var txtSurname = $("#txtSurname").val();

    var e = document.getElementById("ddlGender");
    var ddlGender = e.options[e.selectedIndex].value;
    var txtAge = $("#txtAge").val();
    var e = document.getElementById("ddlAgeType");
    var ddlAgeType = e.options[e.selectedIndex].value;
    var txtPatientContactNo = $("#txtPatientContactNo").val();
    var txtAddressLine1 = $("#txtAddressLine1").val();
    var txtAddressLine2 = $("#txtAddressLine2").val();

    var e = document.getElementById("ddlPatientSuburb");
    var ddlPatientSuburb = e.options[e.selectedIndex].value; // document.getElementById("ddlPatientSuburb").options[e.selectedIndex].value;

    var e = document.getElementById("ddlCity");
    var ddlCity = e.options[e.selectedIndex].value; //e.options[e.selectedIndex].value;


    var callSourceID = 2;
    var e = document.getElementById("ddlGender");
    var ddlGender = e.options[e.selectedIndex].value;
    var txtAge = $("#txtAge").val();
    var e = document.getElementById("ddlAgeType");
    var ddlAgeType = e.options[e.selectedIndex].value;
    var txtPatientContactNo = $("#txtPatientContactNo").val();
    var txtAddressLine1 = $("#txtAddressLine1").val();

    // patient new fields
    var e = document.getElementById("ddlCommunicalbleDisease");
    var ddlCommunicalbleDisease = e.options[e.selectedIndex].value;
    var txtPatientNextToKin = $("#txtPatientNextToKin").val();
    var txtNextOfKinContactNo = $("#txtNextOfKinContactNo").val();
    // patient new fields



    //drop booking details

    var jsondata = "";

    var District = "";
    var DropSuburb = "";
    var DropHospital = 0;
    var DropClinic = "";
    var Followup = "";
    var NotesAppoiment = "";
    var LoginNameApp = "";
    var LoginContactNoApp = "";
    var HomeDrop = false;
    var NotesDischage = "";
    var LoginnameDscrg = "";
    var ContactNoDschrg = "";
    var Facilityiht = "";
    var Wardiht = "";

    var AppointmentReasoniht = "";
    var ReceivingContactNo = "";
    var MedicalRequirement = "";
    var TextareaNotesIht = "";
    var LoginNameiht = "";
    var txtContactNoiht = "";
    var DropFacility = "";
    var DropWard = "";

    var DropHospital = "";
    var DropClinic = "";
    var AppointmentReason = "";
    var MedicalRequirement = "";
    var NotesAppoiment = "";
    var LoginNameApp = "";
    var LoginContactNoApp = "";
    var loginUserID = getCookie("UserID");
    var isChanged = false;
    var emergencyBooking = false;

    //new fields >>
    var dropAddressType = 3;
    var ddlHomeDropDistrictDscg = "";
    var ddlHomeDropTownDscg = "";
    var ddlHomeDropSuburb = "";
    var txtHomeDropAddressLine1 = "";
    var txtHomeDropAddressLine2 = "";
    var txtReceivingPerson = "";
    var txtReceivingClinician = "";
    var ddlDropDistrictiht = "";
    var ddlDropTowniht = "";
    //new fields <<

    //appt
    if (ddlTransferReason == 1) {

        //new fields >>
        var e = document.getElementById("ddlApptDropDistrict");
        var District = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlApptDropTown");
        var DropSuburb = e.options[e.selectedIndex].value;
        //new fields <<

        var e = document.getElementById("ddlDropHospital");
        var ddlDropHospital = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlDropClinic");
        var ddlDropClinic = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlAppointmentReason");
        var AppointmentReason = e.options[e.selectedIndex].value;
        var txtNotesAppoiment = $("#txtNotesAppoiment").val();
        var txtLoginNameApp = $("#txtLoginNameApp").val();
        var txtLoginContactNoApp = $("#txtLoginContactNoApp").val();
        var e = document.getElementById("ddlCollectionTimeApp");
        //var ddlCollectionTimeApp = e.options[e.selectedIndex].value;

        emergencyBooking = document.getElementById("chkEmergencyBooking").checked;   //if emergency booking

        // 

        txtTransportDate = txtTransportDate + " " + "16:00";

        txtTransportDate = txtTransportDate.split(' ');

        //if (ddlCollectionTimeApp == 0)
        //    txtTransportDate = txtTransportDate + " " + "00:00";
        //else
        //    txtTransportDate = txtTransportDate + " " + ddlCollectionTimeApp;

        var ddlCollectionTimeApp = txtTransportDate[1];

        //  if (ddlCollectionTimeDscg == 0)
        //      txtTransportDate = txtTransportDate + " " + "00:00";
        //  else
        txtTransportDate = txtTransportDate[0] + " " + ddlCollectionTimeApp;



        if ((callID > 0) && (OriginalDate != txtTransportDate || OrignialMobility != ddlPatientMobility || OrignialCollectionPointID != ddlwardcolectionpoint || OrignialDropPointID != ddlDropClinic || ORrginalEscort != ddlPatientEscort)) {
            isChanged = true;
        }


        jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlCollectionDistrict, ddlTransferReason, ddlCollectionTown, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, AppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, ReceivingContactNo, MedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID, isChanged, emergencyBooking,
            collectionAddressType, ddlHomeDistrict, ddlHomeTown, ddlHomeSuburb, txtHomeAddressLine1, txtHomeAddressLine2, ddlCommunicalbleDisease, txtPatientNextToKin, txtNextOfKinContactNo, ddlHomeDropDistrictDscg, ddlHomeDropTownDscg, ddlHomeDropSuburb, txtHomeDropAddressLine1, txtHomeDropAddressLine2, txtReceivingPerson, txtReceivingClinician, dropAddressType, ddlControlCenter]);
        //  jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, AppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, ReceivingContactNo, MedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID]);
    }

    //discharge
    if (ddlTransferReason == 2) {
        var e = document.getElementById("ddlDropDistrictDscg");
        District = e.options[e.selectedIndex].value; //   e.options[e.selectedIndex].value;   //drop district

        HomeDrop = document.getElementById("rbHomeDrop").checked;   //if home

        rbHomeDropAddress = document.getElementById("rbHomeDropAddress").checked;

        rbFacilityDrop = document.getElementById("rbFacilityDrop").checked;


        if (rbHomeDropAddress) {
            dropAddressType = 1;
        }

        else if (HomeDrop) {
            dropAddressType = 2;
        }

        else if (rbFacilityDrop) {
            dropAddressType = 3;
        }
        else {
            dropAddressType = 3;
        }

        if (dropAddressType == 1) {

            var e = document.getElementById("ddlHomeDropDistrictDscg");
            if (e.options.length > 0)
                ddlHomeDropDistrictDscg = e.options[e.selectedIndex].value;
            else
                ddlHomeDropDistrictDscg = 0;

            var e = document.getElementById("ddlHomeDropTownDscg");
            if (e.options.length > 0)
                ddlHomeDropTownDscg = e.options[e.selectedIndex].value;
            else
                ddlHomeDropTownDscg = 0;

            var e = document.getElementById("ddlHomeDropSuburb");
            if (e.options.length > 0)
                ddlHomeDropSuburb = e.options[e.selectedIndex].value;
            else
                ddlHomeDropSuburb = 0;

            txtHomeDropAddressLine1 = $("#txtHomeDropAddressLine1").val();
            txtHomeDropAddressLine2 = $("#txtHomeDropAddressLine2").val();
        }

        var e = document.getElementById("ddlDropTownDscg");

        DropSuburb = e.options[e.selectedIndex].value;     // itown

        // emergencyBooking =    document.getElementById("chkEmergencyBookingDisc").checked;   //if emergency booking

        var e = document.getElementById("ddlDropFacility");
        if (e.options.length > 0) {
            ddlDropHospital = e.options[e.selectedIndex].value;
        }

        var e = document.getElementById("ddlDropWard");
        ddlDropClinic = e.options[e.selectedIndex].value;

        var e = document.getElementById("ddlFollowup");
        Followup = e.options[e.selectedIndex].value;   // follow
        txtNotesAppoiment = $("#txtNotesDischage").val();
        txtLoginNameApp = $("#txtLoginnameDscrg").val();
        txtLoginContactNoApp = $("#txtContactNoDschrg").val();

        txtTransportDate = txtTransportDate.split(' ');

        // var e = document.getElementById("ddlCollectionTimeDscg");
        // var ddlCollectionTimeDscg = e.options[e.selectedIndex].value;

        var ddlCollectionTimeDscg = txtTransportDate[1];

        //  if (ddlCollectionTimeDscg == 0)
        //      txtTransportDate = txtTransportDate + " " + "00:00";
        //  else
        txtTransportDate = txtTransportDate[0] + " " + ddlCollectionTimeDscg;

        jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlCollectionDistrict, ddlTransferReason, ddlCollectionTown, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, AppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, ReceivingContactNo, MedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID, isChanged, emergencyBooking,
            collectionAddressType, ddlHomeDistrict, ddlHomeTown, ddlHomeSuburb, txtHomeAddressLine1, txtHomeAddressLine2, ddlCommunicalbleDisease, txtPatientNextToKin, txtNextOfKinContactNo, ddlHomeDropDistrictDscg, ddlHomeDropTownDscg, ddlHomeDropSuburb, txtHomeDropAddressLine1, txtHomeDropAddressLine2, txtReceivingPerson, txtReceivingClinician, dropAddressType, ddlControlCenter]);
    }



    //iht
    if (ddlTransferReason == 3) {
        //new fields >>
        var e = document.getElementById("ddlDropDistrictiht");
        var District = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlDropTowniht");
        var DropSuburb = e.options[e.selectedIndex].value;
        //new fields <<

        var e = document.getElementById("ddlFacilityiht");
        var ddlDropHospital = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlWardiht");
        var ddlDropClinic = e.options[e.selectedIndex].value;
        var e = document.getElementById("ddlAppointmentReasoniht");
        var AppointmentReason = e.options[e.selectedIndex].value;
        var txtReceivingContactNo = $("#txtReceivingContactNo").val();
        var tdMedicalRequirement = smedreq;
        var txtNotesAppoiment = $("#TextareaNotesIht").val();
        var txtLoginNameApp = $("#txtLoginNameiht").val();
        var txtLoginContactNoApp = $("#txtContactNoiht").val();


        var txtReceivingPerson = $("#txtReceivingPerson").val();
        var txtReceivingClinician = $("#txtReceivingClinician").val();

        // var e = document.getElementById("ddlCollectionTimeift");
        // var ddlCollectionTimeift = e.options[e.selectedIndex].value;

        txtTransportDate = txtTransportDate.split(' ');
        var ddlCollectionTimeift = txtTransportDate[1];

        // if (ddlCollectionTimeift == 0)
        //     txtTransportDate = txtTransportDate + " " + "00:00";
        // else
        txtTransportDate = txtTransportDate[0] + " " + ddlCollectionTimeift;


        // jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, ddlAppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, ReceivingContactNo, tdMedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID]);
        jsondata = JSON.stringify([callID, caseType, caseDateTime, ddlCollectionDistrict, ddlTransferReason, ddlCollectionTown, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, AppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, District, HomeDrop, DropSuburb, Followup, NotesDischage, LoginnameDscrg, ContactNoDschrg, Facilityiht, Wardiht, AppointmentReasoniht, txtReceivingContactNo, tdMedicalRequirement, TextareaNotesIht, LoginNameiht, txtContactNoiht, DropFacility, DropWard, loginUserID, TripEventID, txtPatientID, isChanged, emergencyBooking,
            collectionAddressType, ddlHomeDistrict, ddlHomeTown, ddlHomeSuburb, txtHomeAddressLine1, txtHomeAddressLine2, ddlCommunicalbleDisease, txtPatientNextToKin, txtNextOfKinContactNo, ddlHomeDropDistrictDscg, ddlHomeDropTownDscg, ddlHomeDropSuburb, txtHomeDropAddressLine1, txtHomeDropAddressLine2, txtReceivingPerson, txtReceivingClinician, dropAddressType, ddlControlCenter]);
    }



    $.ajax({
        url: WebAPIURL + 'GetTransferableCases',
        type: "Post",
        async: false,
        data: jsondata, //JSON.stringify([callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, ddlAppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, ddlDistrict, rbHomeDrop, ddlDropSuburb, ddlFollowup, txtNotesDischage, txtLoginnameDscrg, txtContactNoDschrg, ddlFacilityiht, ddlWardiht, ddlAppointmentReasoniht, txtReceivingContactNo, tdMedicalRequirement, TextareaNotesIht, txtLoginNameiht, txtContactNoiht, ddlDropFacility, ddlDropWard, loginUserID, TripEventID]),
        // data: JSON.stringify([callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, ddlAppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp]),
        // data: [callID, caseType, caseDateTime, ddlControlCenter, ddlTransferReason, ddlSuburb, rbHome, ddlwardcolectionpoint, ddlFacility, ddlPatientMobility, ddlPatientEscort, ddlAirTransport, txtTransportDate, txtReferringPerson, txtContactNo, txtClinician, txtIDNumber, txtPMI, txtPatientName, txtSurname, ddlGender, txtAge, ddlAgeType, txtPatientContactNo, txtAddressLine1, txtAddressLine2, ddlPatientSuburb, ddlCity, callSourceID, ddlDropHospital, ddlDropClinic, ddlAppointmentReason, txtNotesAppoiment, txtLoginNameApp, txtLoginContactNoApp, ddlDistrict, rbHomeDrop, ddlDropSuburb, ddlFollowup, txtNotesDischage, txtLoginnameDscrg, txtContactNoDschrg, ddlFacilityiht, ddlWardiht, ddlAppointmentReasoniht, txtReceivingContactNo, tdMedicalRequirement, TextareaNotesIht, txtLoginNameiht, txtContactNoiht, ddlDropFacility, ddlDropWard, loginUserID, TripEventID],


        contentType: 'application/json; charset=utf-8',
        //beforeSend: function () {
        //    $("#ILoaderSave")[0].style.display = "block";
        //},
        //complete: function () {
        //    $("#ILoaderSave")[0].style.display = "none";
        //},

        success: function (data) {
            //


      

            if (data != null) {
                var dvGeneratedHTML = document.getElementById("dvPatientsMoveHTML");
                dvGeneratedHTML.innerHTML = "";


                if (data.length > 0) {
                    var dvPaging = document.getElementById('dvPaging');
                    //dvPaging.style.display = "block";
                    ////if (isPageLoadFirstTime == 0) {
                    //if (data.length > 0) {
                    //    FillPagingDropdown(data[0].TotalRecords);
                    //    $("#ddlPageNumber option[value='" + pageindex + "']").attr('selected', 'selected');
                    //}
                    //}
                    OpenPatientsMoveWindow();
                    BookingData = data;
                    StartRowID = data.length - 1;
                    AddNewPatientMoveRow();
                    isPageLoadFirstTime = 1;
                    ShowOtherAvailableDates();


                }
                else {
                    dvGeneratedHTML.innerHTML = "<div class='NoRecord'>No record found.</div>";
                    var select = document.getElementById('ddlPageNumber');
                    select.options.length = 0;
                    var dvPaging = document.getElementById('dvPaging');
                    dvPaging.style.display = "none";
                }
            }
            else {
                $("#dvErrorMessage").css("display", "block");
            }
        

                //    var printLink = '../Bookings/PrintBooking?CID=' + data.CallID
                //     document.getElementById('btnPrint').setAttribute("onclick", 'window.location.href = ' + "'" + printLink + "'");




           
            


           



            // runEffect();
            // $("#dvAlertMessage").html(successMessage);
            // ResetAll();
        },
        error: function () { alert('error'); }
    });
}


function SendSMS(MobileNo, SMSText, RefID, MessageType) {

    var baseUri = WebAPIURL + 'SendSMS';

    var jsonData = JSON.stringify([MobileNo, SMSText, RefID, MessageType]);
    $.ajax({
        type: "Post",
        url: baseUri,
        data: jsonData,
        contentType: 'application/json; charset=utf-8',
        success: function (data) {
            if (data != null) {
            }
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });
}

// This method sends SMS
function GetTemplate(type, callID) {
    var baseUri = WebAPIURL + 'GetTemplateByType/' + type;
    $.ajax({
        type: "GET",
        url: baseUri,
        contentType: "json",
        dataType: "json",
        success: function (data) {

            if (data != null) {
                var hfieldCellNo = document.getElementById("txtPatientContactNo");
                var hfieldPatientName = document.getElementById("txtPatientName");
                var templateText = data[0].TemplateText;
                templateText = templateText.replace("[PatientName]", hfieldPatientName.value);
                templateText = templateText.replace("[BookingID]", callID);

                if (hfieldCellNo.value != "" && hfieldCellNo.value != null) {
                    SendSMS(hfieldCellNo, templateText, hfieldCallID.value, 1);
                    hfieldCellNo.value = "";
                    hfieldPatientName.value = "";
                }
            }
            //  LoadOnLineBooking(1, 15);
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });

}

// This method show other available rows
function ShowOtherAvailableDates() {
    //$("#dOtherAvailableDates").css("display", "block");
    //$("#btnErrorSave").css("display", "block");
    //$("#btnOtherDates").css("display", "none");
    debugger;
    LoadOtherDates();
}

// This method show other available rows
function LoadOtherDates() {
    var PickPoint = 0;
    var DropPoint = 0;
    var PickWardID = 0;
    var DropWardID = 0;
    var fromDate = "";
    var toDate = "";
    var mobilitiyID = 0;
    var escortRequired = 0;
    var controlCentreID = 0;
    var selectedPickFacility = 0;
    var selectedDropFacility = 0;
    var isEmergencyBooking = false;
    var txtTransportDate = $("#txtTransportDate").val();
    fromDate = txtTransportDate;
    fromDate = fromDate.split(' ');
    var dFromDate = fromDate[0].split("/");
    fromDate = dFromDate[0] + "-" + dFromDate[1] + "-" + dFromDate[2];
    var dFromDate = new Date('' + dFromDate[2] + '/' + dFromDate[1] + '/' + dFromDate[0] + '');

    //fromDate = dFromDate[2] + "-" + dFromDate[1] + "-" + dFromDate[0];

    var toDate = new Date();
    toDate.setDate(dFromDate.getDate() + 60);

    var mnth7 = "";
    var dt7 = "";
    if (toDate.getMonth() + 1 < 10) {
        mnth7 = "0" + (toDate.getMonth() + 1);
    }
    else {
        mnth7 = (toDate.getMonth() + 1);
    }

    if (toDate.getDate() < 10) {
        dt7 = "0" + toDate.getDate();
    }
    else {
        dt7 = toDate.getDate();
    }

   // dFromDate[2]
    //fromDate = dFromDate[2] + "-" + dFromDate[1] + "-" + dFromDate[0];

    var toDate = dt7 + "-" + mnth7 + "-" + toDate.getFullYear();

    var e = document.getElementById("ddlPatientEscort");
    var ddlPatientEscort = e.options[e.selectedIndex].value;
    escortRequired = ddlPatientEscort;


    var ddlPatientMobility;
    var e = document.getElementById("ddlPatientMobility");
    if (e.options.length > 0)
        ddlPatientMobility = e.options[e.selectedIndex].value;
    else
        ddlPatientMobility = 0;

    mobilitiyID = ddlPatientMobility;

    var ddlControlCenter;
    var e = document.getElementById("ddlControlCenter");
    if (e.options.length > 0)
        ddlControlCenter = e.options[e.selectedIndex].value;
    else
        ddlControlCenter = 0;

    var e = document.getElementById("ddlTransferReason");
    var ddlTransferReason = e.options[e.selectedIndex].value;
    var rbHome = document.getElementById("rbHome").checked;

    var e = document.getElementById("ddlwardcolectionpoint");
    var ddlwardcolectionpoint = e.options[e.selectedIndex].value;

    if (rbHome) {
        PickPoint = ddlwardcolectionpoint;
    }
    else {
        PickWardID = ddlwardcolectionpoint;
    }

    if (ddlTransferReason == 2) {
        var e = document.getElementById("ddlDropWard");
        ddlDropClinic = e.options[e.selectedIndex].value;
        HomeDrop = document.getElementById("rbHomeDrop").checked;   //if home
        var e = document.getElementById("ddlDropWard");
        ddlDropClinic = e.options[e.selectedIndex].value;
        if (HomeDrop) {
            DropPoint = ddlDropClinic;
        }
        else {
            DropWardID = ddlDropClinic;
        }
        isEmergencyBooking = document.getElementById("chkEmergencyBookingDisc").checked;

        var e = document.getElementById("ddlFacility");
        if (e.options.length > 0)
            selectedPickFacility = e.options[e.selectedIndex].value;
        else
            selectedPickFacility = 0;

        var e = document.getElementById("ddlDropFacility");
        if (e.options.length > 0)
            selectedDropFacility = e.options[e.selectedIndex].value;
        else
            selectedDropFacility = 0;

    }

    if (ddlTransferReason == 1) {
        var e = document.getElementById("ddlDropClinic");
        var ddlDropClinic = e.options[e.selectedIndex].value;
        DropWardID = ddlDropClinic;
        isEmergencyBooking = document.getElementById("chkEmergencyBooking").checked;

        var e = document.getElementById("ddlFacility");
        if (e.options.length > 0)
            selectedPickFacility = e.options[e.selectedIndex].value;
        else
            selectedPickFacility = 0;

        var e = document.getElementById("ddlDropHospital");
        if (e.options.length > 0)
            selectedDropFacility = e.options[e.selectedIndex].value;
        else
            selectedDropFacility = 0;
    }

    if (ddlTransferReason == 3) {
        var e = document.getElementById("ddlWardiht");
        var ddlDropClinic = e.options[e.selectedIndex].value;
        DropWardID = ddlDropClinic;
    }

    document.getElementById("ddlOtherAvailableDates").options.length = 0;


    document.getElementById("ddlOtherAvailableDatesMove").options.length = 0;
    

    var baseUri = WebAPIURL + 'GetAvailableSchedule';

    var jsonData = JSON.stringify([PickPoint, DropPoint, PickWardID, DropWardID, fromDate, toDate, mobilitiyID, escortRequired, isEmergencyBooking, ddlControlCenter, selectedPickFacility, selectedDropFacility]);

    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlOtherAvailableDates');

    $("<option value = '0' selected='selected'>" + "Select" + " </option>").appendTo('#ddlOtherAvailableDatesMove');

    $.ajax({
        type: "Post",
        url: baseUri,
        // contentType: "json",
        data: jsonData,
        async: false,
        //  dataType: "json",
        contentType: 'application/json; charset=utf-8',

        success: function (data) {
            if (data.length > 0) {
                $("#dOtherAvailableDates").css("display", "block");
                $("#btnErrorSave").css("display", "block");
                $("#btnOtherDates").css("display", "none");
                $.each(data, function (key, value) {
                    value.TravelDate = value.TravelDate.split("T");
                    $("<option value = '" + value.TravelDate[0] + "'>" + value.TravelDate[0] + " </option>").appendTo('#ddlOtherAvailableDates');
                    $("<option value = '" + value.TravelDate[0] + "'>" + value.TravelDate[0] + " </option>").appendTo('#ddlOtherAvailableDatesMove');

                });
            }
            else {
                $("#dOtherAvailableDates").css("display", "none");
                $("#btnErrorSave").css("display", "none");
                $("#btnErrorViewBookings").css("display", "block");
                $("#btnOtherDates").css("display", "none");

                $("#btnMovePatient").css("display", "none");
          

                var successMessage = "<p class='lable' style='width: 100%;text-align: center;' s >We are sorry, no seat available for next thirty days." + "</b></p>";
                $("#noseatMessage").html(successMessage)
            }
        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });

}



// This method saves other date
function SaveOtherDate() {
    if ($('#ddlOtherAvailableDates :selected').val() == 0) {
        $('#ddlOtherAvailableDates').css("border", "1px solid #ff0000");
        return;
    }

    debugger;

    var e = document.getElementById("ddlOtherAvailableDates");
    selectDate = e.options[e.selectedIndex].value;
    var selectDate = selectDate.split("-");
    var selectDate = selectDate[2] + '/' + selectDate[1] + '/' + selectDate[0];


    var txtTransportDate = $("#txtTransportDate").val();
    txtTransportDate = txtTransportDate.split(' ');

    selectDate = selectDate   // + " " + "16:14";  // txtTransportDate[1];
    $("#txtTransportDate").val(selectDate);
    SaveCase();
    //  alert("Saved");
}

// 
function CancelBooking() {

    var hfieldTripEventID = document.getElementById("hfieldTripEventID");
    var CallID = TripEventID;
    var UserID = getCookie("UserID");
    var statusTypeID = 4;
    var reasonID = 5;
    var reason = "Cancelled by Caller";



    var baseUri = WebAPIURL + 'CancelBooking/' + CallID + '/' + UserID + '/' + +statusTypeID + '/' + reasonID + '/' + reason;


    $.ajax({
        type: "GET",
        url: baseUri,
        contentType: "json",
        dataType: "json",
        success: function (data) {

            // HideCancelBooking();
            // ClearCancelBookingControl();
            //. runEffect();
            // $("#dvAlertMessage").html("Booking canceled successfully.");
            // OpenPromptWindow("Booking canceled successfully.", 1);
            window.location.href = '../Bookings/ManageBookings';
            //  GetTemplate(1);

        },
        error: function (xhr) {
            alert(xhr.responseText);
        }
    });

}

// This method adds new patient row
function AddPatientRow() {


    $("#dvPatientAJAX").css("display", "none");
    $("#grdPatientsHeader").show();

    if (ContactMessageStartRowID >= 0) {
        var strHTML = "";
        var dvGenID = "";
        var RowClass = "normal-grid left";
        var RowID = ContactMessageStartRowID;    //ContactMessages[ContactMessageStartRowID ].TripEventID;
        TotalRows = ContactMessages.length;
        dvGenID = "#dvRow" + ContactMessageStartRowID;
        strHTML = strHTML + "<div id='dvRow" + RowID + "'  class='msg_head_Patient' >";
        strHTML = strHTML + "<div class='" + RowClass + "' >";

        var statusClass = "";

        var dvtitle = "";

        strHTML = strHTML + "<div style='width:25%;' class='left'><div class='grid-normal-column left' title='" + "' >" + ContactMessages[ContactMessageStartRowID].Sender + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "<div style='width:25%; ' class='left'><div class='grid-normal-column left' title='" + ContactMessages[ContactMessageStartRowID].Subject + "' style='width:80%'>" + ContactMessages[ContactMessageStartRowID].Subject + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "<div style='width:50%; ' class='left'><div class='grid-normal-column left' title='" + ContactMessages[ContactMessageStartRowID].MessageText + "' style='width:80%' >" + ContactMessages[ContactMessageStartRowID].MessageText + "</div><div class='grid-normal-seperator right'></div></div>";

        strHTML = strHTML + "</div></div>";

        $("#dvMessagesHTML").html(strHTML + $("#dvMessagesHTML").html());

        ContactMessageStartRowID--;
        setTimeout("AddMessageRow();", 1);

    }


}
